<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Aplicaci√≥n avanzada de enfermer√≠a MAXI con procedimientos, PAE, calculadora y RCP interactivo">
<title>Enfermer√≠a MAXI Pro</title>
<style>
:root {
--primary:#007acc; --secondary:#28a745; --bg:#f5f5f5; --text:#222; --card:#fff;
--dark-bg:#121212; --dark-card:#1e1e1e; --dark-text:#f5f5f5;
}
*{box-sizing:border-box;margin:0;padding:0;font-family:'Roboto',sans-serif;}
body{background:var(--bg);color:var(--text);line-height:1.5;}
button{cursor:pointer;border:none;border-radius:4px;}
header{display:flex;justify-content:space-between;align-items:center;padding:1rem;background:var(--primary);color:#fff;}
header h1{font-size:1.5rem;}
main{display:grid;grid-template-columns:250px 1fr;min-height:90vh;}
aside{background:var(--card);padding:1rem;overflow-y:auto;}
.content{padding:1rem;}
aside h2{margin-bottom:1rem;font-size:1.2rem;}
aside button{display:block;width:100%;margin-bottom:0.5rem;padding:0.5rem;background:var(--primary);color:#fff;transition:0.3s;}
aside button:hover{background:var(--secondary);}
.procedure{background:var(--card);padding:1rem;margin-bottom:1rem;border-radius:6px;box-shadow:0 2px 5px rgba(0,0,0,0.1);transition:transform 0.2s;}
.procedure:hover{transform:scale(1.02);}
.procedure h3{margin-bottom:0.5rem;color:var(--primary);}
.procedure p{margin-bottom:0.5rem;}
.procedure ul{margin-left:1.2rem;}
.accordion{cursor:pointer;padding:0.5rem;font-weight:bold;background:var(--secondary);color:#fff;border-radius:4px;margin-bottom:0.5rem;}
.panel{padding:0.5rem 1rem;display:none;background:var(--card);border-radius:4px;margin-bottom:0.5rem;}
.search-container{margin-bottom:1rem;}
.search-container input{width:100%;padding:0.5rem;border-radius:4px;border:1px solid #ccc;}
#clock{font-weight:bold;}
.calc-container{background:var(--card);padding:1rem;margin-bottom:1rem;border-radius:6px;}
.calc-container input,.calc-container select{width:100%;padding:0.5rem;margin-bottom:0.5rem;border-radius:4px;border:1px solid #ccc;}
.rcp-container{background:var(--card);padding:1rem;border-radius:6px;margin-bottom:1rem;}
body.dark{background:var(--dark-bg);color:var(--dark-text);}
body.dark aside{background:var(--dark-card);}
body.dark .procedure,body.dark .calc-container,body.dark .rcp-container,.panel{background:var(--dark-card);color:var(--dark-text);}
@media(max-width:768px){main{grid-template-columns:1fr;}aside{display:flex;overflow-x:auto;padding:0.5rem;}aside button{flex:0 0 auto;margin-right:0.5rem;}}
</style>
</head>
<body>
<header>
<h1>Enfermer√≠a MAXI Pro</h1>
<div><span id="clock"></span><button onclick="toggleDark()">üåô</button></div>
</header>
<main>
<aside>
<h2>Categor√≠as</h2>
<button onclick="filterProcedures('higiene')">Higiene</button>
<button onclick="filterProcedures('curacion')">Curaciones</button>
<button onclick="filterProcedures('farmaco')">Farmacolog√≠a</button>
<button onclick="filterProcedures('emergencia')">Emergencias</button>
<button onclick="filterProcedures('movilizacion')">Movilizaci√≥n</button>
<button onclick="filterProcedures('nutricion')">Nutrici√≥n</button>
<button onclick="filterProcedures('todo')">Mostrar Todo</button>
</aside>
<div class="content">
<div class="search-container">
<input type="text" id="searchInput" placeholder="Buscar procedimiento..." onkeyup="searchProcedures()">
</div>

<!-- Procedimientos iniciales -->
<div id="proceduresContainer">

<div class="procedure" data-category="higiene">
<h3>Lavado de manos</h3>
<p>Prevenci√≥n de infecciones nosocomiales.</p>
<ul>
<li>Materiales: jab√≥n, agua, toallas desechables</li>
<li>Pasos: mojar manos, aplicar jab√≥n, frotar 20 seg., enjuagar, secar</li>
<li>Checklist: ‚úÖ </li>
<li>Referencia: <a href="https://www.who.int/gpsc/5may/Hand_Hygiene_Why_How_and_When_Brochure.pdf" target="_blank">OMS Manual</a></li>
</ul>
</div>

<div class="procedure" data-category="curacion">
<h3>Curaci√≥n de escaras</h3>
<p>Prevenci√≥n y tratamiento de √∫lceras por presi√≥n.</p>
<ul>
<li>Materiales: ap√≥sitos, guantes, soluci√≥n antis√©ptica</li>
<li>Pasos: limpiar, desinfectar, aplicar ap√≥sito, fijar, documentar</li>
<li>Checklist: ‚úÖ </li>
<li>Referencia: <a href="https://www.woundcarehandbook.com" target="_blank">Manual de cuidado de heridas</a></li>
</ul>
</div>

<div class="procedure" data-category="farmaco">
<h3>Administraci√≥n de medicamentos</h3>
<p>Procedimiento seguro seg√∫n prescripci√≥n m√©dica.</p>
<ul>
<li>Verificar paciente, dosis, v√≠a y hora</li>
<li>Preparar medicaci√≥n, aplicar, registrar</li>
<li>Checklist: ‚úÖ </li>
<li>Referencia: <a href="https://www.fda.gov/drugs" target="_blank">FDA</a></li>
</ul>
</div>

<div class="procedure" data-category="emergencia">
<h3>RCP B√°sico</h3>
<p>Reanimaci√≥n cardiopulmonar guiada.</p>
<button onclick="startRCP()">Iniciar RCP</button>
</div>

<!-- Repetir hasta completar ~15 procedimientos iniciales -->
</div>

<!-- Calculadora avanzada -->
<div class="calc-container">
<h3>Calculadora de Paciente</h3>
<input type="number" id="weight" placeholder="Peso (kg)">
<input type="number" id="height" placeholder="Altura (cm)">
<input type="number" id="age" placeholder="Edad">
<select id="gender"><option value="male">Hombre</option><option value="female">Mujer</option></select>
<button onclick="calculatePatient()">Calcular IMC y dosis</button>
<p id="calcResult"></p>
</div>

<!-- RCP interactivo -->
<div class="rcp-container" id="rcpContainer">
<h3>RCP Interactivo</h3>
<p id="rcpStep">Presiona "Iniciar RCP" para comenzar</p>
<p id="rcpTimer"></p>
</div>

<!-- Gr√°ficos <canvas> -->
<div class="procedure">
<h3>Gr√°fico de signos vitales</h3>
<canvas id="vitalChart" width="400" height="200"></canvas>
</div>
</div>
</main>

<script>
// Reloj
function updateClock(){const now=new Date();document.getElementById('clock').textContent=now.toLocaleTimeString();}
setInterval(updateClock,1000);updateClock();

// Dark mode
function toggleDark(){document.body.classList.toggle('dark');}

// Filtrado
function filterProcedures(cat){const procedures=document.querySelectorAll('.procedure');procedures.forEach(p=>{p.style.display=(cat==='todo'||p.dataset.category===cat)?'block':'none';});}

// B√∫squeda
function searchProcedures(){const input=document.getElementById('searchInput').value.toLowerCase();const procedures=document.querySelectorAll('.procedure');procedures.forEach(p=>{p.style.display=p.textContent.toLowerCase().includes(input)?'block':'none';});}

// Calculadora avanzada
function calculatePatient(){
const weight=parseFloat(document.getElementById('weight').value);
const height=parseFloat(document.getElementById('height').value)/100;
const age=parseInt(document.getElementById('age').value);
const gender=document.getElementById('gender').value;
if(!weight||!height||!agei
   // --- Contin√∫a desde donde se cort√≥: completar JS y resto del archivo ---
if(!weight || !height || !age){ alert('Ingrese todos los datos'); return; }
const bmi = (weight / (height * height)).toFixed(2);

// Dosis por kg (ejemplo): dosis base 10 mg/kg para f√°rmaco hipot√©tico
const dose_mg_per_kg = 10;
const dose_total_mg = (weight * dose_mg_per_kg).toFixed(1);

// Presi√≥n arterial media (si hay inputs opcionales)
const sbp = parseFloat(document.getElementById('sbp')?.value || 0);
const dbp = parseFloat(document.getElementById('dbp')?.value || 0);
let map = '';
if(sbp && dbp){
  map = Math.round((sbp + 2*dbp) / 3);
}

// Requerimiento cal√≥rico estimado (Mifflin-St Jeor simplificado)
let bmr;
if(gender === 'male'){
  bmr = Math.round(10*weight + 6.25*(height*100) - 5*age + 5);
} else {
  bmr = Math.round(10*weight + 6.25*(height*100) - 5*age - 161);
}
// factor actividad leve (1.3) por defecto
const calories = Math.round(bmr * 1.3);

document.getElementById('calcResult').innerHTML = `
  <strong>IMC:</strong> ${bmi} kg/m¬≤<br>
  <strong>Dosis estimada (ej):</strong> ${dose_total_mg} mg (${dose_mg_per_kg} mg/kg)<br>
  ${map ? `<strong>PAM (MAP):</strong> ${map} mmHg<br>` : ''}
  <strong>Requerimiento cal√≥rico estimado:</strong> ${calories} kcal/d√≠a
`;
}

// ---------- RCP avanzado: inicio/parar, cambio de reanimador cada 2 min ----------
let rcpTimerInterval = null;
let rcpTotalSeconds = 0;
let rcpRescuerSeconds = 0;
let rcpActive = false;

function startRCP(){
  if(rcpActive){ stopRCP(); return; }
  rcpActive = true;
  rcpTotalSeconds = 0;
  rcpRescuerSeconds = 0;
  document.getElementById('rcpStep').textContent = 'RCP iniciado: compresiones 100-120/min. Mant√©n ritmo y alterna cada 2 minutos.';
  document.getElementById('rcpTimer').textContent = '00:00';
  rcpTimerInterval = setInterval(()=>{
    rcpTotalSeconds++;
    rcpRescuerSeconds++;
    const mm = String(Math.floor(rcpTotalSeconds / 60)).padStart(2,'0');
    const ss = String(rcpTotalSeconds % 60).padStart(2,'0');
    document.getElementById('rcpTimer').textContent = `${mm}:${ss}`;
    // cada 120s -> advertencia para cambio de reanimador
    if(rcpRescuerSeconds >= 120){
      rcpRescuerSeconds = 0;
      alert('Recordatorio: cambiar reanimador ‚Äî mantener m√≠nima interrupci√≥n de compresiones.');
    }
  }, 1000);
  // change button text
  // create stop button if not exists
  const proc = Array.from(document.querySelectorAll('.procedure')).find(p=>p.querySelector('button') && p.querySelector('button').textContent.includes('RCP'));
  if(proc){
    const btn = proc.querySelector('button');
    btn.textContent = 'Detener RCP';
    btn.onclick = stopRCP;
  }
}

function stopRCP(){
  if(rcpTimerInterval) clearInterval(rcpTimerInterval);
  rcpActive = false;
  document.getElementById('rcpStep').textContent = 'RCP detenido.';
  // reset button text
  const proc = Array.from(document.querySelectorAll('.procedure')).find(p=>p.querySelector('button'));
  if(proc){
    const btn = proc.querySelector('button');
    btn.textContent = 'Iniciar RCP';
    btn.onclick = startRCP;
  }
}

// ---------- Gr√°fico de signos vitales (canvas) ----------
(function initVitalsChart(){
  const canvas = document.getElementById('vitalChart');
  const ctx = canvas.getContext('2d');

  // sample dataset: [HR, SBP, DBP, Temp, RR, SpO2]
  let dataPoints = [
    {time:0, hr:78, sbp:118, dbp:76, temp:36.8, rr:18, spo2:98},
    {time:1, hr:80, sbp:120, dbp:78, temp:36.9, rr:17, spo2:97},
    {time:2, hr:82, sbp:122, dbp:80, temp:37.0, rr:18, spo2:97},
  ];

  function draw(){
    const w = canvas.width, h = canvas.height;
    ctx.clearRect(0,0,w,h);

    // background grid
    ctx.strokeStyle = 'rgba(0,0,0,0.06)';
    ctx.lineWidth = 1;
    for(let i=0;i<5;i++){
      ctx.beginPath();
      ctx.moveTo(0, (i+1)*(h/6));
      ctx.lineTo(w, (i+1)*(h/6));
      ctx.stroke();
    }

    // Draw HR (as line)
    ctx.beginPath();
    ctx.strokeStyle = '#e63946'; // heart rate color
    ctx.lineWidth = 2;
    dataPoints.forEach((p,i)=>{
      const x = (i/(Math.max(1, dataPoints.length-1))) * (w-40) + 20;
      const y = h - ( (p.hr - 40) / (140 - 40) ) * (h-40) - 20;
      if(i===0) ctx.moveTo(x,y); else ctx.lineTo(x,y);
      // point
      ctx.fillStyle = '#e63946';
      ctx.beginPath(); ctx.arc(x,y,3,0,Math.PI*2); ctx.fill();
    });
    ctx.stroke();

    // Draw SBP (dotted)
    ctx.beginPath();
    ctx.strokeStyle = '#457b9d';
    ctx.setLineDash([6,4]);
    ctx.lineWidth = 2;
    dataPoints.forEach((p,i)=>{
      const x = (i/(Math.max(1, dataPoints.length-1))) * (w-40) + 20;
      const y = h - ( (p.sbp - 60) / (200 - 60) ) * (h-40) - 20;
      if(i===0) ctx.moveTo(x,y); else ctx.lineTo(x,y);
    });
    ctx.stroke();
    ctx.setLineDash([]);

    // Legend
    ctx.fillStyle = '#e63946'; ctx.fillRect(10,10,12,8); ctx.fillStyle='#000'; ctx.fillText('HR (lpm)',28,18);
    ctx.fillStyle = '#457b9d'; ctx.fillRect(110,10,12,8); ctx.fillStyle='#000'; ctx.fillText('SBP (mmHg)',130,18);
  }

  // initial draw
  draw();

  // simulate new data every 6 seconds to demonstrate dynamic updates
  setInterval(()=>{
    const last = dataPoints[dataPoints.length-1];
    const next = {
      time: last.time+1,
      hr: Math.max(50, Math.round(last.hr + (Math.random()*8 - 4))),
      sbp: Math.max(90, Math.round(last.sbp + (Math.random()*6 - 3))),
      dbp: Math.max(50, Math.round(last.dbp + (Math.random()*4 - 2))),
      temp: Math.round((last.temp + (Math.random()*0.2 - 0.1))*10)/10,
      rr: Math.max(10, Math.round(last.rr + (Math.random()*2 -1))),
      spo2: Math.max(90, Math.round(last.spo2 + (Math.random()*1 -0.5)))
    };
    dataPoints.push(next);
    if(dataPoints.length > 12) dataPoints.shift();
    draw();
  }, 6000);

})();

// ---------- PAE (guardar, listar, export) ----------
const PAE_KEY = 'maxi_pae_records';

function savePAE(){
  const name = document.getElementById('paeName')?.value || prompt('Nombre del paciente:');
  const age = document.getElementById('paeAge')?.value || '';
  const diagnosis = document.getElementById('paeDiagnosis')?.value || prompt('Diagn√≥stico (breve):');
  const plan = document.getElementById('paePlan')?.value || '';
  const implement = document.getElementById('paeImplement')?.value || '';
  const evaluation = document.getElementById('paeEval')?.value || '';
  if(!name || !diagnosis){ alert('Nombre y diagn√≥stico requeridos'); return; }
  const rec = { name, age, diagnosis, plan, implement, evaluation, ts: Date.now() };
  const arr = JSON.parse(localStorage.getItem(PAE_KEY) || '[]');
  arr.push(rec);
  localStorage.setItem(PAE_KEY, JSON.stringify(arr));
  alert('PAE guardado localmente.');
  renderPAEList();
}

function renderPAEList(){
  const container = document.getElementById('paeList');
  if(!container) return;
  const arr = JSON.parse(localStorage.getItem(PAE_KEY) || '[]');
  if(arr.length === 0){ container.innerHTML = '<div class="muted">No hay registros PAE</div>'; return; }
  let html = '<table style="width:100%;border-collapse:collapse"><thead><tr><th>Paciente</th><th>Diagn√≥stico</th><th>Fecha</th><th>Acciones</th></tr></thead><tbody>';
  arr.slice().reverse().forEach((r, idx)=>{
    const date = new Date(r.ts).toLocaleString();
    html += `<tr><td>${r.name} (${r.age||'-'})</td><td>${r.diagnosis.slice(0,80)}</td><td>${date}</td>
      <td><button onclick="viewPAE(${idx})">Ver</button> <button onclick="deletePAE(${idx})">Eliminar</button></td></tr>`;
  });
  html += '</tbody></table>';
  container.innerHTML = html;
}

function viewPAE(indexFromEnd){
  const arr = JSON.parse(localStorage.getItem(PAE_KEY) || '[]');
  const idx = arr.length - 1 - indexFromEnd;
  const r = arr[idx];
  if(!r) return alert('Registro no encontrado');
  alert(`PAE - ${r.name}\nDiagn√≥stico: ${r.diagnosis}\nPlan: ${r.plan}\nImplementaci√≥n: ${r.implement}\nEvaluaci√≥n: ${r.evaluation}\nFecha: ${new Date(r.ts).toLocaleString()}`);
}

function deletePAE(indexFromEnd){
  const arr = JSON.parse(localStorage.getItem(PAE_KEY) || '[]');
  const idx = arr.length - 1 - indexFromEnd;
  if(!arr[idx]) return;
  if(!confirm('Eliminar registro PAE?')) return;
  arr.splice(idx,1);
  localStorage.setItem(PAE_KEY, JSON.stringify(arr));
  renderPAEList();
}

// create simple PAE UI (inject into page if not present)
(function createPAEUI(){
  const main = document.querySelector('.content');
  if(!main) return;
  const paeCard = document.createElement('div');
  paeCard.className = 'procedure';
  paeCard.style.marginTop = '12px';
  paeCard.innerHTML = `
    <h3>PAE (Proceso de Atenci√≥n de Enfermer√≠a)</h3>
    <div style="display:grid;gap:6px">
      <input id="paeName" placeholder="Nombre paciente">
      <input id="paeAge" placeholder="Edad">
      <input id="paeDiagnosis" placeholder="Diagn√≥stico (enfermer√≠a)">
      <textarea id="paePlan" rows="2" placeholder="Planificaci√≥n"></textarea>
      <textarea id="paeImplement" rows="2" placeholder="Implementaci√≥n"></textarea>
      <textarea id="paeEval" rows="2" placeholder="Evaluaci√≥n"></textarea>
      <div style="display:flex;gap:8px">
        <button onclick="savePAE()" class="btn">Guardar PAE</button>
        <button onclick="exportPAE()" class="btn">Exportar JSON</button>
        <button onclick="renderPAEList()" class="btn">Ver historial</button>
      </div>
      <div id="paeList" style="margin-top:8px"></div>
    </div>
  `;
  main.appendChild(paeCard);
  renderPAEList();
})();

function exportPAE(){
  const data = localStorage.getItem(PAE_KEY) || '[]';
  const blob = new Blob([data], { type: 'application/json' });
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = 'pae_export.json';
  document.body.appendChild(a); a.click(); a.remove();
}

// ---------- Combinador de medicamentos (b√°sico, heur√≠stico) ----------
(function createMedComboUI(){
  const main = document.querySelector('.content');
  const div = document.createElement('div');
  div.className = 'procedure';
  div.innerHTML = `
    <h3>Combinador de medicamentos (comprobaci√≥n b√°sica)</h3>
    <div style="display:grid;gap:8px">
      <input id="medSearch" placeholder="Ingrese nombre comercial o principio activo">
      <div style="display:flex;gap:8px">
        <select id="medA"></select>
        <select id="medB"></select>
        <button id="checkMeds" class="btn">Verificar</button>
      </div>
      <div id="medResult" class="muted"></div>
    </div>
  `;
  main.appendChild(div);

  // preset meds
  const meds = [
    {code:'warfarin', name:'Warfarina'},
    {code:'ibuprofen', name:'Ibuprofeno'},
    {code:'paracetamol', name:'Paracetamol'},
    {code:'ciprofloxacin', name:'Ciprofloxacina'},
    {code:'metformin', name:'Metformina'},
    {code:'sertraline', name:'Sertralina'},
    {code:'omeprazole', name:'Omeprazol'}
  ];
  const selA = document.getElementById('medA');
  const selB = document.getElementById('medB');
  meds.forEach(m=>{ const o1=document.createElement('option'); o1.value=m.code; o1.textContent=m.name; selA.appendChild(o1);
    const o2=document.createElement('option'); o2.value=m.code; o2.textContent=m.name; selB.appendChild(o2); });

  document.getElementById('checkMeds').addEventListener('click', ()=>{
    const a = selA.value, b = selB.value;
    if(!a || !b){ document.getElementById('medResult').textContent = 'Seleccione dos f√°rmacos.'; return; }
    const alerts = [];
    if((a==='warfarin' && b==='ibuprofen') || (a==='ibuprofen' && b==='warfarin')){
      alerts.push('Alerta: Warfarina + AINEs (ibuprofeno) aumenta riesgo de sangrado. Verificar INR.');
    }
    if((a==='warfarin' && b==='ciprofloxacin') || (a==='ciprofloxacin' && b==='warfarin')){
      alerts.push('Alerta: Ciprofloxacina puede potenciar efecto anticoagulante.');
    }
    if((a==='metformin' && b==='ciprofloxacin') || (a==='ciprofloxacin' && b==='metformin')){
      alerts.push('Aviso: Vigilar funci√≥n renal con ciertas combinaciones; ajustar dosis si necesario.');
    }
    if(alerts.length===0) document.getElementById('medResult').innerHTML = '<span style="color:green">No se detectaron alertas b√°sicas (esto es indicativo, consulte bases especializadas).</span>';
    else document.getElementById('medResult').innerHTML = alerts.map(x=>`<div style="color:#b91c1c">${x}</div>`).join('');
  });
})();

// ---------- Export/Import completo del sistema (protocolos/PAE) ----------
function exportAll(){
  const payload = { pae: JSON.parse(localStorage.getItem(PAE_KEY) || '[]') /*, protocolos: ... por implementar */ };
  const blob = new Blob([JSON.stringify(payload, null, 2)], { type: 'application/json' });
  const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = 'enfermeria_maxi_export.json'; document.body.appendChild(a); a.click(); a.remove();
}

// ---------- Inicializaci√≥n adicional (opcional) ----------
(function init(){
  // asegurar que el bot√≥n RCP del procedimiento inicial dispare startRCP
  const rcpBtn = Array.from(document.querySelectorAll('.procedure'))
    .map(p=>p.querySelector('button'))
    .find(b=>b && b.textContent.toLowerCase().includes('rcp'));
  if(rcpBtn){ rcpBtn.onclick = startRCP; }
})();

</script>

</body>
</html>
