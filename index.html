<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema Integral de Gestión Médica</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #2563eb;
            --primary-light: #3b82f6;
            --primary-dark: #1d4ed8;
            --secondary: #7c3aed;
            --success: #16a34a;
            --warning: #ca8a04;
            --danger: #dc2626;
            --info: #0891b2;
            --light: #f8fafc;
            --dark: #0f172a;
            --gray: #64748b;
            --gray-light: #e2e8f0;
            --border: #e2e8f0;
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --shadow-md: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --shadow-lg: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            --radius-sm: 0.375rem;
            --radius: 0.5rem;
            --radius-lg: 0.75rem;
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --transition-fast: all 0.15s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .dark-mode {
            --light: #0f172a;
            --dark: #f1f5f9;
            --border: #334155;
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.3);
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.4), 0 2px 4px -1px rgba(0, 0, 0, 0.3);
            --shadow-md: 0 10px 15px -3px rgba(0, 0, 0, 0.3), 0 4px 6px -2px rgba(0, 0, 0, 0.2);
            --shadow-lg: 0 20px 25px -5px rgba(0, 0, 0, 0.4), 0 10px 10px -5px rgba(0, 0, 0, 0.3);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', 'Poppins', sans-serif;
            background-color: var(--light);
            color: var(--dark);
            line-height: 1.6;
            transition: var(--transition);
            min-height: 100vh;
        }

        .container {
            display: grid;
            grid-template-columns: 280px 1fr;
            min-height: 100vh;
            background-color: var(--light);
        }

        /* Sidebar */
        .sidebar {
            background: linear-gradient(180deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            padding: 1.5rem;
            position: fixed;
            height: 100vh;
            width: 280px;
            overflow-y: auto;
            transition: var(--transition);
            z-index: 100;
            border-right: 1px solid rgba(255, 255, 255, 0.1);
        }

        .sidebar-header {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }

        .sidebar-logo {
            background: white;
            color: var(--primary);
            width: 40px;
            height: 40px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            font-weight: 700;
        }

        .sidebar-header h1 {
            font-size: 1.25rem;
            font-weight: 700;
            letter-spacing: -0.025em;
        }

        .sidebar-menu {
            list-style: none;
        }

        .sidebar-menu li {
            margin-bottom: 0.25rem;
        }

        .sidebar-menu a {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem 1rem;
            color: rgba(255, 255, 255, 0.9);
            text-decoration: none;
            border-radius: var(--radius);
            transition: var(--transition);
            font-weight: 500;
            position: relative;
        }

        .sidebar-menu a:hover, .sidebar-menu a.active {
            background: rgba(255, 255, 255, 0.15);
            color: white;
            transform: translateX(2px);
        }

        .sidebar-menu a.active::before {
            content: '';
            position: absolute;
            left: 0;
            top: 50%;
            transform: translateY(-50%);
            width: 4px;
            height: 70%;
            background: white;
            border-radius: 0 4px 4px 0;
        }

        .sidebar-menu a i {
            width: 20px;
            text-align: center;
            font-size: 1.1rem;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            padding: 1.5rem;
            margin-left: 280px;
            transition: var(--transition);
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--border);
        }

        .header h2 {
            color: var(--primary);
            font-weight: 600;
            font-size: 1.5rem;
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .theme-toggle {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            background: none;
            border: none;
            cursor: pointer;
            color: var(--dark);
            font-size: 0.9rem;
            padding: 0.5rem;
            border-radius: var(--radius);
            transition: var(--transition);
        }

        .theme-toggle:hover {
            background: rgba(37, 99, 235, 0.1);
        }

        .theme-toggle i {
            font-size: 1.2rem;
        }

        .user-profile {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            background: white;
            padding: 0.5rem 1rem;
            border-radius: var(--radius);
            box-shadow: var(--shadow-sm);
            transition: var(--transition);
        }

        .dark-mode .user-profile {
            background: var(--dark);
            color: var(--light);
        }

        .user-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: var(--primary);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 0.875rem;
        }

        .user-info {
            font-size: 0.875rem;
        }

        .user-name {
            font-weight: 500;
            color: var(--dark);
            display: block;
        }

        .dark-mode .user-name {
            color: var(--light);
        }

        .user-role {
            color: var(--gray);
            font-size: 0.75rem;
        }

        /* Cards */
        .card {
            background: white;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            transition: var(--transition);
            overflow: hidden;
        }

        .dark-mode .card {
            background: var(--dark);
            color: var(--light);
            box-shadow: var(--shadow-md);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.25rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--border);
        }

        .dark-mode .card-header {
            border-color: #334155;
        }

        .card-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .card-title i {
            color: var(--primary-light);
        }

        .card-actions {
            display: flex;
            gap: 0.5rem;
        }

        /* Forms */
        .form-group {
            margin-bottom: 1.25rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: var(--dark);
            font-size: 0.875rem;
        }

        .dark-mode .form-group label {
            color: var(--light);
        }

        .form-control {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 1px solid var(--border);
            border-radius: var(--radius);
            font-size: 1rem;
            transition: var(--transition);
            background: white;
            color: var(--dark);
        }

        .dark-mode .form-control {
            background: #1e293b;
            border-color: #334155;
            color: var(--light);
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.2);
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
        }

        textarea.form-control {
            min-height: 120px;
            resize: vertical;
            font-family: inherit;
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: var(--radius);
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.875rem;
            text-decoration: none;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--primary-dark);
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-success:hover {
            background: #15803d;
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }

        .btn-info {
            background: var(--info);
            color: white;
        }

        .btn-info:hover {
            background: #0e7490;
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }

        .btn-warning {
            background: var(--warning);
            color: white;
        }

        .btn-warning:hover {
            background: #a36b03;
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .btn-danger:hover {
            background: #b91c1c;
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }

        .btn-outline {
            background: transparent;
            border: 1px solid var(--border);
            color: var(--dark);
        }

        .dark-mode .btn-outline {
            border-color: #334155;
            color: var(--light);
        }

        .btn-outline:hover {
            background: rgba(37, 99, 235, 0.1);
            border-color: var(--primary);
        }

        .btn-sm {
            padding: 0.5rem 1rem;
            font-size: 0.75rem;
        }

        .btn-icon {
            padding: 0.75rem;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Tables */
        .table-container {
            overflow-x: auto;
            border-radius: var(--radius);
            border: 1px solid var(--border);
            margin-bottom: 1rem;
        }

        .dark-mode .table-container {
            border-color: #334155;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.875rem;
        }

        th, td {
            padding: 0.75rem;
            text-align: left;
            border-bottom: 1px solid var(--border);
        }

        th {
            background: rgba(37, 99, 235, 0.05);
            font-weight: 600;
            color: var(--primary);
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .dark-mode th {
            background: rgba(37, 99, 235, 0.1);
            color: var(--primary-light);
        }

        tr:hover {
            background: rgba(37, 99, 235, 0.02);
        }

        .dark-mode tr:hover {
            background: rgba(37, 99, 235, 0.05);
        }

        .status-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.375rem;
            padding: 0.25rem 0.5rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 500;
        }

        .status-success {
            background: rgba(22, 163, 74, 0.1);
            color: var(--success);
            border: 1px solid rgba(22, 163, 74, 0.2);
        }

        .status-warning {
            background: rgba(202, 138, 4, 0.1);
            color: var(--warning);
            border: 1px solid rgba(202, 138, 4, 0.2);
        }

        .status-danger {
            background: rgba(220, 38, 38, 0.1);
            color: var(--danger);
            border: 1px solid rgba(220, 38, 38, 0.2);
        }

        .status-info {
            background: rgba(8, 145, 178, 0.1);
            color: var(--info);
            border: 1px solid rgba(8, 145, 178, 0.2);
        }

        /* Tabs */
        .tabs {
            display: flex;
            border-bottom: 1px solid var(--border);
            margin-bottom: 1.5rem;
            overflow-x: auto;
        }

        .dark-mode .tabs {
            border-color: #334155;
        }

        .tab {
            padding: 0.75rem 1.5rem;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            font-weight: 500;
            transition: var(--transition);
            white-space: nowrap;
        }

        .tab.active {
            border-bottom-color: var(--primary);
            color: var(--primary);
            font-weight: 600;
        }

        /* Search */
        .search-container {
            display: flex;
            gap: 0.75rem;
            margin-bottom: 1.5rem;
            position: relative;
        }

        .search-input {
            flex: 1;
            padding: 0.75rem 1rem;
            border: 1px solid var(--border);
            border-radius: var(--radius);
            font-size: 1rem;
            transition: var(--transition);
            background: white;
            color: var(--dark);
        }

        .dark-mode .search-input {
            background: #1e293b;
            border-color: #334155;
            color: var(--light);
        }

        .search-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.2);
        }

        .search-results {
            margin-top: 1.5rem;
        }

        .result-item {
            margin-bottom: 1rem;
            padding: 1rem;
            border: 1px solid var(--border);
            border-radius: var(--radius);
            background: white;
            transition: var(--transition);
        }

        .dark-mode .result-item {
            background: #1e293b;
            border-color: #334155;
        }

        .result-item:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .result-title {
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .result-title i {
            font-size: 1.1rem;
        }

        .result-meta {
            display: flex;
            gap: 1rem;
            margin-bottom: 0.5rem;
            font-size: 0.875rem;
            color: var(--gray);
        }

        .result-source {
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
            background: rgba(37, 99, 235, 0.1);
            color: var(--primary);
            padding: 0.125rem 0.375rem;
            border-radius: 9999px;
            font-size: 0.75rem;
        }

        .result-content {
            line-height: 1.6;
            color: var(--dark);
        }

        .dark-mode .result-content {
            color: var(--light);
        }

        .result-actions {
            display: flex;
            gap: 0.5rem;
            margin-top: 0.75rem;
        }

        /* Canvas */
        .canvas-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-top: 1.5rem;
        }

        .canvas-wrapper {
            background: white;
            border-radius: var(--radius);
            padding: 1rem;
            box-shadow: var(--shadow-sm);
            transition: var(--transition);
        }

        .dark-mode .canvas-wrapper {
            background: var(--dark);
            box-shadow: var(--shadow-md);
        }

        .canvas-wrapper:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .chart-container {
            position: relative;
            width: 100%;
            height: 200px;
            border: 1px solid var(--border);
            border-radius: var(--radius);
            overflow: hidden;
        }

        .chart-bar {
            position: absolute;
            bottom: 0;
            background: var(--primary);
            width: 12%;
            transition: height 0.5s ease-out;
        }

        .chart-line {
            position: absolute;
            bottom: 0;
            width: 100%;
            height: 2px;
            background: var(--primary);
        }

        .chart-point {
            position: absolute;
            width: 8px;
            height: 8px;
            background: var(--primary);
            border-radius: 50%;
            transform: translate(-50%, -50%);
        }

        .chart-label {
            position: absolute;
            bottom: -20px;
            width: 100%;
            text-align: center;
            font-size: 0.75rem;
            color: var(--gray);
        }

        .chart-y-label {
            position: absolute;
            left: -40px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 0.75rem;
            color: var(--gray);
            writing-mode: vertical-rl;
            text-orientation: mixed;
        }

        /* Alerts */
        .alert {
            padding: 1rem;
            border-radius: var(--radius);
            margin-bottom: 1rem;
            display: flex;
            align-items: flex-start;
            gap: 0.75rem;
            border: 1px solid transparent;
        }

        .alert-success {
            background: rgba(22, 163, 74, 0.1);
            border-color: rgba(22, 163, 74, 0.2);
            color: #166534;
        }

        .alert-info {
            background: rgba(8, 145, 178, 0.1);
            border-color: rgba(8, 145, 178, 0.2);
            color: #086275;
        }

        .alert-warning {
            background: rgba(202, 138, 4, 0.1);
            border-color: rgba(202, 138, 4, 0.2);
            color: #92400e;
        }

        .alert-danger {
            background: rgba(220, 38, 38, 0.1);
            border-color: rgba(220, 38, 38, 0.2);
            color: #991b1b;
        }

        .alert-icon {
            flex-shrink: 0;
            font-size: 1.25rem;
            margin-top: 0.125rem;
        }

        /* Responsive */
        @media (max-width: 1200px) {
            .container {
                grid-template-columns: 240px 1fr;
            }
            .sidebar {
                width: 240px;
            }
            .main-content {
                margin-left: 240px;
            }
        }

        @media (max-width: 992px) {
            .container {
                grid-template-columns: 1fr;
            }
            .sidebar {
                position: fixed;
                width: 100%;
                height: auto;
                max-height: 0;
                overflow: hidden;
                z-index: 1000;
                border-right: none;
                border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            }
            .sidebar.active {
                max-height: 100vh;
            }
            .main-content {
                margin-left: 0;
                padding: 1rem;
            }
            .header {
                padding: 1rem 0;
            }
            .mobile-menu-btn {
                display: block;
            }
        }

        @media (max-width: 768px) {
            .header {
                flex-direction: column;
                align-items: stretch;
                gap: 1rem;
            }
            .header-actions {
                justify-content: space-between;
            }
            .user-profile {
                padding: 0.5rem;
            }
            .user-info {
                display: none;
            }
            .search-container {
                flex-direction: column;
            }
            .form-row {
                grid-template-columns: 1fr;
            }
            .canvas-container {
                grid-template-columns: 1fr;
            }
            .stats-grid {
                grid-template-columns: 1fr;
            }
            .table-container {
                font-size: 0.8rem;
            }
            th, td {
                padding: 0.5rem;
            }
        }

        @media (max-width: 576px) {
            .card {
                padding: 1rem;
            }
            .card-header {
                flex-direction: column;
                align-items: stretch;
                gap: 0.75rem;
            }
            .card-actions {
                justify-content: flex-end;
            }
            .btn {
                padding: 0.625rem 1.25rem;
                font-size: 0.875rem;
            }
            .btn-icon {
                padding: 0.625rem;
                width: 36px;
                height: 36px;
            }
            .export-buttons {
                flex-direction: column;
            }
        }

        /* Animation */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .fade-in {
            animation: fadeIn 0.5s ease-out;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .pulse {
            animation: pulse 2s infinite;
        }

        /* Step Indicator */
        .step-indicator {
            display: flex;
            justify-content: space-between;
            margin-bottom: 2rem;
            position: relative;
            counter-reset: step;
        }

        .step-indicator::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 2px;
            background: var(--border);
            z-index: 0;
            transform: translateY(-50%);
        }

        .step {
            position: relative;
            z-index: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 20%;
        }

        .step::before {
            counter-increment: step;
            content: counter(step);
            position: absolute;
            top: -40px;
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--gray);
        }

        .step-number {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: var(--border);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            margin-bottom: 0.5rem;
            transition: var(--transition);
            border: 2px solid transparent;
        }

        .dark-mode .step-number {
            background: #334155;
        }

        .step.active .step-number {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .step.completed .step-number {
            background: var(--success);
            color: white;
            border-color: var(--success);
        }

        .step-label {
            font-size: 0.875rem;
            font-weight: 500;
            text-align: center;
            color: var(--gray);
        }

        .step.active .step-label,
        .step.completed .step-label {
            color: var(--primary);
            font-weight: 600;
        }

        .step-content {
            display: none;
        }

        .step-content.active {
            display: block;
            animation: fadeIn 0.3s ease-out;
        }

        /* Pagination */
        .pagination {
            display: flex;
            justify-content: center;
            gap: 0.25rem;
            margin-top: 1.5rem;
            list-style: none;
        }

        .page-item {
            padding: 0.5rem 0.75rem;
            border: 1px solid var(--border);
            border-radius: var(--radius);
            cursor: pointer;
            transition: var(--transition);
            font-size: 0.875rem;
        }

        .dark-mode .page-item {
            border-color: #334155;
        }

        .page-item.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .page-item:hover:not(.active) {
            background: rgba(37, 99, 235, 0.1);
            border-color: var(--primary-light);
        }

        .page-item.disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Export */
        .export-buttons {
            display: flex;
            gap: 1rem;
            margin-top: 1.5rem;
            flex-wrap: wrap;
        }

        /* Modals */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(4px);
            -webkit-backdrop-filter: blur(4px);
        }

        .dark-mode .modal {
            background: rgba(15, 23, 42, 0.8);
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-lg);
            max-width: 800px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
        }

        .dark-mode .modal-content {
            background: var(--dark);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1.5rem;
            border-bottom: 1px solid var(--border);
        }

        .dark-mode .modal-header {
            border-color: #334155;
        }

        .modal-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--gray);
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: var(--transition);
        }

        .modal-close:hover {
            background: rgba(0, 0, 0, 0.1);
            color: var(--danger);
        }

        .dark-mode .modal-close:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .modal-body {
            padding: 1.5rem;
            flex: 1;
            overflow-y: auto;
        }

        .modal-footer {
            padding: 1.5rem;
            border-top: 1px solid var(--border);
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
        }

        .dark-mode .modal-footer {
            border-color: #334155;
        }

        /* Badges */
        .badge {
            display: inline-flex;
            align-items: center;
            gap: 0.375rem;
            padding: 0.25rem 0.5rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 500;
        }

        .badge-primary {
            background: rgba(37, 99, 235, 0.1);
            color: var(--primary);
            border: 1px solid rgba(37, 99, 235, 0.2);
        }

        .badge-success {
            background: rgba(22, 163, 74, 0.1);
            color: var(--success);
            border: 1px solid rgba(22, 163, 74, 0.2);
        }

        .badge-info {
            background: rgba(8, 145, 178, 0.1);
            color: var(--info);
            border: 1px solid rgba(8, 145, 178, 0.2);
        }

        .badge-warning {
            background: rgba(202, 138, 4, 0.1);
            color: var(--warning);
            border: 1px solid rgba(202, 138, 4, 0.2);
        }

        .badge-danger {
            background: rgba(220, 38, 38, 0.1);
            color: var(--danger);
            border: 1px solid rgba(220, 38, 38, 0.2);
        }

        /* Action buttons */
        .action-buttons {
            display: flex;
            gap: 0.5rem;
        }

        /* PAE Section */
        .pae-section {
            margin-bottom: 1.5rem;
            padding-bottom: 1.5rem;
            border-bottom: 1px dashed var(--border);
        }

        .dark-mode .pae-section {
            border-color: #334155;
        }

        .pae-section:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }

        .pae-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .pae-title i {
            color: var(--primary-light);
        }

        /* Stats */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .stat-card {
            background: white;
            border-radius: var(--radius);
            padding: 1.5rem;
            text-align: center;
            box-shadow: var(--shadow-sm);
            transition: var(--transition);
            border: 1px solid var(--border);
        }

        .dark-mode .stat-card {
            background: var(--dark);
            border-color: #334155;
        }

        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 0.5rem;
            line-height: 1;
        }

        .stat-label {
            color: var(--gray);
            font-size: 0.875rem;
            font-weight: 500;
        }

        /* Loading */
        .loading {
            text-align: center;
            padding: 2rem;
            color: var(--gray);
        }

        .loading i {
            font-size: 2rem;
            margin-bottom: 1rem;
            color: var(--primary);
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        /* Protocol Item */
        .protocol-item {
            margin-bottom: 1rem;
            padding: 1rem;
            border: 1px solid var(--border);
            border-radius: var(--radius);
            background: white;
            transition: var(--transition);
        }

        .dark-mode .protocol-item {
            background: #1e293b;
            border-color: #334155;
        }

        .protocol-item:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .protocol-title {
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .protocol-category {
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
            background: rgba(124, 58, 237, 0.1);
            color: var(--secondary);
            padding: 0.125rem 0.375rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            margin-bottom: 0.5rem;
        }

        .protocol-content {
            font-size: 0.9rem;
            line-height: 1.6;
            color: var(--dark);
        }

        .dark-mode .protocol-content {
            color: var(--light);
        }

        .external-link {
            color: var(--primary);
            text-decoration: none;
            border-bottom: 1px dotted var(--primary-light);
            transition: var(--transition);
        }

        .external-link:hover {
            color: var(--primary-dark);
            border-bottom-color: var(--primary-dark);
        }

        /* Mobile menu button */
        .mobile-menu-btn {
            display: none;
            background: none;
            border: none;
            color: var(--primary);
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0.5rem;
            border-radius: var(--radius);
        }

        .mobile-menu-btn:hover {
            background: rgba(37, 99, 235, 0.1);
        }

        /* Content section */
        .content-section {
            display: none;
        }

        .content-section.active {
            display: block;
            animation: fadeIn 0.3s ease-out;
        }

        /* Search tabs */
        .search-tabs {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }

        .search-tab {
            padding: 0.5rem 1rem;
            border: 1px solid var(--border);
            border-radius: var(--radius);
            background: white;
            color: var(--dark);
            font-size: 0.875rem;
            cursor: pointer;
            transition: var(--transition);
        }

        .dark-mode .search-tab {
            background: #1e293b;
            border-color: #334155;
            color: var(--light);
        }

        .search-tab.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .search-tab:hover:not(.active) {
            background: rgba(37, 99, 235, 0.1);
            border-color: var(--primary-light);
        }

        /* Medicine price card */
        .medicine-card {
            display: flex;
            gap: 1rem;
            padding: 1rem;
            border: 1px solid var(--border);
            border-radius: var(--radius);
            background: white;
            margin-bottom: 1rem;
        }

        .dark-mode .medicine-card {
            background: #1e293b;
            border-color: #334155;
        }

        .medicine-image {
            width: 80px;
            height: 80px;
            background: rgba(37, 99, 235, 0.1);
            border-radius: var(--radius);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--primary);
            font-size: 1.5rem;
        }

        .medicine-info {
            flex: 1;
        }

        .medicine-name {
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 0.25rem;
        }

        .medicine-active {
            font-size: 0.875rem;
            color: var(--gray);
            margin-bottom: 0.5rem;
        }

        .medicine-prices {
            display: flex;
            gap: 1rem;
            font-size: 0.875rem;
        }

        .price-item {
            display: flex;
            flex-direction: column;
        }

        .price-label {
            color: var(--gray);
            font-size: 0.75rem;
        }

        .price-value {
            font-weight: 600;
            color: var(--success);
        }

        /* Disease info */
        .disease-info {
            line-height: 1.6;
        }

        .disease-symptoms {
            margin: 0.75rem 0;
        }

        .symptoms-title {
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--primary);
        }

        .symptoms-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 0.5rem;
        }

        .symptom-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.875rem;
        }

        .symptom-item i {
            color: var(--warning);
            font-size: 0.75rem;
        }

        /* Treatment info */
        .treatment-info {
            line-height: 1.6;
        }

        .treatment-medications {
            margin: 0.75rem 0;
        }

        .treatment-title {
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--primary);
        }

        .medication-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.5rem;
            background: rgba(37, 99, 235, 0.05);
            border-radius: var(--radius);
            margin-bottom: 0.5rem;
            font-size: 0.875rem;
        }

        .dark-mode .medication-item {
            background: rgba(37, 99, 235, 0.1);
        }

        .medication-name {
            font-weight: 500;
        }

        .medication-dosage {
            color: var(--gray);
            font-size: 0.75rem;
        }

        /* Mobile improvements */
        .mobile-only {
            display: none;
        }

        .desktop-only {
            display: block;
        }

        @media (max-width: 768px) {
            .mobile-only {
                display: block;
            }
            .desktop-only {
                display: none;
            }
            .mobile-menu-text {
                display: none;
            }
            .search-input {
                font-size: 0.9rem;
            }
            .result-meta {
                flex-direction: column;
                gap: 0.25rem;
            }
            .result-actions {
                flex-wrap: wrap;
            }
            .btn-icon {
                padding: 0.625rem;
            }
            .card-header {
                flex-wrap: wrap;
            }
            .card-actions {
                order: 1;
                width: 100%;
            }
            .card-title {
                order: 2;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-logo">HM</div>
                <h1>Sistema Médico</h1>
            </div>
            <ul class="sidebar-menu">
                <li><a href="#" class="active" data-tab="pacientes"><i class="fas fa-user-injured"></i> Gestión de Pacientes</a></li>
                <li><a href="#" data-tab="pae"><i class="fas fa-notes-medical"></i> Proceso de Atención (PAE)</a></li>
                <li><a href="#" data-tab="busquedas"><i class="fas fa-search"></i> Búsquedas Médicas</a></li>
                <li><a href="#" data-tab="estadisticas"><i class="fas fa-chart-line"></i> Estadísticas</a></li>
            </ul>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <div class="header">
                <button class="mobile-menu-btn">
                    <i class="fas fa-bars"></i>
                    <span class="mobile-menu-text">Menú</span>
                </button>
                <h2 id="page-title">Gestión de Pacientes</h2>
                <div class="header-actions">
                    <button class="theme-toggle" id="theme-toggle">
                        <i class="fas fa-moon"></i>
                        <span>Modo Oscuro</span>
                    </button>
                    <div class="user-profile">
                        <div class="user-avatar">EN</div>
                        <div class="user-info">
                            <span class="user-name">Enfermera</span>
                            <span class="user-role">Profesional de Salud</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Gestión de Pacientes -->
            <div id="pacientes" class="content-section active">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title"><i class="fas fa-user-plus"></i> Registrar Nuevo Paciente</h3>
                    </div>
                    <form id="patient-form">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="patient-name">Nombre Completo *</label>
                                <input type="text" class="form-control" id="patient-name" required>
                            </div>
                            <div class="form-group">
                                <label for="patient-age">Edad *</label>
                                <input type="number" class="form-control" id="patient-age" min="0" max="150" required>
                            </div>
                            <div class="form-group">
                                <label for="patient-gender">Género *</label>
                                <select class="form-control" id="patient-gender" required>
                                    <option value="">Seleccionar...</option>
                                    <option value="Masculino">Masculino</option>
                                    <option value="Femenino">Femenino</option>
                                    <option value="Otro">Otro</option>
                                </select>
                            </div>
                        </div>

                        <h4 style="margin: 1.5rem 0 1rem; color: var(--primary); font-weight: 600;">Signos Vitales</h4>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="patient-temp">Temperatura (°C) *</label>
                                <input type="number" class="form-control" id="patient-temp" step="0.1" min="34" max="42" required>
                            </div>
                            <div class="form-group">
                                <label for="patient-heart-rate">Frecuencia Cardíaca (ppm) *</label>
                                <input type="number" class="form-control" id="patient-heart-rate" min="40" max="200" required>
                            </div>
                            <div class="form-group">
                                <label for="patient-pressure">Presión Arterial *</label>
                                <input type="text" class="form-control" id="patient-pressure" placeholder="120/80" required>
                            </div>
                            <div class="form-group">
                                <label for="patient-saturation">Saturación de O₂ (%) *</label>
                                <input type="number" class="form-control" id="patient-saturation" min="80" max="100" required>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="patient-observations">Observaciones Generales</label>
                            <textarea class="form-control" id="patient-observations" rows="3"></textarea>
                        </div>

                        <div class="form-group">
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save"></i> Registrar Paciente
                            </button>
                            <button type="button" class="btn btn-outline" id="clear-form">
                                <i class="fas fa-eraser"></i> Limpiar
                            </button>
                        </div>
                    </form>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title"><i class="fas fa-users"></i> Pacientes Registrados</h3>
                        <div class="card-actions">
                            <button class="btn btn-success btn-sm" id="export-patients">
                                <i class="fas fa-file-export"></i> Exportar
                            </button>
                        </div>
                    </div>
                    <div class="table-container">
                        <table id="patients-table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Nombre</th>
                                    <th>Edad</th>
                                    <th>Género</th>
                                    <th>Temp</th>
                                    <th>Frec. Cardíaca</th>
                                    <th>Presión</th>
                                    <th>Saturación</th>
                                    <th>Estado</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="patients-table-body">
                                <!-- Data will be populated by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                    <ul class="pagination" id="patients-pagination">
                        <!-- Pagination will be generated by JavaScript -->
                    </ul>
                </div>
            </div>

            <!-- Proceso de Atención de Enfermería (PAE) -->
            <div id="pae" class="content-section">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title"><i class="fas fa-notes-medical"></i> Proceso de Atención de Enfermería (PAE)</h3>
                    </div>
                    <form id="pae-form">
                        <div class="step-indicator">
                            <div class="step active" data-step="1">
                                <div class="step-number">1</div>
                                <div class="step-label">Valoración</div>
                            </div>
                            <div class="step" data-step="2">
                                <div class="step-number">2</div>
                                <div class="step-label">Diagnóstico</div>
                            </div>
                            <div class="step" data-step="3">
                                <div class="step-number">3</div>
                                <div class="step-label">Planificación</div>
                            </div>
                            <div class="step" data-step="4">
                                <div class="step-number">4</div>
                                <div class="step-label">Ejecución</div>
                            </div>
                            <div class="step" data-step="5">
                                <div class="step-number">5</div>
                                <div class="step-label">Evaluación</div>
                            </div>
                        </div>

                        <!-- Step 1: Valoración -->
                        <div class="step-content active" data-step="1">
                            <div class="pae-section">
                                <h4 class="pae-title"><i class="fas fa-search"></i> Valoración</h4>
                                <div class="form-group">
                                    <label for="pae-patient">Seleccionar Paciente *</label>
                                    <select class="form-control" id="pae-patient" required>
                                        <option value="">Seleccionar paciente...</option>
                                        <!-- Options will be populated by JavaScript -->
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="pae-assessment">Datos de Valoración *</label>
                                    <textarea class="form-control" id="pae-assessment" rows="4" placeholder="Describa los hallazgos de la valoración: signos vitales, estado físico, emocional, etc." required></textarea>
                                </div>
                                <div class="form-group">
                                    <label for="pae-date">Fecha y Hora</label>
                                    <input type="datetime-local" class="form-control" id="pae-date">
                                </div>
                            </div>
                            <div class="form-group">
                                <button type="button" class="btn btn-primary next-step">
                                    <i class="fas fa-arrow-right"></i> Siguiente
                                </button>
                            </div>
                        </div>

                        <!-- Step 2: Diagnóstico -->
                        <div class="step-content" data-step="2">
                            <div class="pae-section">
                                <h4 class="pae-title"><i class="fas fa-diagnoses"></i> Diagnóstico de Enfermería</h4>
                                <div class="form-group">
                                    <label for="pae-diagnosis">Diagnóstico Principal *</label>
                                    <input type="text" class="form-control" id="pae-diagnosis" placeholder="Ej: Riesgo de infección" required>
                                </div>
                                <div class="form-group">
                                    <label for="pae-diagnosis-details">Detalles del Diagnóstico</label>
                                    <textarea class="form-control" id="pae-diagnosis-details" rows="3" placeholder="Justificación del diagnóstico, factores de riesgo, etc."></textarea>
                                </div>
                                <div class="form-group">
                                    <label for="pae-priority">Prioridad</label>
                                    <select class="form-control" id="pae-priority">
                                        <option value="Alta">Alta</option>
                                        <option value="Media">Media</option>
                                        <option value="Baja">Baja</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-group">
                                <button type="button" class="btn btn-outline prev-step">
                                    <i class="fas fa-arrow-left"></i> Anterior
                                </button>
                                <button type="button" class="btn btn-primary next-step">
                                    <i class="fas fa-arrow-right"></i> Siguiente
                                </button>
                            </div>
                        </div>

                        <!-- Step 3: Planificación -->
                        <div class="step-content" data-step="3">
                            <div class="pae-section">
                                <h4 class="pae-title"><i class="fas fa-tasks"></i> Planificación</h4>
                                <div class="form-group">
                                    <label>Objetivos</label>
                                    <div id="objectives-container">
                                        <div class="objective-item" style="display: flex; gap: 0.5rem; margin-bottom: 0.5rem;">
                                            <input type="text" class="form-control" placeholder="Objetivo específico" style="flex: 1;">
                                            <select class="form-control" style="width: 120px;">
                                                <option value="Corto plazo">Corto plazo</option>
                                                <option value="Largo plazo">Largo plazo</option>
                                            </select>
                                            <button type="button" class="btn btn-danger remove-objective" style="padding: 0.5rem 0.75rem;">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        </div>
                                    </div>
                                    <button type="button" class="btn btn-sm btn-success" id="add-objective" style="margin-top: 0.5rem;">
                                        <i class="fas fa-plus"></i> Agregar Objetivo
                                    </button>
                                </div>
                                <div class="form-group">
                                    <label for="pae-plan">Plan de Cuidados</label>
                                    <textarea class="form-control" id="pae-plan" rows="4" placeholder="Describa las intervenciones planificadas para alcanzar los objetivos"></textarea>
                                </div>
                            </div>
                            <div class="form-group">
                                <button type="button" class="btn btn-outline prev-step">
                                    <i class="fas fa-arrow-left"></i> Anterior
                                </button>
                                <button type="button" class="btn btn-primary next-step">
                                    <i class="fas fa-arrow-right"></i> Siguiente
                                </button>
                            </div>
                        </div>

                        <!-- Step 4: Ejecución -->
                        <div class="step-content" data-step="4">
                            <div class="pae-section">
                                <h4 class="pae-title"><i class="fas fa-hands"></i> Ejecución</h4>
                                <div class="form-group">
                                    <label>Intervenciones Realizadas</label>
                                    <div id="interventions-container">
                                        <div class="intervention-item" style="margin-bottom: 1rem; padding: 1rem; border: 1px solid var(--border); border-radius: var(--radius);">
                                            <div style="display: flex; gap: 0.5rem; margin-bottom: 0.5rem;">
                                                <input type="text" class="form-control" placeholder="Descripción de la intervención" style="flex: 1;">
                                                <input type="time" class="form-control" style="width: 120px;" placeholder="Hora">
                                                <button type="button" class="btn btn-danger remove-intervention" style="padding: 0.5rem 0.75rem;">
                                                    <i class="fas fa-trash"></i>
                                                </button>
                                            </div>
                                            <div class="form-group">
                                                <textarea class="form-control" rows="2" placeholder="Detalles adicionales, respuesta del paciente, etc."></textarea>
                                            </div>
                                        </div>
                                    </div>
                                    <button type="button" class="btn btn-sm btn-success" id="add-intervention" style="margin-top: 0.5rem;">
                                        <i class="fas fa-plus"></i> Agregar Intervención
                                    </button>
                                </div>
                            </div>
                            <div class="form-group">
                                <button type="button" class="btn btn-outline prev-step">
                                    <i class="fas fa-arrow-left"></i> Anterior
                                </button>
                                <button type="button" class="btn btn-primary next-step">
                                    <i class="fas fa-arrow-right"></i> Siguiente
                                </button>
                            </div>
                        </div>

                        <!-- Step 5: Evaluación -->
                        <div class="step-content" data-step="5">
                            <div class="pae-section">
                                <h4 class="pae-title"><i class="fas fa-check-circle"></i> Evaluación</h4>
                                <div class="form-group">
                                    <label for="pae-evaluation">Evaluación de Resultados</label>
                                    <textarea class="form-control" id="pae-evaluation" rows="4" placeholder="Evalúe el progreso hacia los objetivos, cambios en el estado del paciente, efectividad de las intervenciones"></textarea>
                                </div>
                                <div class="form-group">
                                    <label for="pae-outcome">Resultado</label>
                                    <select class="form-control" id="pae-outcome">
                                        <option value="Objetivo alcanzado">Objetivo alcanzado</option>
                                        <option value="Progreso parcial">Progreso parcial</option>
                                        <option value="Sin progreso">Sin progreso</option>
                                        <option value="Empeoramiento">Empeoramiento</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="pae-recommendations">Recomendaciones</label>
                                    <textarea class="form-control" id="pae-recommendations" rows="3" placeholder="Recomendaciones para el cuidado continuo, modificaciones al plan, etc."></textarea>
                                </div>
                            </div>
                            <div class="form-group">
                                <button type="button" class="btn btn-outline prev-step">
                                    <i class="fas fa-arrow-left"></i> Anterior
                                </button>
                                <button type="submit" class="btn btn-success">
                                    <i class="fas fa-save"></i> Guardar PAE Completo
                                </button>
                            </div>
                        </div>
                    </form>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title"><i class="fas fa-clipboard-list"></i> PAEs Registrados</h3>
                        <div class="card-actions">
                            <button class="btn btn-success btn-sm" id="export-pae">
                                <i class="fas fa-file-export"></i> Exportar
                            </button>
                        </div>
                    </div>
                    <div class="table-container">
                        <table id="pae-table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Paciente</th>
                                    <th>Diagnóstico</th>
                                    <th>Fecha</th>
                                    <th>Estado</th>
                                    <th>Prioridad</th>
                                    <th>Resultado</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody id="pae-table-body">
                                <!-- Data will be populated by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                    <ul class="pagination" id="pae-pagination">
                        <!-- Pagination will be generated by JavaScript -->
                    </ul>
                </div>
            </div>

            <!-- Búsquedas Médicas -->
            <div id="busquedas" class="content-section">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title"><i class="fas fa-search"></i> Búsqueda de Información Médica</h3>
                    </div>
                    
                    <div class="search-container">
                        <input type="text" class="search-input" id="search-input" placeholder="Buscar enfermedades, medicamentos, tratamientos...">
                        <button class="btn btn-primary" id="search-button">
                            <i class="fas fa-search"></i> Buscar
                        </button>
                    </div>

                    <div class="search-tabs">
                        <div class="search-tab active" data-source="wikipedia">Wikipedia</div>
                        <div class="search-tab" data-source="medicamentos">Medicamentos</div>
                        <div class="search-tab" data-source="enfermedades">Enfermedades</div>
                        <div class="search-tab" data-source="tratamientos">Tratamientos</div>
                        <div class="search-tab" data-source="protocolos">Protocolos</div>
                    </div>

                    <div id="search-results" class="search-results">
                        <div class="alert alert-info">
                            <i class="fas fa-info-circle alert-icon"></i>
                            <div>
                                <strong>Búsqueda Médica Integral</strong>
                                <p>Busque información sobre enfermedades, medicamentos, tratamientos y protocolos médicos. Seleccione una categoría para obtener resultados específicos.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Estadísticas -->
            <div id="estadisticas" class="content-section">
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="total-patients">0</div>
                        <div class="stat-label">Pacientes Registrados</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="total-pae">0</div>
                        <div class="stat-label">PAEs Registrados</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="avg-temp">0°C</div>
                        <div class="stat-label">Temp. Promedio</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="avg-heart-rate">0 ppm</div>
                        <div class="stat-label">Frec. Cardíaca Prom.</div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title"><i class="fas fa-chart-line"></i> Gráficos de Pacientes</h3>
                    </div>
                    <div class="canvas-container">
                        <div class="canvas-wrapper">
                            <h4 style="margin: 0 0 0.5rem 0; color: var(--primary); font-weight: 600;">Temperatura</h4>
                            <div class="chart-container" id="temperature-chart">
                                <div class="chart-y-label">°C</div>
                            </div>
                        </div>
                        <div class="canvas-wrapper">
                            <h4 style="margin: 0 0 0.5rem 0; color: var(--primary); font-weight: 600;">Frecuencia Cardíaca</h4>
                            <div class="chart-container" id="heart-rate-chart">
                                <div class="chart-y-label">ppm</div>
                            </div>
                        </div>
                        <div class="canvas-wrapper">
                            <h4 style="margin: 0 0 0.5rem 0; color: var(--primary); font-weight: 600;">Saturación de O₂</h4>
                            <div class="chart-container" id="saturation-chart">
                                <div class="chart-y-label">%</div>
                            </div>
                        </div>
                        <div class="canvas-wrapper">
                            <h4 style="margin: 0 0 0.5rem 0; color: var(--primary); font-weight: 600;">Presión Arterial</h4>
                            <div class="chart-container" id="pressure-chart">
                                <div class="chart-y-label">mmHg</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title"><i class="fas fa-file-export"></i> Exportar Datos</h3>
                    </div>
                    <div class="export-buttons">
                        <button class="btn btn-primary" id="export-all-patients">
                            <i class="fas fa-file-csv"></i> Exportar Pacientes (CSV)
                        </button>
                        <button class="btn btn-primary" id="export-all-pae">
                            <i class="fas fa-file-csv"></i> Exportar PAEs (CSV)
                        </button>
                        <button class="btn btn-secondary" id="export-all-json">
                            <i class="fas fa-file-code"></i> Exportar Todo (JSON)
                        </button>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- View PAE Modal -->
    <div class="modal" id="view-pae-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title"><i class="fas fa-notes-medical"></i> Detalles del PAE</h3>
                <button class="modal-close" id="close-view-pae">&times;</button>
            </div>
            <div class="modal-body" id="pae-details-content">
                <!-- Content will be populated by JavaScript -->
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="close-view-pae-btn">Cerrar</button>
            </div>
        </div>
    </div>

    <!-- View Patient Modal -->
    <div class="modal" id="view-patient-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title"><i class="fas fa-user"></i> Detalles del Paciente</h3>
                <button class="modal-close" id="close-view-patient">&times;</button>
            </div>
            <div class="modal-body" id="patient-details-content">
                <!-- Content will be populated by JavaScript -->
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="close-view-patient-btn">Cerrar</button>
            </div>
        </div>
    </div>

    <script>
        // Data storage
        let patients = JSON.parse(localStorage.getItem('patients')) || [];
        let paeRecords = JSON.parse(localStorage.getItem('paeRecords')) || [];
        let nextPatientId = parseInt(localStorage.getItem('nextPatientId')) || 1;
        let nextPaeId = parseInt(localStorage.getItem('nextPaeId')) || 1;

        // Enhanced medical data
        const medicalData = {
            medications: [
                {
                    name: "Paracetamol",
                    active: "Acetaminofén",
                    presentation: "Tabletas 500mg",
                    priceRange: { min: 2.50, max: 5.00 },
                    indications: "Dolor leve a moderado, fiebre",
                    contraindications: "Hipersensibilidad al principio activo, insuficiencia hepática grave",
                    sideEffects: ["Náuseas", "Vómitos", "Alteraciones hepáticas con sobredosis"]
                },
                {
                    name: "Ibuprofeno",
                    active: "Ibuprofeno",
                    presentation: "Tabletas 200mg",
                    priceRange: { min: 3.00, max: 6.50 },
                    indications: "Dolor, inflamación, fiebre",
                    contraindications: "Úlcera péptica activa, insuficiencia renal grave, alergia a AINEs",
                    sideEffects: ["Dolor abdominal", "Náuseas", "Úlcera gástrica", "Alteraciones renales"]
                },
                {
                    name: "Omeprazol",
                    active: "Omeprazol",
                    presentation: "Cápsulas 20mg",
                    priceRange: { min: 4.00, max: 8.00 },
                    indications: "Enfermedad por reflujo gastroesofágico, úlcera gástrica",
                    contraindications: "Hipersensibilidad al principio activo, combinación con atazanavir",
                    sideEffects: ["Dolor de cabeza", "Diarrea", "Náuseas", "Flatulencia"]
                },
                {
                    name: "Loratadina",
                    active: "Loratadina",
                    presentation: "Tabletas 10mg",
                    priceRange: { min: 3.50, max: 7.00 },
                    indications: "Rinitis alérgica, urticaria",
                    contraindications: "Hipersensibilidad al principio activo",
                    sideEffects: ["Cefalea", "Somnolencia leve", "Secura de boca"]
                },
                {
                    name: "Amoxicilina",
                    active: "Amoxicilina",
                    presentation: "Cápsulas 500mg",
                    priceRange: { min: 5.00, max: 12.00 },
                    indications: "Infecciones bacterianas (respiratorias, urinarias, cutáneas)",
                    contraindications: "Alergia a penicilinas, mononucleosis infecciosa",
                    sideEffects: ["Diarrea", "Náuseas", "Vómitos", "Reacciones alérgicas"]
                }
            ],
            
            diseases: [
                {
                    name: "Diabetes Mellitus",
                    description: "Enfermedad crónica caracterizada por niveles elevados de glucosa en sangre debido a defectos en la secreción o acción de la insulina.",
                    symptoms: ["Poliuria", "Polidipsia", "Pérdida de peso", "Fatiga", "Visión borrosa"],
                    complications: ["Neuropatía diabética", "Retinopatía diabética", "Nefropatía diabética", "Pie diabético", "Enfermedad cardiovascular"],
                    diagnosis: ["Glucemia en ayunas ≥ 126 mg/dL", "HbA1c ≥ 6.5%", "Glucemia al azar ≥ 200 mg/dL con síntomas"],
                    prevention: ["Control de peso", "Ejercicio regular", "Dieta saludable", "Control de presión arterial"]
                },
                {
                    name: "Hipertensión Arterial",
                    description: "Aumento sostenido de la presión arterial en las arterias, generalmente definida como presión arterial sistólica ≥ 140 mmHg y/o diastólica ≥ 90 mmHg.",
                    symptoms: ["Generalmente asintomática", "Cefalea", "Mareos", "Epistaxis", "Palpitaciones", "Visión borrosa"],
                    complications: ["Enfermedad cardiovascular", "Accidente cerebrovascular", "Insuficiencia cardíaca", "Enfermedad renal crónica", "Retinopatía hipertensiva"],
                    diagnosis: ["Medición de presión arterial en múltiples ocasiones", "Presión arterial promedio ≥ 140/90 mmHg"],
                    prevention: ["Dieta baja en sodio", "Ejercicio regular", "Control de peso", "Limitación del consumo de alcohol", "Evitar el tabaco"]
                },
                {
                    name: "Neumonía",
                    description: "Infección inflamatoria aguda del parénquima pulmonar, generalmente causada por bacterias, virus o hongos.",
                    symptoms: ["Fiebre", "Tos productiva", "Dolor torácico", "Disnea", "Escalofríos", "Fatiga", "Sibilancias"],
                    complications: ["Absceso pulmonar", "Empiema", "Sepsis", "Insuficiencia respiratoria", "Shock séptico"],
                    diagnosis: ["Examen físico", "Radiografía de tórax", "Análisis de sangre", "Cultivo de esputo"],
                    prevention: ["Vacunación contra neumococo e influenza", "Higiene de manos", "Evitar el tabaco", "Fortalecimiento del sistema inmunológico"]
                },
                {
                    name: "Asma",
                    description: "Enfermedad inflamatoria crónica de las vías respiratorias caracterizada por obstrucción reversible del flujo de aire y hiperreactividad bronquial.",
                    symptoms: ["Disnea", "Sibilancias", "Opresión torácica", "Tos nocturna", "Tos seca", "Dificultad para respirar"],
                    complications: ["Ataques asmáticos graves", "Insuficiencia respiratoria", "Neumotórax", "Cor pulmonale", "Intubación y ventilación mecánica"],
                    diagnosis: ["Pruebas de función pulmonar", "Prueba de reversibilidad bronquial", "Medición del flujo espiratorio máximo", "Pruebas de provocación"],
                    prevention: ["Evitar desencadenantes", "Uso adecuado de medicamentos", "Plan de acción para el asma", "Control del ambiente"]
                }
            ],
            
            treatments: [
                {
                    condition: "Dolor Agudo",
                    firstLine: [
                        { name: "Paracetamol", dosage: "500-1000mg cada 6-8 horas", notes: "Máximo 4g/día" },
                        { name: "Ibuprofeno", dosage: "200-400mg cada 6-8 horas", notes: "Evitar en úlcera péptica" }
                    ],
                    secondLine: [
                        { name: "Diclofenaco", dosage: "50mg cada 8 horas", notes: "Riesgo de efectos gastrointestinales" },
                        { name: "Tramadol", dosage: "50mg cada 4-6 horas", notes: "Controlado, riesgo de dependencia" }
                    ],
                    notes: "Comenzar con analgésicos no opioides. Considerar opioides solo para dolor severo y de corta duración."
                },
                {
                    condition: "Infección Urinaria",
                    firstLine: [
                        { name: "Nitrofurantoína", dosage: "100mg cada 12 horas", duration: "5-7 días", notes: "Evitar en insuficiencia renal" },
                        { name: "Fosfomicina", dosage: "3g en dosis única", duration: "1 dosis", notes: "Conveniente para cistitis no complicada" }
                    ],
                    secondLine: [
                        { name: "Ciprofloxacino", dosage: "250-500mg cada 12 horas", duration: "3 días", notes: "Reservar para casos complicados" },
                        { name: "Amoxicilina-Ácido Clavulánico", dosage: "500/125mg cada 8 horas", duration: "5-7 días", notes: "Considerar sensibilidad bacteriana" }
                    ],
                    notes: "Obtener urocultivo en casos recurrentes o complicados. Aumentar ingesta de líquidos."
                },
                {
                    condition: "Reflujo Gastroesofágico",
                    firstLine: [
                        { name: "Omeprazol", dosage: "20mg diarios", duration: "4-8 semanas", notes: "Antes del desayuno" },
                        { name: "Ranitidina", dosage: "150mg cada 12 horas", duration: "4-8 semanas", notes: "Considerar seguridad actual" }
                    ],
                    lifestyle: [
                        "Evitar comidas copiosas",
                        "No acostarse inmediatamente después de comer",
                        "Elevar la cabecera de la cama",
                        "Perder peso si hay sobrepeso",
                        "Evitar alimentos desencadenantes"
                    ],
                    notes: "Mantener tratamiento durante tiempo suficiente. Considerar endoscopia en casos refractarios."
                }
            ],
            
            protocols: [
                {
                    title: "Reanimación Cardiopulmonar (RCP) Básica",
                    category: "Emergencias",
                    steps: [
                        "Verifique la escena y la seguridad",
                        "Compruebe la respuesta del paciente",
                        "Si no hay respuesta, llame al servicio de emergencias",
                        "Comience las compresiones torácicas: 100-120 compresiones por minuto, profundidad de 5-6 cm",
                        "Relación 30:2 compresiones-ventilaciones si está capacitado",
                        "Continúe hasta que llegue ayuda o el paciente muestre signos de vida"
                    ],
                    notes: "Use desfibrilador automático externo (DEA) si está disponible. Minimice las interrupciones en las compresiones."
                },
                {
                    title: "Manejo de la Hipertensión Arterial",
                    category: "Cardiología",
                    steps: [
                        "Evaluación: tomar presión arterial en ambos brazos",
                        "Si PA ≥ 140/90 mmHg, iniciar tratamiento no farmacológico",
                        "Tratamiento no farmacológico: dieta DASH, ejercicio, reducción de sodio",
                        "Si PA persiste elevada, iniciar farmacoterapia",
                        "Controlar PA cada 1-2 semanas hasta lograr metas",
                        "Educar al paciente sobre adherencia al tratamiento"
                    ],
                    medications: ["IECA", "ARA II", "Bloqueadores del canal de calcio", "Diuréticos"],
                    goals: "PA < 140/90 mmHg (o < 130/80 mmHg en diabetes o enfermedad renal)"
                },
                {
                    title: "Protocolo de Diabetes Mellitus Tipo 2",
                    category: "Endocrinología",
                    steps: [
                        "Diagnóstico: glucemia en ayunas ≥ 126 mg/dL, HbA1c ≥ 6.5%",
                        "Objetivos terapéuticos: HbA1c < 7%, PA < 140/90 mmHg",
                        "Tratamiento inicial: metformina + cambios en estilo de vida",
                        "Monitorización: glucemia capilar, HbA1c cada 3-6 meses",
                        "Prevención de complicaciones: evaluación anual de pies, ojos, función renal",
                        "Educar sobre reconocimiento e manejo de hipoglucemia"
                    ],
                    notes: "Individualizar metas terapéuticas según edad, comorbilidades y expectativa de vida."
                }
            ]
        };

        // DOM Elements
        const themeToggle = document.getElementById('theme-toggle');
        const pageTitle = document.getElementById('page-title');
        const sidebarMenu = document.querySelector('.sidebar-menu');
        const mobileMenuBtn = document.querySelector('.mobile-menu-btn');
        
        // Content sections
        const contentSections = document.querySelectorAll('.content-section');
        const pacientesSection = document.getElementById('pacientes');
        const paeSection = document.getElementById('pae');
        const busquedasSection = document.getElementById('busquedas');
        const estadisticasSection = document.getElementById('estadisticas');

        // Patient form
        const patientForm = document.getElementById('patient-form');
        const clearFormBtn = document.getElementById('clear-form');
        const exportPatientsBtn = document.getElementById('export-patients');

        // PAE form
        const paeForm = document.getElementById('pae-form');
        const paePatientSelect = document.getElementById('pae-patient');
        const addObjectiveBtn = document.getElementById('add-objective');
        const addObjectiveContainer = document.getElementById('objectives-container');
        const addInterventionBtn = document.getElementById('add-intervention');
        const addInterventionsContainer = document.getElementById('interventions-container');
        const exportPaeBtn = document.getElementById('export-pae');

        // Search
        const searchInput = document.getElementById('search-input');
        const searchButton = document.getElementById('search-button');
        const searchResults = document.getElementById('search-results');
        const searchTabs = document.querySelectorAll('.search-tab');

        // Statistics
        const totalPatientsEl = document.getElementById('total-patients');
        const totalPaeEl = document.getElementById('total-pae');
        const avgTempEl = document.getElementById('avg-temp');
        const avgHeartRateEl = document.getElementById('avg-heart-rate');

        // Modals
        const viewPaeModal = document.getElementById('view-pae-modal');
        const closeViewPae = document.getElementById('close-view-pae');
        const closeViewPaeBtn = document.getElementById('close-view-pae-btn');
        const paeDetailsContent = document.getElementById('pae-details-content');

        const viewPatientModal = document.getElementById('view-patient-modal');
        const closeViewPatient = document.getElementById('close-view-patient');
        const closeViewPatientBtn = document.getElementById('close-view-patient-btn');
        const patientDetailsContent = document.getElementById('patient-details-content');

        // Export buttons
        const exportAllPatientsBtn = document.getElementById('export-all-patients');
        const exportAllPaeBtn = document.getElementById('export-all-pae');
        const exportAllJsonBtn = document.getElementById('export-all-json');

        // Canvas elements
        const temperatureChart = document.getElementById('temperature-chart');
        const heartRateChart = document.getElementById('heart-rate-chart');
        const saturationChart = document.getElementById('saturation-chart');
        const pressureChart = document.getElementById('pressure-chart');

        // Initialize application
        document.addEventListener('DOMContentLoaded', function() {
            // Load saved data
            loadPatients();
            loadPaeRecords();
            updatePatientSelect();
            updateStats();
            renderTemperatureChart();
            renderHeartRateChart();
            renderSaturationChart();
            renderPressureChart();

            // Set current date and time for PAE form
            document.getElementById('pae-date').value = new Date().toISOString().slice(0, 16);

            // Event Listeners
            themeToggle.addEventListener('click', toggleTheme);
            sidebarMenu.addEventListener('click', handleSidebarNavigation);
            mobileMenuBtn.addEventListener('click', toggleMobileMenu);
            
            patientForm.addEventListener('submit', handlePatientSubmit);
            clearFormBtn.addEventListener('click', clearPatientForm);
            exportPatientsBtn.addEventListener('click', exportPatients);

            paeForm.addEventListener('submit', handlePaeSubmit);
            addObjectiveBtn.addEventListener('click', addObjective);
            addInterventionBtn.addEventListener('click', addIntervention);

            // Step navigation for PAE
            document.querySelectorAll('.prev-step').forEach(btn => {
                btn.addEventListener('click', goToPreviousStep);
            });

            document.querySelectorAll('.next-step').forEach(btn => {
                btn.addEventListener('click', goToNextStep);
            });

            // Search functionality
            searchButton.addEventListener('click', performSearch);
            searchInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    performSearch();
                }
            });

            // Tab switching for search results
            searchTabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    searchTabs.forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    performSearch();
                });
            });

            // Modal close buttons
            closeViewPae.addEventListener('click', () => viewPaeModal.classList.remove('active'));
            closeViewPaeBtn.addEventListener('click', () => viewPaeModal.classList.remove('active'));
            closeViewPatient.addEventListener('click', () => viewPatientModal.classList.remove('active'));
            closeViewPatientBtn.addEventListener('click', () => viewPatientModal.classList.remove('active'));

            // Export buttons
            exportAllPatientsBtn.addEventListener('click', exportAllPatients);
            exportAllPaeBtn.addEventListener('click', exportAllPae);
            exportAllJsonBtn.addEventListener('click', exportAllData);

            // Remove objective and intervention buttons (delegated events)
            addObjectiveContainer.addEventListener('click', function(e) {
                if (e.target.classList.contains('remove-objective') || e.target.closest('.remove-objective')) {
                    const button = e.target.classList.contains('remove-objective') ? e.target : e.target.closest('.remove-objective');
                    const item = button.closest('.objective-item');
                    if (addObjectiveContainer.children.length > 1) {
                        item.remove();
                    }
                }
            });

            addInterventionsContainer.addEventListener('click', function(e) {
                if (e.target.classList.contains('remove-intervention') || e.target.closest('.remove-intervention')) {
                    const button = e.target.classList.contains('remove-intervention') ? e.target : e.target.closest('.remove-intervention');
                    const item = button.closest('.intervention-item');
                    if (addInterventionsContainer.children.length > 1) {
                        item.remove();
                    }
                }
            });

            // Check for saved theme preference
            if (localStorage.getItem('darkMode') === 'true') {
                document.body.classList.add('dark-mode');
                themeToggle.innerHTML = '<i class="fas fa-sun"></i><span>Modo Claro</span>';
            }
        });

        // Theme Toggle Function
        function toggleTheme() {
            document.body.classList.toggle('dark-mode');
            if (document.body.classList.contains('dark-mode')) {
                themeToggle.innerHTML = '<i class="fas fa-sun"></i><span>Modo Claro</span>';
                localStorage.setItem('darkMode', 'true');
            } else {
                themeToggle.innerHTML = '<i class="fas fa-moon"></i><span>Modo Oscuro</span>';
                localStorage.setItem('darkMode', 'false');
            }
        }

        // Mobile Menu Toggle
        function toggleMobileMenu() {
            document.querySelector('.sidebar').classList.toggle('active');
        }

        // Sidebar Navigation
        function handleSidebarNavigation(e) {
            e.preventDefault();
            if (e.target.tagName === 'A' || e.target.parentElement.tagName === 'A') {
                const link = e.target.tagName === 'A' ? e.target : e.target.parentElement;
                const tab = link.getAttribute('data-tab');
                
                // Update active state
                document.querySelectorAll('.sidebar-menu a').forEach(item => {
                    item.classList.remove('active');
                });
                link.classList.add('active');
                
                // Hide mobile menu
                document.querySelector('.sidebar').classList.remove('active');
                
                // Show selected section
                contentSections.forEach(section => {
                    section.classList.remove('active');
                });
                
                document.getElementById(tab).classList.add('active');
                
                // Update page title
                switch(tab) {
                    case 'pacientes':
                        pageTitle.textContent = 'Gestión de Pacientes';
                        break;
                    case 'pae':
                        pageTitle.textContent = 'Proceso de Atención de Enfermería (PAE)';
                        break;
                    case 'busquedas':
                        pageTitle.textContent = 'Búsquedas Médicas';
                        break;
                    case 'estadisticas':
                        pageTitle.textContent = 'Estadísticas y Reportes';
                        break;
                }
            }
        }

        // Patient Form Functions
        function handlePatientSubmit(e) {
            e.preventDefault();
            
            // Validate form
            const name = document.getElementById('patient-name').value.trim();
            const age = document.getElementById('patient-age').value;
            const gender = document.getElementById('patient-gender').value;
            const temp = document.getElementById('patient-temp').value;
            const heartRate = document.getElementById('patient-heart-rate').value;
            const pressure = document.getElementById('patient-pressure').value;
            const saturation = document.getElementById('patient-saturation').value;
            const observations = document.getElementById('patient-observations').value.trim();
            
            if (!name || !age || !gender || !temp || !heartRate || !pressure || !saturation) {
                showAlert('Por favor complete todos los campos obligatorios.', 'danger');
                return;
            }
            
            // Validate pressure format
            const pressureRegex = /^\d+\/\d+$/;
            if (!pressureRegex.test(pressure)) {
                showAlert('El formato de la presión arterial debe ser como "120/80".', 'danger');
                return;
            }
            
            // Create patient object
            const patient = {
                id: nextPatientId++,
                name: name,
                age: parseInt(age),
                gender: gender,
                vitalSigns: {
                    temperature: parseFloat(temp),
                    heartRate: parseInt(heartRate),
                    pressure: pressure,
                    saturation: parseInt(saturation)
                },
                observations: observations,
                date: new Date().toISOString()
            };
            
            // Add to patients array
            patients.push(patient);
            
            // Save to localStorage
            savePatients();
            
            // Update UI
            loadPatients();
            updatePatientSelect();
            updateStats();
            renderTemperatureChart();
            renderHeartRateChart();
            renderSaturationChart();
            renderPressureChart();
            
            // Reset form
            patientForm.reset();
            document.getElementById('pae-date').value = new Date().toISOString().slice(0, 16);
            
            showAlert('Paciente registrado con éxito.', 'success');
        }

        function clearPatientForm() {
            patientForm.reset();
            document.getElementById('pae-date').value = new Date().toISOString().slice(0, 16);
        }

        function loadPatients() {
            const tbody = document.getElementById('patients-table-body');
            tbody.innerHTML = '';
            
            if (patients.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = '<td colspan="10" style="text-align: center; padding: 2rem;">No hay pacientes registrados</td>';
                tbody.appendChild(row);
                return;
            }
            
            // Sort patients by date (newest first)
            const sortedPatients = [...patients].sort((a, b) => new Date(b.date) - new Date(a.date));
            
            // Pagination
            const itemsPerPage = 5;
            const currentPage = parseInt(localStorage.getItem('patientsPage')) || 1;
            const totalPages = Math.ceil(sortedPatients.length / itemsPerPage);
            const startIndex = (currentPage - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            const paginatedPatients = sortedPatients.slice(startIndex, endIndex);
            
            paginatedPatients.forEach(patient => {
                const row = document.createElement('tr');
                
                // Determine patient status based on vital signs
                let status = 'Estable';
                let statusClass = 'status-success';
                
                if (patient.vitalSigns.temperature > 38 || patient.vitalSigns.temperature < 36) {
                    status = 'Fiebre/Hipotermia';
                    statusClass = 'status-warning';
                }
                if (patient.vitalSigns.heartRate > 100 || patient.vitalSigns.heartRate < 60) {
                    status = 'Taquicardia/Bradicardia';
                    statusClass = 'status-warning';
                }
                if (patient.vitalSigns.saturation < 95) {
                    status = 'Hipoxemia';
                    statusClass = 'status-danger';
                }
                
                row.innerHTML = `
                    <td>${patient.id}</td>
                    <td>${patient.name}</td>
                    <td>${patient.age}</td>
                    <td>${patient.gender}</td>
                    <td>${patient.vitalSigns.temperature}°C</td>
                    <td>${patient.vitalSigns.heartRate} ppm</td>
                    <td>${patient.vitalSigns.pressure}</td>
                    <td>${patient.vitalSigns.saturation}%</td>
                    <td><span class="status-badge ${statusClass}"><i class="fas fa-heartbeat"></i> ${status}</span></td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn btn-icon btn-primary view-patient" data-id="${patient.id}" title="Ver detalles">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="btn btn-icon btn-danger delete-patient" data-id="${patient.id}" title="Eliminar">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </td>
                `;
                tbody.appendChild(row);
            });
            
            // Add event listeners to buttons
            document.querySelectorAll('.view-patient').forEach(btn => {
                btn.addEventListener('click', function() {
                    const patientId = parseInt(this.getAttribute('data-id'));
                    viewPatientDetails(patientId);
                });
            });
            
            document.querySelectorAll('.delete-patient').forEach(btn => {
                btn.addEventListener('click', function() {
                    const patientId = parseInt(this.getAttribute('data-id'));
                    deletePatient(patientId);
                });
            });
            
            // Update pagination
            updatePagination('patients', currentPage, totalPages);
        }

        function updatePatientSelect() {
            paePatientSelect.innerHTML = '<option value="">Seleccionar paciente...</option>';
            patients.forEach(patient => {
                const option = document.createElement('option');
                option.value = patient.id;
                option.textContent = `${patient.name} (ID: ${patient.id})`;
                paePatientSelect.appendChild(option);
            });
        }

        function deletePatient(patientId) {
            showAlert('¿Está seguro de que desea eliminar este paciente? Esta acción no se puede deshacer.', 'warning', [
                { text: 'Cancelar', class: 'btn-outline' },
                { text: 'Eliminar', class: 'btn-danger', action: () => {
                    patients = patients.filter(p => p.id !== patientId);
                    savePatients();
                    loadPatients();
                    updatePatientSelect();
                    updateStats();
                    renderTemperatureChart();
                    renderHeartRateChart();
                    renderSaturationChart();
                    renderPressureChart();
                    showAlert('Paciente eliminado con éxito.', 'success');
                }}
            ]);
        }

        function viewPatientDetails(patientId) {
            const patient = patients.find(p => p.id === patientId);
            if (!patient) return;
            
            const formattedDate = new Date(patient.date).toLocaleString('es-ES', {
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
            
            // Determine risk level
            let riskLevel = 'Bajo';
            let riskColor = 'badge-success';
            
            if (patient.vitalSigns.temperature > 39 || patient.vitalSigns.temperature < 35) {
                riskLevel = 'Alto';
                riskColor = 'badge-danger';
            } else if (patient.vitalSigns.temperature > 38 || patient.vitalSigns.temperature < 36) {
                riskLevel = 'Moderado';
                riskColor = 'badge-warning';
            }
            
            patientDetailsContent.innerHTML = `
                <div class="pae-section">
                    <h4 class="pae-title"><i class="fas fa-user"></i> Información del Paciente</h4>
                    <div class="form-row">
                        <div class="form-group">
                            <label>ID del Paciente:</label>
                            <p><strong>${patient.id}</strong></p>
                        </div>
                        <div class="form-group">
                            <label>Nombre:</label>
                            <p><strong>${patient.name}</strong></p>
                        </div>
                        <div class="form-group">
                            <label>Edad:</label>
                            <p><strong>${patient.age} años</strong></p>
                        </div>
                        <div class="form-group">
                            <label>Género:</label>
                            <p><strong>${patient.gender}</strong></p>
                        </div>
                    </div>
                </div>
                
                <div class="pae-section">
                    <h4 class="pae-title"><i class="fas fa-heartbeat"></i> Signos Vitales</h4>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Temperatura:</label>
                            <p><strong>${patient.vitalSigns.temperature} °C</strong></p>
                        </div>
                        <div class="form-group">
                            <label>Frecuencia Cardíaca:</label>
                            <p><strong>${patient.vitalSigns.heartRate} ppm</strong></p>
                        </div>
                        <div class="form-group">
                            <label>Presión Arterial:</label>
                            <p><strong>${patient.vitalSigns.pressure} mmHg</strong></p>
                        </div>
                        <div class="form-group">
                            <label>Saturación de O₂:</label>
                            <p><strong>${patient.vitalSigns.saturation}%</strong></p>
                        </div>
                    </div>
                </div>
                
                <div class="pae-section">
                    <h4 class="pae-title"><i class="fas fa-exclamation-triangle"></i> Evaluación de Riesgo</h4>
                    <div class="form-group">
                        <label>Nivel de Riesgo:</label>
                        <p><span class="badge ${riskColor}">${riskLevel}</span></p>
                    </div>
                </div>
                
                <div class="pae-section">
                    <h4 class="pae-title"><i class="fas fa-notes-medical"></i> Observaciones</h4>
                    <div class="form-group">
                        <p>${patient.observations || '<em>No hay observaciones registradas.</em>'}</p>
                    </div>
                </div>
                
                <div class="pae-section">
                    <h4 class="pae-title"><i class="fas fa-calendar"></i> Información de Registro</h4>
                    <div class="form-group">
                        <label>Fecha de Registro:</label>
                        <p>${formattedDate}</p>
                    </div>
                </div>
            `;
            
            viewPatientModal.classList.add('active');
        }

        function savePatients() {
            localStorage.setItem('patients', JSON.stringify(patients));
            localStorage.setItem('nextPatientId', nextPatientId.toString());
        }

        // PAE Functions
        function goToNextStep() {
            const currentStep = document.querySelector('.step-content.active');
            const currentStepNum = parseInt(currentStep.getAttribute('data-step'));
            const nextStepNum = currentStepNum + 1;
            
            // Validate current step
            if (currentStepNum === 1) {
                // Validate step 1 (Valoración)
                const patientSelect = document.getElementById('pae-patient');
                const assessment = document.getElementById('pae-assessment');
                
                if (!patientSelect.value || !assessment.value.trim()) {
                    showAlert('Por favor complete todos los campos obligatorios en esta etapa.', 'danger');
                    return;
                }
            } else if (currentStepNum === 2) {
                // Validate step 2 (Diagnóstico)
                const diagnosis = document.getElementById('pae-diagnosis');
                if (!diagnosis.value.trim()) {
                    showAlert('Por favor ingrese un diagnóstico de enfermería.', 'danger');
                    return;
                }
            } else if (currentStepNum === 3) {
                // Validate step 3 (Planificación)
                const objectives = document.querySelectorAll('#objectives-container .objective-item input[type="text"]');
                const plan = document.getElementById('pae-plan');
                
                let hasValidObjective = false;
                objectives.forEach(input => {
                    if (input.value.trim()) hasValidObjective = true;
                });
                
                if (!hasValidObjective && !plan.value.trim()) {
                    showAlert('Por favor ingrese al menos un objetivo o un plan de cuidados.', 'danger');
                    return;
                }
            } else if (currentStepNum === 4) {
                // Validate step 4 (Ejecución)
                const interventions = document.querySelectorAll('#interventions-container .intervention-item input[type="text"]');
                let hasValidIntervention = false;
                interventions.forEach(input => {
                    if (input.value.trim()) hasValidIntervention = true;
                });
                
                if (!hasValidIntervention) {
                    showAlert('Por favor registre al menos una intervención realizada.', 'danger');
                    return;
                }
            }
            
            // Hide current step
            currentStep.classList.remove('active');
            document.querySelector(`.step[data-step="${currentStepNum}"]`).classList.add('completed');
            
            // Show next step
            const nextStep = document.querySelector(`.step-content[data-step="${nextStepNum}"]`);
            if (nextStep) {
                nextStep.classList.add('active');
                document.querySelector(`.step[data-step="${nextStepNum}"]`).classList.add('active');
            }
        }

        function goToPreviousStep() {
            const currentStep = document.querySelector('.step-content.active');
            const currentStepNum = parseInt(currentStep.getAttribute('data-step'));
            const prevStepNum = currentStepNum - 1;
            
            // Hide current step
            currentStep.classList.remove('active');
            document.querySelector(`.step[data-step="${currentStepNum}"]`).classList.remove('active');
            
            // Show previous step
            const prevStep = document.querySelector(`.step-content[data-step="${prevStepNum}"]`);
            if (prevStep) {
                prevStep.classList.add('active');
                document.querySelector(`.step[data-step="${prevStepNum}"]`).classList.add('active');
            }
        }

        function addObjective() {
            const newItem = document.createElement('div');
            newItem.className = 'objective-item';
            newItem.style = 'display: flex; gap: 0.5rem; margin-bottom: 0.5rem;';
            newItem.innerHTML = `
                <input type="text" class="form-control" placeholder="Objetivo específico" style="flex: 1;">
                <select class="form-control" style="width: 120px;">
                    <option value="Corto plazo">Corto plazo</option>
                    <option value="Largo plazo">Largo plazo</option>
                </select>
                <button type="button" class="btn btn-danger remove-objective" style="padding: 0.5rem 0.75rem;">
                    <i class="fas fa-trash"></i>
                </button>
            `;
            addObjectiveContainer.appendChild(newItem);
        }

        function addIntervention() {
            const newItem = document.createElement('div');
            newItem.className = 'intervention-item';
            newItem.style = 'margin-bottom: 1rem; padding: 1rem; border: 1px solid var(--border); border-radius: var(--radius);';
            newItem.innerHTML = `
                <div style="display: flex; gap: 0.5rem; margin-bottom: 0.5rem;">
                    <input type="text" class="form-control" placeholder="Descripción de la intervención" style="flex: 1;">
                    <input type="time" class="form-control" style="width: 120px;" placeholder="Hora">
                    <button type="button" class="btn btn-danger remove-intervention" style="padding: 0.5rem 0.75rem;">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
                <div class="form-group">
                    <textarea class="form-control" rows="2" placeholder="Detalles adicionales, respuesta del paciente, etc."></textarea>
                </div>
            `;
            addInterventionsContainer.appendChild(newItem);
        }

        function handlePaeSubmit(e) {
            e.preventDefault();
            
            // Validate final step
            const evaluation = document.getElementById('pae-evaluation');
            const outcome = document.getElementById('pae-outcome');
            
            if (!evaluation.value.trim()) {
                showAlert('Por favor complete la evaluación del proceso.', 'danger');
                return;
            }
            
            // Get patient
            const patientId = parseInt(document.getElementById('pae-patient').value);
            const patient = patients.find(p => p.id === patientId);
            if (!patient) {
                showAlert('Paciente no encontrado.', 'danger');
                return;
            }
            
            // Collect all data
            const paeData = {
                id: nextPaeId++,
                patientId: patientId,
                patientName: patient.name,
                assessment: document.getElementById('pae-assessment').value,
                diagnosis: document.getElementById('pae-diagnosis').value,
                diagnosisDetails: document.getElementById('pae-diagnosis-details').value,
                priority: document.getElementById('pae-priority').value,
                objectives: [],
                plan: document.getElementById('pae-plan').value,
                interventions: [],
                evaluation: evaluation.value,
                outcome: outcome.value,
                recommendations: document.getElementById('pae-recommendations').value,
                date: document.getElementById('pae-date').value || new Date().toISOString().slice(0, 16)
            };
            
            // Collect objectives
            document.querySelectorAll('#objectives-container .objective-item').forEach(item => {
                const description = item.querySelector('input[type="text"]').value.trim();
                const timeframe = item.querySelector('select').value;
                if (description) {
                    paeData.objectives.push({ description, timeframe });
                }
            });
            
            // Collect interventions
            document.querySelectorAll('#interventions-container .intervention-item').forEach(item => {
                const description = item.querySelector('input[type="text"]').value.trim();
                const time = item.querySelector('input[type="time"]').value;
                const details = item.querySelector('textarea').value.trim();
                if (description) {
                    paeData.interventions.push({ description, time, details });
                }
            });
            
            // Add to PAE records
            paeRecords.push(paeData);
            
            // Save to localStorage
            savePaeRecords();
            
            // Update UI
            loadPaeRecords();
            updateStats();
            
            // Reset form
            paeForm.reset();
            document.getElementById('pae-date').value = new Date().toISOString().slice(0, 16);
            
            // Reset steps
            document.querySelectorAll('.step-content').forEach(step => {
                step.classList.remove('active');
            });
            document.querySelectorAll('.step').forEach(step => {
                step.classList.remove('active', 'completed');
            });
            document.querySelector('.step-content[data-step="1"]').classList.add('active');
            document.querySelector('.step[data-step="1"]').classList.add('active');
            
            showAlert('PAE registrado con éxito.', 'success');
        }

        function loadPaeRecords() {
            const tbody = document.getElementById('pae-table-body');
            tbody.innerHTML = '';
            
            if (paeRecords.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = '<td colspan="8" style="text-align: center; padding: 2rem;">No hay PAEs registrados</td>';
                tbody.appendChild(row);
                return;
            }
            
            // Sort PAEs by date (newest first)
            const sortedPae = [...paeRecords].sort((a, b) => new Date(b.date) - new Date(a.date));
            
            // Pagination
            const itemsPerPage = 5;
            const currentPage = parseInt(localStorage.getItem('paePage')) || 1;
            const totalPages = Math.ceil(sortedPae.length / itemsPerPage);
            const startIndex = (currentPage - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            const paginatedPae = sortedPae.slice(startIndex, endIndex);
            
            paginatedPae.forEach(pae => {
                const row = document.createElement('tr');
                
                // Format date
                const date = new Date(pae.date);
                const formattedDate = date.toLocaleDateString('es-ES');
                const formattedTime = date.toLocaleTimeString('es-ES', { hour: '2-digit', minute: '2-digit' });
                
                // Determine status
                let status = 'En Proceso';
                let statusClass = 'status-warning';
                
                if (pae.outcome && pae.outcome.includes('alcanzado')) {
                    status = 'Completado';
                    statusClass = 'status-success';
                } else if (pae.outcome && pae.outcome.includes('Empeoramiento')) {
                    status = 'Complicado';
                    statusClass = 'status-danger';
                }
                
                row.innerHTML = `
                    <td>${pae.id}</td>
                    <td>${pae.patientName}</td>
                    <td>${pae.diagnosis}</td>
                    <td>${formattedDate} ${formattedTime}</td>
                    <td><span class="status-badge ${statusClass}"><i class="fas fa-clock"></i> ${status}</span></td>
                    <td><span class="badge badge-${pae.priority.toLowerCase()}">${pae.priority}</span></td>
                    <td>${pae.outcome}</td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn btn-icon btn-primary view-pae" data-id="${pae.id}" title="Ver detalles">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="btn btn-icon btn-danger delete-pae" data-id="${pae.id}" title="Eliminar">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </td>
                `;
                tbody.appendChild(row);
            });
            
            // Add event listeners to buttons
            document.querySelectorAll('.view-pae').forEach(btn => {
                btn.addEventListener('click', function() {
                    const paeId = parseInt(this.getAttribute('data-id'));
                    viewPaeDetails(paeId);
                });
            });
            
            document.querySelectorAll('.delete-pae').forEach(btn => {
                btn.addEventListener('click', function() {
                    const paeId = parseInt(this.getAttribute('data-id'));
                    deletePaeRecord(paeId);
                });
            });
            
            // Update pagination
            updatePagination('pae', currentPage, totalPages);
        }

        function viewPaeDetails(paeId) {
            const pae = paeRecords.find(p => p.id === paeId);
            if (!pae) return;
            
            const patient = patients.find(p => p.id === pae.patientId);
            const patientName = patient ? patient.name : 'Paciente no encontrado';
            
            const formattedDate = new Date(pae.date).toLocaleString('es-ES', {
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
            
            let objectivesHtml = '';
            if (pae.objectives && pae.objectives.length > 0) {
                objectivesHtml = '<ul style="margin: 0.5rem 0; padding-left: 1.5rem;">';
                pae.objectives.forEach(obj => {
                    objectivesHtml += `<li><strong>${obj.timeframe}:</strong> ${obj.description}</li>`;
                });
                objectivesHtml += '</ul>';
            } else {
                objectivesHtml = '<p><em>No hay objetivos registrados.</em></p>';
            }
            
            let interventionsHtml = '';
            if (pae.interventions && pae.interventions.length > 0) {
                interventionsHtml = '<div style="margin-top: 1rem;">';
                pae.interventions.forEach(int => {
                    interventionsHtml += `
                        <div style="margin-bottom: 1rem; padding: 0.75rem; border: 1px solid var(--border); border-radius: var(--radius);">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                <strong>${int.description}</strong>
                                <span style="color: var(--gray);">${int.time || 'Hora no especificada'}</span>
                            </div>
                            <p style="margin: 0; font-style: italic;">${int.details || '<em>No hay detalles adicionales.</em>'}</p>
                        </div>
                    `;
                });
                interventionsHtml += '</div>';
            } else {
                interventionsHtml = '<p><em>No hay intervenciones registradas.</em></p>';
            }
            
            paeDetailsContent.innerHTML = `
                <div class="pae-section">
                    <h4 class="pae-title"><i class="fas fa-user"></i> Información del Paciente</h4>
                    <div class="form-group">
                        <label>Paciente:</label>
                        <p><strong>${patientName}</strong></p>
                    </div>
                    <div class="form-group">
                        <label>Fecha y Hora:</label>
                        <p><strong>${formattedDate}</strong></p>
                    </div>
                </div>
                
                <div class="pae-section">
                    <h4 class="pae-title"><i class="fas fa-search"></i> Valoración</h4>
                    <div class="form-group">
                        <p>${pae.assessment}</p>
                    </div>
                </div>
                
                <div class="pae-section">
                    <h4 class="pae-title"><i class="fas fa-diagnoses"></i> Diagnóstico de Enfermería</h4>
                    <div class="form-group">
                        <label>Diagnóstico Principal:</label>
                        <p><strong>${pae.diagnosis}</strong></p>
                    </div>
                    <div class="form-group">
                        <label>Detalles:</label>
                        <p>${pae.diagnosisDetails || '<em>No hay detalles adicionales.</em>'}</p>
                    </div>
                    <div class="form-group">
                        <label>Prioridad:</label>
                        <p><span class="badge badge-${pae.priority.toLowerCase()}">${pae.priority}</span></p>
                    </div>
                </div>
                
                <div class="pae-section">
                    <h4 class="pae-title"><i class="fas fa-tasks"></i> Planificación</h4>
                    <div class="form-group">
                        <label>Objetivos:</label>
                        ${objectivesHtml}
                    </div>
                    <div class="form-group">
                        <label>Plan de Cuidados:</label>
                        <p>${pae.plan || '<em>No hay plan de cuidados registrado.</em>'}</p>
                    </div>
                </div>
                
                <div class="pae-section">
                    <h4 class="pae-title"><i class="fas fa-hands"></i> Ejecución</h4>
                    <div class="form-group">
                        <label>Intervenciones Realizadas:</label>
                        ${interventionsHtml}
                    </div>
                </div>
                
                <div class="pae-section">
                    <h4 class="pae-title"><i class="fas fa-check-circle"></i> Evaluación</h4>
                    <div class="form-group">
                        <label>Evaluación de Resultados:</label>
                        <p>${pae.evaluation}</p>
                    </div>
                    <div class="form-group">
                        <label>Resultado:</label>
                        <p><strong>${pae.outcome}</strong></p>
                    </div>
                    <div class="form-group">
                        <label>Recomendaciones:</label>
                        <p>${pae.recommendations || '<em>No hay recomendaciones registradas.</em>'}</p>
                    </div>
                </div>
            `;
            
            viewPaeModal.classList.add('active');
        }

        function deletePaeRecord(paeId) {
            showAlert('¿Está seguro de que desea eliminar este registro de PAE? Esta acción no se puede deshacer.', 'warning', [
                { text: 'Cancelar', class: 'btn-outline' },
                { text: 'Eliminar', class: 'btn-danger', action: () => {
                    paeRecords = paeRecords.filter(p => p.id !== paeId);
                    savePaeRecords();
                    loadPaeRecords();
                    updateStats();
                    showAlert('Registro de PAE eliminado con éxito.', 'success');
                }}
            ]);
        }

        function savePaeRecords() {
            localStorage.setItem('paeRecords', JSON.stringify(paeRecords));
            localStorage.setItem('nextPaeId', nextPaeId.toString());
        }

        // Search Functions
        async function performSearch() {
            const query = searchInput.value.trim();
            const activeTab = document.querySelector('.search-tab.active').getAttribute('data-source');
            
            if (!query) {
                showAlert('Por favor ingrese un término de búsqueda.', 'info');
                return;
            }
            
            // Show loading state
            searchResults.innerHTML = `
                <div class="loading">
                    <i class="fas fa-spinner"></i>
                    <p>Buscando información sobre "${query}"...</p>
                </div>
            `;
            
            try {
                let results = [];
                
                switch(activeTab) {
                    case 'wikipedia':
                        // Simulate Wikipedia API response
                        results = {
                            extract: `La ${query} es una condición médica que afecta a millones de personas en todo el mundo. Los síntomas varían según el tipo y la gravedad de la condición. El tratamiento puede incluir medicamentos, cambios en el estilo de vida y en algunos casos, cirugía. La prevención incluye mantener un estilo de vida saludable, hacer ejercicio regularmente y seguir una dieta equilibrada.`,
                            displaytitle: query,
                            timestamp: new Date().toISOString()
                        };
                        displayWikipediaResults(results, query);
                        break;
                    case 'medicamentos':
                        results = searchMedications(query);
                        displayMedicationResults(results, query);
                        break;
                    case 'enfermedades':
                        results = searchDiseases(query);
                        displayDiseaseResults(results, query);
                        break;
                    case 'tratamientos':
                        results = searchTreatments(query);
                        displayTreatmentResults(results, query);
                        break;
                    case 'protocolos':
                        results = searchProtocols(query);
                        displayProtocolResults(results, query);
                        break;
                }
            } catch (error) {
                searchResults.innerHTML = `
                    <div class="alert alert-danger">
                        <i class="fas fa-exclamation-triangle alert-icon"></i>
                        <div>
                            <strong>Error:</strong> No se pudo realizar la búsqueda.
                            <p style="margin-top: 0.5rem; font-size: 0.9em;">${error.message}</p>
                        </div>
                    </div>
                `;
            }
        }

        function displayWikipediaResults(data, query) {
            if (data && data.extract) {
                const title = data.displaytitle || query;
                const extract = data.extract;
                const lastModified = data.timestamp ? new Date(data.timestamp).toLocaleDateString('es-ES') : '';
                
                let html = `
                    <div class="result-item">
                        <h3 class="result-title"><i class="fas fa-globe-americas"></i> ${title}</h3>
                        <div class="result-meta">
                            <span class="result-source"><i class="fas fa-info-circle"></i> Wikipedia</span>
                            ${lastModified ? `<span><i class="fas fa-calendar"></i> Actualizado: ${lastModified}</span>` : ''}
                        </div>
                        <div class="result-content">
                            ${extract}
                        </div>
                        <div class="result-actions">
                            <button class="btn btn-info btn-sm external-link">
                                <i class="fas fa-external-link-alt"></i> Leer más
                            </button>
                        </div>
                    </div>
                `;
                
                searchResults.innerHTML = html;
            } else {
                searchResults.innerHTML = `
                    <div class="alert alert-warning">
                        <i class="fas fa-search alert-icon"></i>
                        <div>
                            <strong>No se encontró información</strong>
                            <p>No se encontró información sobre "${query}". Intente con un término diferente o verifique la ortografía.</p>
                        </div>
                    </div>
                `;
            }
        }

        function searchMedications(query) {
            const searchTerm = query.toLowerCase();
            return medicalData.medications.filter(med => 
                med.name.toLowerCase().includes(searchTerm) || 
                med.active.toLowerCase().includes(searchTerm) ||
                med.indications.toLowerCase().includes(searchTerm)
            );
        }

        function displayMedicationResults(results, query) {
            if (results.length > 0) {
                let html = '';
                results.forEach(med => {
                    html += `
                        <div class="medicine-card">
                            <div class="medicine-image">
                                <i class="fas fa-pills"></i>
                            </div>
                            <div class="medicine-info">
                                <h3 class="medicine-name">${med.name}</h3>
                                <div class="medicine-active">Principio activo: ${med.active}</div>
                                <div class="medicine-presentation">Presentación: ${med.presentation}</div>
                                <div class="medicine-prices">
                                    <div class="price-item">
                                        <span class="price-label">Precio Mínimo</span>
                                        <span class="price-value">$${med.priceRange.min.toFixed(2)}</span>
                                    </div>
                                    <div class="price-item">
                                        <span class="price-label">Precio Máximo</span>
                                        <span class="price-value">$${med.priceRange.max.toFixed(2)}</span>
                                    </div>
                                </div>
                                <div style="margin-top: 0.5rem;">
                                    <strong>Indicaciones:</strong> ${med.indications}<br>
                                    <strong>Contraindicaciones:</strong> ${med.contraindications || 'No especificadas'}<br>
                                    <strong>Efectos secundarios:</strong> ${med.sideEffects.join(', ')}
                                </div>
                            </div>
                        </div>
                    `;
                });
                searchResults.innerHTML = html;
            } else {
                searchResults.innerHTML = `
                    <div class="alert alert-warning">
                        <i class="fas fa-pills alert-icon"></i>
                        <div>
                            <strong>No se encontraron medicamentos</strong>
                            <p>No se encontraron medicamentos relacionados con "${query}". Intente con un nombre comercial o principio activo.</p>
                        </div>
                    </div>
                `;
            }
        }

        function searchDiseases(query) {
            const searchTerm = query.toLowerCase();
            return medicalData.diseases.filter(disease => 
                disease.name.toLowerCase().includes(searchTerm) || 
                disease.description.toLowerCase().includes(searchTerm) ||
                disease.symptoms.some(symptom => symptom.toLowerCase().includes(searchTerm))
            );
        }

        function displayDiseaseResults(results, query) {
            if (results.length > 0) {
                let html = '';
                results.forEach(disease => {
                    let symptomsHtml = '<div class="disease-symptoms"><div class="symptoms-title">Síntomas comunes:</div><div class="symptoms-list">';
                    disease.symptoms.forEach(symptom => {
                        symptomsHtml += `<div class="symptom-item"><i class="fas fa-exclamation-triangle"></i> ${symptom}</div>`;
                    });
                    symptomsHtml += '</div></div>';
                    
                    html += `
                        <div class="result-item">
                            <h3 class="result-title"><i class="fas fa-disease"></i> ${disease.name}</h3>
                            <div class="result-meta">
                                <span class="result-source"><i class="fas fa-info-circle"></i> Enfermedad</span>
                            </div>
                            <div class="result-content disease-info">
                                <p>${disease.description}</p>
                                ${symptomsHtml}
                                <p><strong>Complicaciones:</strong> ${disease.complications.join(', ')}</p>
                                <p><strong>Diagnóstico:</strong> ${disease.diagnosis.join(', ')}</p>
                                <p><strong>Prevención:</strong> ${disease.prevention.join(', ')}</p>
                            </div>
                        </div>
                    `;
                });
                searchResults.innerHTML = html;
            } else {
                searchResults.innerHTML = `
                    <div class="alert alert-warning">
                        <i class="fas fa-disease alert-icon"></i>
                        <div>
                            <strong>No se encontraron enfermedades</strong>
                            <p>No se encontraron enfermedades relacionadas con "${query}". Intente con un nombre más específico.</p>
                        </div>
                    </div>
                `;
            }
        }

        function searchTreatments(query) {
            const searchTerm = query.toLowerCase();
            return medicalData.treatments.filter(treatment => 
                treatment.condition.toLowerCase().includes(searchTerm) ||
                treatment.firstLine.some(med => med.name.toLowerCase().includes(searchTerm)) ||
                treatment.secondLine.some(med => med.name.toLowerCase().includes(searchTerm))
            );
        }

        function displayTreatmentResults(results, query) {
            if (results.length > 0) {
                let html = '';
                results.forEach(treatment => {
                    let firstLineHtml = '<div class="treatment-medications">';
                    treatment.firstLine.forEach(med => {
                        firstLineHtml += `
                            <div class="medication-item">
                                <div>
                                    <div class="medication-name">${med.name}</div>
                                    <div class="medication-dosage">${med.dosage} ${med.duration ? `(${med.duration})` : ''}</div>
                                </div>
                                <span class="badge badge-success">Primera línea</span>
                            </div>
                        `;
                    });
                    firstLineHtml += '</div>';
                    
                    let secondLineHtml = '';
                    if (treatment.secondLine && treatment.secondLine.length > 0) {
                        secondLineHtml = '<div class="treatment-medications">';
                        treatment.secondLine.forEach(med => {
                            secondLineHtml += `
                                <div class="medication-item">
                                    <div>
                                        <div class="medication-name">${med.name}</div>
                                        <div class="medication-dosage">${med.dosage} ${med.duration ? `(${med.duration})` : ''}</div>
                                    </div>
                                    <span class="badge badge-warning">Segunda línea</span>
                                </div>
                            `;
                        });
                        secondLineHtml += '</div>';
                    }
                    
                    html += `
                        <div class="result-item">
                            <h3 class="result-title"><i class="fas fa-hand-holding-medical"></i> Tratamiento para ${treatment.condition}</h3>
                            <div class="result-meta">
                                <span class="result-source"><i class="fas fa-capsules"></i> Tratamiento</span>
                            </div>
                            <div class="result-content treatment-info">
                                <div class="treatment-title">Medicamentos de primera línea:</div>
                                ${firstLineHtml}
                                ${secondLineHtml}
                                <p><strong>Notas:</strong> ${treatment.notes}</p>
                                ${treatment.lifestyle ? `<p><strong>Recomendaciones de estilo de vida:</strong> ${treatment.lifestyle.join(', ')}</p>` : ''}
                            </div>
                        </div>
                    `;
                });
                searchResults.innerHTML = html;
            } else {
                searchResults.innerHTML = `
                    <div class="alert alert-warning">
                        <i class="fas fa-hand-holding-medical alert-icon"></i>
                        <div>
                            <strong>No se encontraron tratamientos</strong>
                            <p>No se encontraron tratamientos relacionados con "${query}". Intente con una condición médica específica.</p>
                        </div>
                    </div>
                `;
            }
        }

        function searchProtocols(query) {
            const searchTerm = query.toLowerCase();
            return medicalData.protocols.filter(protocol => 
                protocol.title.toLowerCase().includes(searchTerm) || 
                protocol.category.toLowerCase().includes(searchTerm) ||
                protocol.steps.some(step => step.toLowerCase().includes(searchTerm))
            );
        }

        function displayProtocolResults(results, query) {
            if (results.length > 0) {
                let html = '';
                results.forEach(protocol => {
                    let stepsHtml = '<ol style="margin: 0.5rem 0; padding-left: 1.5rem;">';
                    protocol.steps.forEach(step => {
                        stepsHtml += `<li style="margin-bottom: 0.5rem;">${step}</li>`;
                    });
                    stepsHtml += '</ol>';
                    
                    html += `
                        <div class="protocol-item">
                            <h3 class="protocol-title"><i class="fas fa-book-medical"></i> ${protocol.title}</h3>
                            <div class="protocol-category"><i class="fas fa-tag"></i> ${protocol.category}</div>
                            <div class="protocol-content">
                                ${stepsHtml}
                                ${protocol.notes ? `<p><strong>Notas:</strong> ${protocol.notes}</p>` : ''}
                                ${protocol.medications ? `<p><strong>Medicamentos recomendados:</strong> ${protocol.medications.join(', ')}</p>` : ''}
                                ${protocol.goals ? `<p><strong>Metas:</strong> ${protocol.goals}</p>` : ''}
                            </div>
                        </div>
                    `;
                });
                searchResults.innerHTML = html;
            } else {
                searchResults.innerHTML = `
                    <div class="alert alert-warning">
                        <i class="fas fa-book-medical alert-icon"></i>
                        <div>
                            <strong>No se encontraron protocolos</strong>
                            <p>No se encontraron protocolos médicos relacionados con "${query}". Intente con un término diferente.</p>
                        </div>
                    </div>
                `;
            }
        }

        // Statistics Functions
        function updateStats() {
            totalPatientsEl.textContent = patients.length;
            totalPaeEl.textContent = paeRecords.length;
            
            // Calculate average temperature
            if (patients.length > 0) {
                const totalTemp = patients.reduce((sum, patient) => sum + patient.vitalSigns.temperature, 0);
                const avgTemp = (totalTemp / patients.length).toFixed(1);
                avgTempEl.textContent = `${avgTemp}°C`;
                
                // Calculate average heart rate
                const totalHeartRate = patients.reduce((sum, patient) => sum + patient.vitalSigns.heartRate, 0);
                const avgHeartRate = Math.round(totalHeartRate / patients.length);
                avgHeartRateEl.textContent = `${avgHeartRate} ppm`;
            } else {
                avgTempEl.textContent = '0°C';
                avgHeartRateEl.textContent = '0 ppm';
            }
        }

        // Custom Chart Functions (no external libraries)
        function renderTemperatureChart() {
            const container = document.getElementById('temperature-chart');
            container.innerHTML = '';
            
            if (patients.length === 0) {
                container.innerHTML = '<div style="text-align: center; padding: 1rem; color: var(--gray);">No hay datos disponibles</div>';
                return;
            }
            
            // Sort patients by date
            const sortedPatients = [...patients].sort((a, b) => new Date(a.date) - new Date(b.date));
            
            // Get data for chart
            const labels = sortedPatients.map(p => `P${p.id}`);
            const temperatures = sortedPatients.map(p => p.vitalSigns.temperature);
            
            // Create chart
            const chart = document.createElement('div');
            chart.style.position = 'relative';
            chart.style.width = '100%';
            chart.style.height = '100%';
            
            // Add Y-axis labels
            for (let i = 34; i <= 42; i += 2) {
                const label = document.createElement('div');
                label.className = 'chart-y-label';
                label.style.left = '-30px';
                label.style.bottom = `${((i - 34) / 8) * 100}%`;
                label.textContent = `${i}°`;
                chart.appendChild(label);
            }
            
            // Add X-axis labels
            labels.forEach((label, index) => {
                const xLabel = document.createElement('div');
                xLabel.className = 'chart-label';
                xLabel.style.left = `${(index / (labels.length - 1 || 1)) * 100}%`;
                xLabel.textContent = label;
                chart.appendChild(xLabel);
            });
            
            // Add data bars
            temperatures.forEach((temp, index) => {
                const bar = document.createElement('div');
                bar.className = 'chart-bar';
                bar.style.left = `${(index / (labels.length - 1 || 1)) * 100}%`;
                bar.style.height = `${((temp - 34) / 8) * 100}%`;
                chart.appendChild(bar);
            });
            
            container.appendChild(chart);
        }

        function renderHeartRateChart() {
            const container = document.getElementById('heart-rate-chart');
            container.innerHTML = '';
            
            if (patients.length === 0) {
                container.innerHTML = '<div style="text-align: center; padding: 1rem; color: var(--gray);">No hay datos disponibles</div>';
                return;
            }
            
            // Sort patients by date
            const sortedPatients = [...patients].sort((a, b) => new Date(a.date) - new Date(b.date));
            
            // Get data for chart
            const labels = sortedPatients.map(p => `P${p.id}`);
            const heartRates = sortedPatients.map(p => p.vitalSigns.heartRate);
            
            // Create chart
            const chart = document.createElement('div');
            chart.style.position = 'relative';
            chart.style.width = '100%';
            chart.style.height = '100%';
            
            // Add Y-axis labels
            for (let i = 40; i <= 200; i += 40) {
                const label = document.createElement('div');
                label.className = 'chart-y-label';
                label.style.left = '-30px';
                label.style.bottom = `${((i - 40) / 160) * 100}%`;
                label.textContent = `${i}`;
                chart.appendChild(label);
            }
            
            // Add X-axis labels
            labels.forEach((label, index) => {
                const xLabel = document.createElement('div');
                xLabel.className = 'chart-label';
                xLabel.style.left = `${(index / (labels.length - 1 || 1)) * 100}%`;
                xLabel.textContent = label;
                chart.appendChild(xLabel);
            });
            
            // Add data bars
            heartRates.forEach((rate, index) => {
                const bar = document.createElement('div');
                bar.className = 'chart-bar';
                bar.style.backgroundColor = '#7c3aed';
                bar.style.left = `${(index / (labels.length - 1 || 1)) * 100}%`;
                bar.style.height = `${((rate - 40) / 160) * 100}%`;
                chart.appendChild(bar);
            });
            
            container.appendChild(chart);
        }

        function renderSaturationChart() {
            const container = document.getElementById('saturation-chart');
            container.innerHTML = '';
            
            if (patients.length === 0) {
                container.innerHTML = '<div style="text-align: center; padding: 1rem; color: var(--gray);">No hay datos disponibles</div>';
                return;
            }
            
            // Sort patients by date
            const sortedPatients = [...patients].sort((a, b) => new Date(a.date) - new Date(b.date));
            
            // Get data for chart
            const labels = sortedPatients.map(p => `P${p.id}`);
            const saturations = sortedPatients.map(p => p.vitalSigns.saturation);
            
            // Create chart
            const chart = document.createElement('div');
            chart.style.position = 'relative';
            chart.style.width = '100%';
            chart.style.height = '100%';
            
            // Add Y-axis labels
            for (let i = 80; i <= 100; i += 5) {
                const label = document.createElement('div');
                label.className = 'chart-y-label';
                label.style.left = '-30px';
                label.style.bottom = `${((i - 80) / 20) * 100}%`;
                label.textContent = `${i}%`;
                chart.appendChild(label);
            }
            
            // Add X-axis labels
            labels.forEach((label, index) => {
                const xLabel = document.createElement('div');
                xLabel.className = 'chart-label';
                xLabel.style.left = `${(index / (labels.length - 1 || 1)) * 100}%`;
                xLabel.textContent = label;
                chart.appendChild(xLabel);
            });
            
            // Add data bars
            saturations.forEach((sat, index) => {
                const bar = document.createElement('div');
                bar.className = 'chart-bar';
                bar.style.backgroundColor = '#16a34a';
                bar.style.left = `${(index / (labels.length - 1 || 1)) * 100}%`;
                bar.style.height = `${((sat - 80) / 20) * 100}%`;
                chart.appendChild(bar);
            });
            
            container.appendChild(chart);
        }

        function renderPressureChart() {
            const container = document.getElementById('pressure-chart');
            container.innerHTML = '';
            
            if (patients.length === 0) {
                container.innerHTML = '<div style="text-align: center; padding: 1rem; color: var(--gray);">No hay datos disponibles</div>';
                return;
            }
            
            // Sort patients by date
            const sortedPatients = [...patients].sort((a, b) => new Date(a.date) - new Date(b.date));
            
            // Extract systolic and diastolic values
            const labels = sortedPatients.map(p => `P${p.id}`);
            const systolic = sortedPatients.map(p => {
                const parts = p.vitalSigns.pressure.split('/');
                return parseInt(parts[0]);
            });
            const diastolic = sortedPatients.map(p => {
                const parts = p.vitalSigns.pressure.split('/');
                return parseInt(parts[1]);
            });
            
            // Create chart
            const chart = document.createElement('div');
            chart.style.position = 'relative';
            chart.style.width = '100%';
            chart.style.height = '100%';
            
            // Add Y-axis labels
            for (let i = 60; i <= 200; i += 20) {
                const label = document.createElement('div');
                label.className = 'chart-y-label';
                label.style.left = '-30px';
                label.style.bottom = `${((i - 60) / 140) * 100}%`;
                label.textContent = `${i}`;
                chart.appendChild(label);
            }
            
            // Add X-axis labels
            labels.forEach((label, index) => {
                const xLabel = document.createElement('div');
                xLabel.className = 'chart-label';
                xLabel.style.left = `${(index / (labels.length - 1 || 1)) * 100}%`;
                xLabel.textContent = label;
                chart.appendChild(xLabel);
            });
            
            // Add systolic bars
            systolic.forEach((sys, index) => {
                const bar = document.createElement('div');
                bar.className = 'chart-bar';
                bar.style.backgroundColor = '#dc2626';
                bar.style.opacity = '0.7';
                bar.style.left = `${(index / (labels.length - 1 || 1)) * 100}%`;
                bar.style.height = `${((sys - 60) / 140) * 100}%`;
                chart.appendChild(bar);
            });
            
            // Add diastolic bars
            diastolic.forEach((dia, index) => {
                const bar = document.createElement('div');
                bar.className = 'chart-bar';
                bar.style.backgroundColor = '#2563eb';
                bar.style.opacity = '0.7';
                bar.style.left = `${(index / (labels.length - 1 || 1)) * 100}%`;
                bar.style.height = `${((dia - 60) / 140) * 100}%`;
                chart.appendChild(bar);
            });
            
            // Add legend
            const legend = document.createElement('div');
            legend.style.position = 'absolute';
            legend.style.top = '10px';
            legend.style.right = '10px';
            legend.style.backgroundColor = 'rgba(255, 255, 255, 0.8)';
            legend.style.padding = '0.5rem';
            legend.style.borderRadius = 'var(--radius)';
            legend.style.fontSize = '0.75rem';
            legend.innerHTML = `
                <div style="display: flex; gap: 0.5rem; margin-bottom: 0.25rem;">
                    <div style="width: 12px; height: 12px; background: #dc2626; opacity: 0.7;"></div>
                    <span>Sistólica</span>
                </div>
                <div style="display: flex; gap: 0.5rem;">
                    <div style="width: 12px; height: 12px; background: #2563eb; opacity: 0.7;"></div>
                    <span>Diastólica</span>
                </div>
            `;
            chart.appendChild(legend);
            
            container.appendChild(chart);
        }

        // Export Functions
        function exportPatients() {
            if (patients.length === 0) {
                showAlert('No hay pacientes para exportar.', 'info');
                return;
            }
            
            // Create CSV content
            let csv = 'ID,Nombre,Edad,Género,Temperatura,Frecuencia Cardíaca,Presión Arterial,Saturación,Observaciones,Fecha\n';
            
            patients.forEach(patient => {
                csv += `"${patient.id}","${patient.name}","${patient.age}","${patient.gender}","${patient.vitalSigns.temperature}","${patient.vitalSigns.heartRate}","${patient.vitalSigns.pressure}","${patient.vitalSigns.saturation}","${patient.observations.replace(/"/g, '""')}","${new Date(patient.date).toLocaleString('es-ES')}"\n`;
            });
            
            // Create download link
            downloadFile(csv, `pacientes_${new Date().toISOString().slice(0, 10)}.csv`, 'text/csv');
        }

        function exportPae() {
            if (paeRecords.length === 0) {
                showAlert('No hay registros de PAE para exportar.', 'info');
                return;
            }
            
            // Create CSV content
            let csv = 'ID,Paciente,Diagnóstico,Prioridad,Fecha,Resultado\n';
            
            paeRecords.forEach(pae => {
                csv += `"${pae.id}","${pae.patientName}","${pae.diagnosis.replace(/"/g, '""')}","${pae.priority}","${new Date(pae.date).toLocaleString('es-ES')}","${pae.outcome}"\n`;
            });
            
            // Create download link
            downloadFile(csv, `pae_records_${new Date().toISOString().slice(0, 10)}.csv`, 'text/csv');
        }

        function exportAllPatients() {
            if (patients.length === 0) {
                showAlert('No hay pacientes para exportar.', 'info');
                return;
            }
            
            // Create CSV content
            let csv = 'ID,Nombre,Edad,Género,Temperatura,Frecuencia Cardíaca,Presión Arterial,Saturación,Observaciones,Fecha\n';
            
            patients.forEach(patient => {
                csv += `"${patient.id}","${patient.name}","${patient.age}","${patient.gender}","${patient.vitalSigns.temperature}","${patient.vitalSigns.heartRate}","${patient.vitalSigns.pressure}","${patient.vitalSigns.saturation}","${patient.observations.replace(/"/g, '""')}","${new Date(patient.date).toLocaleString('es-ES')}"\n`;
            });
            
            // Create download link
            downloadFile(csv, `todos_los_pacientes_${new Date().toISOString().slice(0, 10)}.csv`, 'text/csv');
        }

        function exportAllPae() {
            if (paeRecords.length === 0) {
                showAlert('No hay registros de PAE para exportar.', 'info');
                return;
            }
            
            // Create CSV content
            let csv = 'ID,Paciente,Diagnóstico,Prioridad,Fecha,Resultado\n';
            
            paeRecords.forEach(pae => {
                csv += `"${pae.id}","${pae.patientName}","${pae.diagnosis.replace(/"/g, '""')}","${pae.priority}","${new Date(pae.date).toLocaleString('es-ES')}","${pae.outcome}"\n`;
            });
            
            // Create download link
            downloadFile(csv, `todos_los_pae_${new Date().toISOString().slice(0, 10)}.csv`, 'text/csv');
        }

        function exportAllData() {
            const data = {
                patients: patients,
                paeRecords: paeRecords,
                meta: {
                    exportDate: new Date().toISOString(),
                    totalPatients: patients.length,
                    totalPaeRecords: paeRecords.length
                }
            };
            
            const json = JSON.stringify(data, null, 2);
            downloadFile(json, `datos_medicos_completos_${new Date().toISOString().slice(0, 10)}.json`, 'application/json');
        }

        function downloadFile(content, filename, contentType) {
            const blob = new Blob([content], { type: contentType });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            a.click();
            
            // Clean up
            setTimeout(() => {
                URL.revokeObjectURL(url);
            }, 100);
        }

        // Pagination Functions
        function updatePagination(type, currentPage, totalPages) {
            const container = document.getElementById(`${type}-pagination`);
            container.innerHTML = '';
            
            if (totalPages <= 1) return;
            
            // Previous button
            const prevBtn = document.createElement('li');
            prevBtn.className = 'page-item';
            prevBtn.innerHTML = '<i class="fas fa-chevron-left"></i>';
            prevBtn.style = 'width: 36px; height: 36px; display: flex; align-items: center; justify-content: center;';
            if (currentPage === 1) {
                prevBtn.classList.add('disabled');
            } else {
                prevBtn.addEventListener('click', () => {
                    const newPage = currentPage - 1;
                    localStorage.setItem(`${type}Page`, newPage.toString());
                    if (type === 'patients') loadPatients();
                    if (type === 'pae') loadPaeRecords();
                });
            }
            container.appendChild(prevBtn);
            
            // Page numbers
            const maxVisiblePages = 5;
            let startPage = Math.max(1, currentPage - Math.floor(maxVisiblePages / 2));
            let endPage = Math.min(totalPages, startPage + maxVisiblePages - 1);
            
            if (endPage - startPage + 1 < maxVisiblePages) {
                startPage = Math.max(1, endPage - maxVisiblePages + 1);
            }
            
            for (let i = startPage; i <= endPage; i++) {
                const pageBtn = document.createElement('li');
                pageBtn.className = 'page-item';
                if (i === currentPage) {
                    pageBtn.classList.add('active');
                }
                pageBtn.textContent = i;
                pageBtn.addEventListener('click', () => {
                    localStorage.setItem(`${type}Page`, i.toString());
                    if (type === 'patients') loadPatients();
                    if (type === 'pae') loadPaeRecords();
                });
                container.appendChild(pageBtn);
            }
            
            // Next button
            const nextBtn = document.createElement('li');
            nextBtn.className = 'page-item';
            nextBtn.innerHTML = '<i class="fas fa-chevron-right"></i>';
            nextBtn.style = 'width: 36px; height: 36px; display: flex; align-items: center; justify-content: center;';
            if (currentPage === totalPages) {
                nextBtn.classList.add('disabled');
            } else {
                nextBtn.addEventListener('click', () => {
                    const newPage = currentPage + 1;
                    localStorage.setItem(`${type}Page`, newPage.toString());
                    if (type === 'patients') loadPatients();
                    if (type === 'pae') loadPaeRecords();
                });
            }
            container.appendChild(nextBtn);
        }

        // Alert Function
        function showAlert(message, type, actions = []) {
            // Remove any existing alerts
            const existingAlert = document.querySelector('.alert');
            if (existingAlert) {
                existingAlert.remove();
            }
            
            // Create alert
            const alert = document.createElement('div');
            alert.className = `alert alert-${type}`;
            alert.style.position = 'fixed';
            alert.style.top = '20px';
            alert.style.right = '20px';
            alert.style.zIndex = '1000';
            alert.style.maxWidth = '400px';
            alert.style.boxShadow = 'var(--shadow-lg)';
            
            const icon = type === 'success' ? 'check-circle' : 
                        type === 'danger' ? 'times-circle' : 
                        type === 'warning' ? 'exclamation-triangle' : 'info-circle';
            
            alert.innerHTML = `
                <i class="fas fa-${icon} alert-icon"></i>
                <div>${message}</div>
            `;
            
            if (actions.length > 0) {
                const actionsDiv = document.createElement('div');
                actionsDiv.style.display = 'flex';
                actionsDiv.style.gap = '0.5rem';
                actionsDiv.style.marginTop = '0.75rem';
                
                actions.forEach(action => {
                    const btn = document.createElement('button');
                    btn.className = `btn ${action.class}`;
                    btn.textContent = action.text;
                    if (action.action) {
                        btn.addEventListener('click', () => {
                            action.action();
                            alert.remove();
                        });
                    } else {
                        btn.addEventListener('click', () => alert.remove());
                    }
                    actionsDiv.appendChild(btn);
                });
                
                alert.appendChild(actionsDiv);
            } else {
                const closeBtn = document.createElement('button');
                closeBtn.className = 'btn btn-sm btn-outline';
                closeBtn.textContent = 'Cerrar';
                closeBtn.style.marginTop = '0.75rem';
                closeBtn.addEventListener('click', () => alert.remove());
                alert.appendChild(closeBtn);
            }
            
            document.body.appendChild(alert);
            
            // Auto-remove after 5 seconds if no actions
            if (actions.length === 0) {
                setTimeout(() => {
                    if (document.body.contains(alert)) {
                        alert.remove();
                    }
                }, 5000);
            }
        }
    </script>
</body>
</html>
```
