<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="theme-color" content="#20c997">
  <title>CareTrack Pro · Enfermería (PWA)</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.4/css/bulma.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root{--brand:#20c997; --ink:#111518; --muted:#637988; --bg:#f6f8fa; --card:rgba(255,255,255,0.15); --bord:rgba(255,255,255,0.3); --ok:#10b981; --warn:#f59e0b; --danger:#ef4444; --radius:16px; --futuristic-gradient: linear-gradient(135deg, #20c997, #0f766e);}
    html,body{height:100%; margin:0; font:16px/1.4 system-ui, -apple-system, Segoe UI, Roboto, Inter, Arial, sans-serif; color:var(--ink); background:var(--bg)}
    .topbar{position:sticky;top:0;z-index:10;display:flex;align-items:center;justify-content:space-between;gap:12px;padding:10px 16px;background:var(--card);backdrop-filter:blur(10px);border-bottom:1px solid var(--bord)}
    .brand{display:flex;align-items:center;gap:12px} .logo{width:40px;height:40px;border-radius:50%;background:var(--brand);position:relative;box-shadow:0 4px 12px rgba(25,148,230,.3)} .logo::before{content:"";position:absolute;inset:12px 18px;background:#fff;border-radius:4px} .brand-text small{display:block;color:var(--muted);font-size:12px}
    .actions{display:flex;gap:8px;align-items:center} .btn{appearance:none;border:none;background:var(--futuristic-gradient);color:#fff;border-radius:8px;padding:8px 12px;font-weight:600;cursor:pointer;transition:transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;box-shadow:0 4px 8px rgba(0,0,0,0.2)} .btn:hover{transform:scale(1.05);box-shadow:0 8px 16px rgba(0,0,0,0.3)} .btn.primary{background:var(--brand);border-color:transparent;color:#fff} .btn.small{padding:4px 8px;border-radius:8px}
    .card, .box, .notification {text-align: center; background: var(--card); backdrop-filter: blur(12px) saturate(150%); -webkit-backdrop-filter: blur(12px) saturate(150%); border-radius: var(--radius); border: 1px solid var(--bord); box-shadow: 0 8px 24px rgba(0,0,0,0.15); padding: 16px; margin: 12px 0;}
    .card .title, .box .title, .notification .title {color: #0f766e; font-weight: 600; margin-bottom: 12px;}
  </style>
</head>
<body>
  <section class="hero is-primary">
    <div class="hero-body">
      <p class="title"><span class="icon is-large"><i class="fas fa-user-nurse fa-2x"></i></span> CareTrack Pro</p>
      <p class="subtitle">Módulo de Enfermería Avanzada</p>
    </div>
  </section>
  <div class="container section">
    <div class="columns">
      <div class="column is-one-third">
        <div class="card mb-4">
          <div class="card-content">
            <div class="field"><label class="label"><span class="icon"><i class="fas fa-user-nurse"></i></span> Profesional</label><input id="nurse-name" class="input" placeholder="Nombre y apellido"></div>
            <div class="field"><label class="label"><span class="icon"><i class="fas fa-hospital-user"></i></span> Paciente</label><div class="control"><select id="patient-select" class="select"></select></div></div>
            <button id="btn-new-patient" class="button is-primary is-fullwidth mb-2"><span class="icon"><i class="fas fa-user-plus"></i></span> Nuevo paciente</button>
            <button id="btn-print" class="button is-light is-fullwidth mb-2"><span class="icon"><i class="fas fa-print"></i></span> Imprimir</button>
            <button id="btn-export" class="button is-link is-fullwidth mb-2"><span class="icon"><i class="fas fa-download"></i></span> Exportar</button>
            <label class="button is-info is-fullwidth filelike"><span class="icon"><i class="fas fa-upload"></i></span> Importar<input id="import-file" type="file" accept="application/json" style="display:none;"> </label>
            <div class="field mt-2"><label class="checkbox"><input id="unit-toggle" type="checkbox"> °C / °F</label><label class="checkbox ml-2"><input id="lang-toggle" type="checkbox"> ES / EN</label></div>
          </div>
        </div>
      </div>
      <div class="column">
        <div class="columns is-multiline">
          <div class="column is-half">
            <div class="card mb-4">
              <header class="card-header">
                <p class="card-header-title"><span class="icon"><i class="fas fa-heartbeat"></i></span> Signos Vitales</p>
              </header>
              <div class="card-content" id="vitals-wrap">
                <button id="btn-add-vital" class="button is-primary">Agregar Vital</button>
                <p>Contenido de Signos Vitales</p>
              </div>
            </div>
          </div>
          <div class="column is-half">
            <div class="card mb-4">
              <header class="card-header">
                <p class="card-header-title"><span class="icon"><i class="fas fa-prescription-bottle-alt"></i></span> Medicamentos</p>
              </header>
              <div class="card-content" id="meds-wrap">
                <button id="btn-add-med" class="button is-primary">Agregar Medicamento</button>
                <p>Contenido de Medicamentos</p>
              </div>
            </div>
          </div>
          <div class="column is-half">
            <div class="card mb-4">
              <header class="card-header">
                <p class="card-header-title"><span class="icon"><i class="fas fa-notes-medical"></i></span> Notas de Enfermería</p>
              </header>
              <div class="card-content" id="notes-wrap">
                <button id="btn-add-note" class="button is-primary">Agregar Nota</button>
                <p>Contenido de Notas</p>
              </div>
            </div>
          </div>
          <div class="column is-half">
            <div class="card mb-4">
              <header class="card-header">
                <p class="card-header-title"><span class="icon"><i class="fas fa-tint"></i></span> Balance Hídrico</p>
              </header>
              <div class="card-content" id="fluids-wrap">
                <button id="btn-add-fluid" class="button is-primary">Agregar Registro</button>
                <p>Contenido de Balance Hídrico</p>
              </div>
            </div>
          </div>
          <div class="column is-half">
            <div class="card mb-4">
              <header class="card-header">
                <p class="card-header-title"><span class="icon"><i class="fas fa-tasks"></i></span> Tareas</p>
              </header>
              <div class="card-content" id="tasks-wrap">
                <button id="btn-add-task" class="button is-primary">Agregar Tarea</button>
                <p>Contenido de Tareas</p>
              </div>
            </div>
          </div>
          <div class="column is-half">
            <div class="card mb-4">
              <header class="card-header">
                <p class="card-header-title"><span class="icon"><i class="fas fa-clipboard-list"></i></span> Protocolos</p>
              </header>
              <div class="card-content" id="protocols-wrap">
                <p>Contenido de Protocolos</p>
              </div>
            </div>
          </div>
          <div class="column is-half">
            <div class="card mb-4">
              <header class="card-header">
                <p class="card-header-title"><span class="icon"><i class="fas fa-pills"></i></span> Combinación de Medicamentos</p>
              </header>
              <div class="card-content" id="drug-interactions-wrap">
                <p>Contenido de Interacciones</p>
              </div>
            </div>
          </div>
          <div class="column is-half">
            <div class="card mb-4">
              <header class="card-header">
                <p class="card-header-title"><span class="icon"><i class="fas fa-calculator"></i></span> Calculadora Médica</p>
              </header>
              <div class="card-content" id="calculator-wrap">
                <p>Contenido de Calculadora</p>
              </div>
            </div>
          </div>
          <div class="column is-half">
            <div class="card mb-4">
              <header class="card-header">
                <p class="card-header-title"><span class="icon"><i class="fas fa-graduation-cap"></i></span> Escuela Médica</p>
              </header>
              <div class="card-content">
                <p>Contenido de Escuela Médica</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <footer class="footer"><div class="content has-text-centered"><small>Hecho por David Díaz · CareTrack Pro</small></div></footer>
  <script>
    const $ = (s)=>document.querySelector(s);
    const fmtDate = (d)=> new Date(d).toLocaleDateString('es-AR');
    const fmtTime = (d)=> new Date(d).toLocaleTimeString('es-AR',{hour:'2-digit',minute:'2-digit'});
    const nowISO = ()=> new Date().toISOString();
    const toF = (c)=> (c*9/5+32).toFixed(1);
    const toC = (f)=> ((f-32)*5/9).toFixed(1);
    const uid = ()=> crypto.randomUUID();

    const state = {
      nurse:'',
      unit:'C',
      lang:'es',
      currentPatientId: null,
      patients: {},
      vitals: {},
      meds: {},
      notes: {},
      fluids: {},
      tasks: {},
      protocols: {},
      drugInteractions: {},
      calculations: {},
      pages: { vitals: 1, meds: 1 },
      audit: []
    };

    // -------------- Persistencia --------------
    function saveDB(){ localStorage.setItem('ctp_enf_v2', JSON.stringify(state)); }
    function loadDB(){ try { const raw = localStorage.getItem('ctp_enf_v2'); if (raw) Object.assign(state, JSON.parse(raw)); } catch (error) { console.error("Error loading data from localStorage:", error); resetState(); } }
    function resetState() { state.nurse = ''; state.unit = 'C'; state.lang = 'es'; state.currentPatientId = null; state.patients = {}; state.vitals = {}; state.meds = {}; state.notes = {}; state.fluids = {}; state.tasks = {}; state.protocols = {}; state.drugInteractions = {}; state.calculations = {}; state.pages = { vitals: 1, meds: 1 }; state.audit = []; }

    function seed(){ if(Object.keys(state.patients).length) return; const p1={id:'P-001',name:'María González',age:68,condition:'Diabetes tipo 2',allergies:'Penicilina'}; const p2={id:'P-002',name:'José Pérez',age:75,condition:'Hipertensión',allergies:'Ibuprofeno'}; state.patients[p1.id]=p1; state.patients[p2.id]=p2; state.currentPatientId=p1.id; state.vitals[p1.id]=[{id:uid(),at:nowISO(),tempC:36.8,hr:72,sys:120,dia:80,spo2:98,rr:16,pain:0,gcs:15,notes:'Ingreso'}]; state.meds[p1.id]=[{id:uid(),at:nowISO(),date:nowISO(),time:'09:00',name:'Paracetamol',dose:'1 g',route:'Oral',freq:'c/8h',status:'Programado'}]; state.notes[p1.id]=[{id:uid(),at:nowISO(),type:'condition',text:'Paciente estable.'}]; state.fluids[p1.id]=[{id:uid(),at:nowISO(),in:500,out:200}]; state.tasks[p1.id]=[{id:uid(),text:'Curación 18:00',done:false}]; saveDB(); }

    // -------------- Pacientes --------------
    function renderPatientSelect(){ const sel = $('#patient-select'); sel.innerHTML=''; Object.values(state.patients).forEach(p=>{ const opt=document.createElement('option'); opt.value=p.id; opt.textContent=`${p.id} – ${p.name}`; sel.appendChild(opt); }); if(state.currentPatientId) sel.value=state.currentPatientId; }

    // -------------- Signos Vitales --------------
    function renderVitals(){ /* ... (Implementation) ... */ }

    // -------------- Medicación --------------
    function renderMeds(){ /* ... (Implementation) ... */ }

    // -------------- Notas --------------
    function renderNotes(){ /* ... (Implementation) ... */ }

    // -------------- Balance Hídrico --------------
    function renderFluids(){ /* ... (Implementation) ... */ }

    // -------------- Tareas --------------
    function renderTasks(){ /* ... (Implementation) ... */ }

    // -------------- Protocolos --------------
    const protocolsData = { /* ... (Expanded Protocols) ... */ };
    function renderProtocols(){ /* ... (Implementation) ... */ }

    // -------------- Drug Interactions --------------
    const drugInteractionsData = { /* ... (Expanded Interactions) ... */ };
    function checkDrugInteractions(){ /* ... (Implementation) ... */ }

    // -------------- Calculadora --------------
    function renderCalculatorInputs(){ /* ... (Implementation) ... */ }
    function calculateBMI(){ /* ... (Implementation) ... */ }
    function calculateDosage(){ /* ... (Implementation) ... */ }
    function calculateIVFlow(){ /* ... (Implementation) ... */ }
    function calculateSurfaceArea(){ /* ... (Implementation) ... */ }
    function calculateGFR(){ /* ... (Implementation) ... */ }

    // -------------- Escuela Médica --------------
    async function searchWiki(term){ /* ... (Implementation) ... */ }
    function renderSchoolResults(result){ /* ... (Implementation) ... */ }

    // -------------- Wireup --------------
    function wire(){
      $('#patient-select')?.addEventListener('change', (e)=>{ state.currentPatientId = e.target.value; saveDB(); renderAll(); });
      $('#nurse-name')?.addEventListener('change', (e)=>{ state.nurse = e.target.value; saveDB(); });
      $('#btn-new-patient')?.addEventListener('click', ()=>{ /* ... */ });
      $('#btn-print')?.addEventListener('click', ()=> window.print());
      $('#btn-export')?.addEventListener('click', () => { /* ... */ });
      $('#import-file')?.addEventListener('change', (ev)=>{ /* ... */ });
      $('#unit-toggle')?.addEventListener('change', (e)=>{ /* ... */ });
      $('#lang-toggle')?.addEventListener('change', (e)=>{ /* ... */ });
      $('#btn-school-search')?.addEventListener('click', async () => { /* ... */ });

      // Add event listeners for buttons within cards
      $('#btn-add-vital')?.addEventListener('click', () => { /* ... */ });
      $('#btn-add-med')?.addEventListener('click', () => { /* ... */ });
      $('#btn-add-note')?.addEventListener('click', () => { /* ... */ });
      $('#btn-add-fluid')?.addEventListener('click', () => { /* ... */ });
      $('#btn-add-task')?.addEventListener('click', () => { /* ... */ });
    }

    function renderAll() { /* ... (Implementation) ... */ }

    loadDB();
    seed();
    renderPatientSelect();
    renderAll();
    wire();
  </script>
</body>
</html>
