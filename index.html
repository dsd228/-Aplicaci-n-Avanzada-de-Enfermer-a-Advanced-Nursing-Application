<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
    <meta name="description" content="Clínica Pro · Sistema Avanzado para Profesionales de la Salud — Guías clínicas, interacciones medicamentosas, procedimientos, gestión de pacientes, recursos médicos, PWA."/>
    <title>Clínica Pro · Sistema Avanzado para Profesionales de la Salud</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --bg: linear-gradient(180deg, #f8fafc, #f1f5f9);
            --glass: rgba(255, 255, 255, 0.95);
            --glass-2: rgba(255, 255, 255, 0.3);
            --accent: #0284c7;
            --accent-2: #0ea5e9;
            --accent-light: #e0f2fe;
            --primary: #7c2d12;
            --secondary: #7c3aed;
            --muted: #64748b;
            --danger: #dc2626;
            --warning: #f59e0b;
            --success: #10b981;
            --card-radius: 16px;
            --shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            --shadow-sm: 0 4px 12px rgba(0, 0, 0, 0.08);
            --tap: 48px;
            --font: 'Inter', system-ui, -apple-system, "Segoe UI", Roboto, Arial;
            --maxwidth: 1400px;
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --border: 1px solid rgba(0, 0, 0, 0.1);
            --spacer-sm: 8px;
            --spacer-md: 16px;
            --spacer-lg: 24px;
            --spacer-xl: 32px;
        }

        :root[data-theme="dark"] {
            --bg: linear-gradient(180deg, #0f172a, #1e293b);
            --glass: rgba(15, 23, 42, 0.95);
            --glass-2: rgba(255, 255, 255, 0.08);
            --accent: #38bdf8;
            --accent-light: #0c4a6e;
            --primary: #f97316;
            --secondary: #a78bfa;
            --muted: #94a3b8;
            --danger: #f87171;
            --warning: #fbbf24;
            --success: #34d399;
            --border: 1px solid rgba(255, 255, 255, 0.1);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        html, body {
            height: 100%;
            scroll-behavior: smooth;
        }

        body {
            margin: 0;
            font-family: var(--font);
            background: var(--bg);
            -webkit-font-smoothing: antialiased;
            color: #0f172a;
            line-height: 1.6;
            position: relative;
            overflow-x: hidden;
        }

        body[data-theme="dark"] {
            color: #e2e8f0;
        }

        .app {
            width: 100%;
            max-width: var(--maxwidth);
            margin: 0 auto;
            padding: 20px;
        }

        /* Header Styles */
        header {
            background: var(--glass);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border-radius: 20px;
            padding: 16px 24px;
            margin-bottom: 24px;
            box-shadow: var(--shadow-sm);
            border: var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 20px;
            z-index: 100;
            transition: var(--transition);
        }

        .header-content {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .logo {
            font-size: 2rem;
            font-weight: 700;
            color: var(--accent);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .logo i {
            font-size: 1.8rem;
        }

        .title {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--primary);
        }

        .header-actions {
            display: flex;
            gap: 12px;
        }

        .icon-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--glass-2);
            border: var(--border);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 1.2rem;
            color: var(--accent);
            transition: var(--transition);
            backdrop-filter: blur(4px);
            -webkit-backdrop-filter: blur(4px);
        }

        .icon-btn:hover {
            background: var(--accent-light);
            transform: translateY(-2px);
            box-shadow: var(--shadow-sm);
        }

        .icon-btn.active {
            background: var(--accent);
            color: white;
        }

        /* Shell Layout */
        .shell {
            display: grid;
            grid-template-columns: 280px 1fr;
            gap: 24px;
            min-height: calc(100vh - 140px);
        }

        /* Sidebar Styles */
        .sidebar {
            background: var(--glass);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border-radius: var(--card-radius);
            padding: 20px;
            box-shadow: var(--shadow-sm);
            border: var(--border);
            height: fit-content;
            position: sticky;
            top: 100px;
            transition: var(--transition);
        }

        .nav-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--accent);
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
        }

        .cat-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 12px;
        }

        .cat-btn {
            padding: 14px 16px;
            border-radius: 12px;
            border: var(--border);
            background: white;
            color: #374151;
            font-weight: 500;
            cursor: pointer;
            text-align: left;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 12px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        .cat-btn:hover {
            background: var(--accent-light);
            color: var(--accent);
            transform: translateY(-1px);
            box-shadow: var(--shadow-sm);
        }

        .cat-btn.active {
            background: var(--accent);
            color: white;
            border-color: var(--accent);
        }

        .cat-btn i {
            font-size: 1.2rem;
            width: 24px;
            text-align: center;
        }

        .cat-btn.full {
            grid-column: 1;
        }

        /* Main Content */
        .main-content {
            display: flex;
            flex-direction: column;
            gap: 24px;
        }

        .card {
            background: var(--glass);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border-radius: var(--card-radius);
            padding: 24px;
            box-shadow: var(--shadow-sm);
            border: var(--border);
            transition: var(--transition);
        }

        .card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 16px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
        }

        .card-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--accent);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .card-title i {
            font-size: 1.3rem;
        }

        /* Tabs */
        .tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
            flex-wrap: wrap;
        }

        .tab {
            padding: 8px 16px;
            border-radius: 8px 8px 0 0;
            cursor: pointer;
            font-weight: 500;
            color: var(--muted);
            transition: var(--transition);
        }

        .tab:hover {
            color: var(--accent);
        }

        .tab.active {
            background: var(--accent);
            color: white;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Search Styles */
        .search-container {
            margin-bottom: 24px;
            position: relative;
        }

        .search-box {
            display: flex;
            gap: 12px;
            margin-bottom: 16px;
        }

        .search-input {
            flex: 1;
            padding: 14px 16px;
            border-radius: 12px;
            border: var(--border);
            background: white;
            font-size: 1rem;
            outline: none;
            transition: var(--transition);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        .search-input:focus {
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(56, 189, 248, 0.2);
        }

        .search-btn {
            padding: 0 20px;
            background: var(--accent);
            color: white;
            border: none;
            border-radius: 12px;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .search-btn:hover {
            background: var(--primary);
            transform: translateY(-1px);
        }

        .suggestions-container {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border-radius: 0 0 12px 12px;
            box-shadow: var(--shadow);
            z-index: 10;
            max-height: 300px;
            overflow-y: auto;
            display: none;
        }

        .suggestion-item {
            padding: 12px 16px;
            cursor: pointer;
            transition: var(--transition);
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        }

        .suggestion-item:hover {
            background: var(--accent-light);
        }

        /* Results Styles */
        .results-container {
            margin-top: 16px;
        }

        .result-card {
            background: white;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            border-left: 4px solid var(--accent);
            transition: var(--transition);
            position: relative;
        }

        .result-card:hover {
            transform: translateX(4px);
            box-shadow: var(--shadow-sm);
        }

        .result-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #1f2937;
            margin-bottom: 8px;
        }

        .result-summary {
            font-size: 0.95rem;
            color: var(--muted);
            margin-bottom: 8px;
        }

        .result-meta {
            display: flex;
            gap: 16px;
            font-size: 0.85rem;
            color: var(--muted);
        }

        .pill {
            background: var(--accent-light);
            color: var(--accent);
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
            display: inline-block;
        }

        .favorite-btn {
            position: absolute;
            top: 16px;
            right: 16px;
            background: none;
            border: none;
            color: var(--muted);
            cursor: pointer;
            font-size: 1.2rem;
            transition: var(--transition);
        }

        .favorite-btn:hover, .favorite-btn.active {
            color: var(--warning);
        }

        /* Procedure Styles */
        .proc-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 16px;
            margin-top: 16px;
        }

        .proc-item {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            transition: var(--transition);
            border: 1px solid rgba(0, 0, 0, 0.1);
            position: relative;
        }

        .proc-item:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-sm);
        }

        .proc-head {
            padding: 16px;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            cursor: pointer;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
        }

        .proc-title {
            font-weight: 600;
            color: #1f2937;
            margin-bottom: 4px;
        }

        .small {
            font-size: 0.85rem;
            color: var(--muted);
        }

        .proc-expand {
            padding: 16px;
            background: #f9fafb;
            display: none;
        }

        .proc-expand.active {
            display: block;
        }

        .proc-expand ol {
            padding-left: 20px;
            margin: 8px 0;
        }

        .proc-expand li {
            margin: 8px 0;
            font-size: 0.95rem;
        }

        .proc-expand ul {
            padding-left: 20px;
            margin: 8px 0;
        }

        .proc-expand ul li {
            margin: 8px 0;
            font-size: 0.95rem;
            list-style-type: disc;
        }

        /* Medication Styles */
        .med-form {
            display: grid;
            grid-template-columns: 1fr 1fr auto;
            gap: 12px;
            margin-bottom: 16px;
        }

        select, input, textarea {
            padding: 12px 16px;
            border-radius: 8px;
            border: var(--border);
            background: white;
            font-size: 1rem;
            outline: none;
            transition: var(--transition);
        }

        select:focus, input:focus, textarea:focus {
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(56, 189, 248, 0.2);
        }

        .check-btn {
            padding: 0 20px;
            background: var(--secondary);
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
        }

        .check-btn:hover {
            background: #7c3aed;
            transform: translateY(-1px);
        }

        .warning {
            color: var(--danger);
            font-weight: 500;
            margin: 8px 0;
        }

        .success {
            color: var(--success);
            font-weight: 500;
            margin: 8px 0;
        }

        .moderate {
            color: var(--warning);
            font-weight: 500;
        }

        .fatal {
            color: var(--danger);
            font-weight: 500;
        }

        /* Wikipedia Styles */
        .wiki-container {
            margin-top: 16px;
        }

        .wiki-output {
            background: white;
            border-radius: 12px;
            padding: 16px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        .wiki-output strong {
            color: #1f2937;
            font-size: 1.1rem;
        }

        .wiki-output .small {
            margin: 8px 0;
            line-height: 1.6;
        }

        .wiki-link {
            display: inline-block;
            margin-top: 8px;
            color: var(--accent);
            text-decoration: none;
            font-weight: 500;
        }

        .wiki-link:hover {
            text-decoration: underline;
        }

        /* Patient Management */
        .patient-selector {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
            flex-wrap: wrap;
        }

        .patient-pill {
            padding: 8px 16px;
            border-radius: 20px;
            background: white;
            border: var(--border);
            cursor: pointer;
            font-size: 0.9rem;
            transition: var(--transition);
        }

        .patient-pill:hover {
            background: var(--accent-light);
            color: var(--accent);
        }

        .patient-pill.active {
            background: var(--accent);
            color: white;
        }

        .search-box-patient {
            margin-bottom: 16px;
        }

        .patient-list {
            display: grid;
            grid-template-columns: 1fr;
            gap: 12px;
        }

        .patient-card {
            background: white;
            border-radius: 12px;
            padding: 16px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            border-left: 4px solid var(--accent);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .patient-info {
            flex: 1;
        }

        .patient-name {
            font-weight: 600;
            color: #1f2937;
            margin-bottom: 4px;
        }

        .patient-details {
            font-size: 0.9rem;
            color: var(--muted);
            display: flex;
            gap: 16px;
        }

        .patient-actions {
            display: flex;
            gap: 8px;
        }

        .btn-action {
            padding: 8px 12px;
            border-radius: 8px;
            border: var(--border);
            background: white;
            cursor: pointer;
            font-size: 0.9rem;
            transition: var(--transition);
        }

        .btn-action:hover {
            background: var(--accent-light);
            color: var(--accent);
        }

        /* Medication Cards */
        .medication-card {
            background: white;
            border-radius: 12px;
            padding: 16px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            margin-bottom: 16px;
        }

        .medication-meta {
            display: flex;
            gap: 12px;
            margin: 8px 0;
            font-size: 0.85rem;
            color: var(--muted);
        }

        .medication-meta span {
            background: var(--accent-light);
            color: var(--accent);
            padding: 4px 8px;
            border-radius: 8px;
        }

        /* Form Styles */
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-bottom: 16px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .form-group label {
            font-weight: 500;
            color: #1f2937;
            font-size: 0.95rem;
        }

        /* Patient Detail View */
        .patient-detail {
            background: white;
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            margin-bottom: 24px;
        }

        .patient-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 20px;
        }

        .patient-main-info {
            flex: 1;
        }

        .patient-name-large {
            font-size: 1.5rem;
            font-weight: 600;
            color: #1f2937;
            margin-bottom: 8px;
        }

        .patient-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 24px;
        }

        .stat-card {
            background: var(--accent-light);
            border-radius: 8px;
            padding: 16px;
            text-align: center;
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--accent);
            margin-bottom: 4px;
        }

        .stat-label {
            font-size: 0.9rem;
            color: var(--muted);
        }

        /* Timeline */
        .timeline {
            position: relative;
            margin: 24px 0;
            padding-left: 24px;
        }

        .timeline::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            height: 100%;
            width: 2px;
            background: var(--accent-light);
        }

        .timeline-item {
            position: relative;
            margin-bottom: 16px;
        }

        .timeline-item::before {
            content: '';
            position: absolute;
            left: -28px;
            top: 8px;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: var(--accent);
        }

        .timeline-date {
            font-size: 0.85rem;
            color: var(--muted);
            margin-bottom: 4px;
        }

        .timeline-content {
            background: #f9fafb;
            border-radius: 8px;
            padding: 12px;
        }

        /* Accessibility Panel */
        .accessibility-panel {
            position: fixed;
            top: 0;
            right: -400px;
            width: 360px;
            height: 100vh;
            background: var(--glass);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border-left: var(--border);
            padding: 24px;
            box-shadow: -5px 0 25px rgba(0, 0, 0, 0.1);
            transition: right 0.3s ease;
            z-index: 1000;
            overflow-y: auto;
        }

        .accessibility-panel.open {
            right: 0;
        }

        .panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }

        .panel-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: var(--accent);
        }

        .close-panel {
            background: none;
            border: none;
            font-size: 1.5rem;
            color: var(--muted);
            cursor: pointer;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
        }

        .close-panel:hover {
            background: rgba(0, 0, 0, 0.1);
            color: var(--danger);
        }

        .option-group {
            margin-bottom: 20px;
        }

        .option-group h4 {
            margin-bottom: 12px;
            color: #1f2937;
            font-weight: 500;
        }

        .toggle-option {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            border-radius: 8px;
            cursor: pointer;
            transition: var(--transition);
        }

        .toggle-option:hover {
            background: var(--accent-light);
        }

        .toggle-slider {
            position: relative;
            width: 44px;
            height: 24px;
            border-radius: 12px;
            background: #e5e7eb;
            transition: var(--transition);
        }

        .toggle-slider::before {
            content: '';
            position: absolute;
            top: 2px;
            left: 2px;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: white;
            transition: var(--transition);
        }

        .toggle-input:checked + .toggle-slider {
            background: var(--accent);
        }

        .toggle-input:checked + .toggle-slider::before {
            transform: translateX(20px);
        }

        .option-content {
            flex: 1;
        }

        .option-title {
            font-weight: 500;
            color: #1f2937;
        }

        .option-description {
            font-size: 0.85rem;
            color: var(--muted);
        }

        .panel-actions {
            display: flex;
            gap: 12px;
            margin-top: 24px;
            padding-top: 24px;
            border-top: 1px solid rgba(0, 0, 0, 0.1);
        }

        .panel-btn {
            flex: 1;
            padding: 12px;
            border-radius: 8px;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
            text-align: center;
        }

        .panel-btn.primary {
            background: var(--accent);
            color: white;
            border: none;
        }

        .panel-btn.secondary {
            background: transparent;
            color: var(--muted);
            border: 1px solid rgba(0, 0, 0, 0.1);
        }

        .panel-btn:hover {
            transform: translateY(-1px);
            box-shadow: var(--shadow-sm);
        }

        .panel-btn.primary:hover {
            background: var(--primary);
        }

        /* Toast Notifications */
        .toast-container {
            position: fixed;
            bottom: 24px;
            right: 24px;
            z-index: 1000;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .toast {
            background: var(--glass);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border-radius: 8px;
            padding: 16px;
            box-shadow: var(--shadow);
            border: var(--border);
            display: flex;
            align-items: center;
            gap: 12px;
            animation: slideIn 0.3s ease forwards;
            max-width: 350px;
        }

        .toast.success {
            border-left: 4px solid var(--success);
        }

        .toast.error {
            border-left: 4px solid var(--danger);
        }

        .toast.warning {
            border-left: 4px solid var(--warning);
        }

        .toast.info {
            border-left: 4px solid var(--accent);
        }

        .toast-icon {
            font-size: 1.2rem;
        }

        .toast.success .toast-icon {
            color: var(--success);
        }

        .toast.error .toast-icon {
            color: var(--danger);
        }

        .toast.warning .toast-icon {
            color: var(--warning);
        }

        .toast.info .toast-icon {
            color: var(--accent);
        }

        .toast-content {
            flex: 1;
        }

        .toast-title {
            font-weight: 600;
            margin-bottom: 4px;
        }

        .toast-message {
            font-size: 0.9rem;
            color: var(--muted);
        }

        .toast-close {
            background: none;
            border: none;
            color: var(--muted);
            cursor: pointer;
            font-size: 1.2rem;
        }

        /* Responsive Design */
        @media (max-width: 992px) {
            .shell {
                grid-template-columns: 1fr;
            }

            .sidebar {
                position: relative;
                top: 0;
                width: 100%;
                margin-bottom: 24px;
            }

            .med-form {
                grid-template-columns: 1fr;
                gap: 8px;
            }

            .med-form button {
                grid-column: 1;
            }

            .form-row {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            header {
                padding: 12px 16px;
            }

            .logo {
                font-size: 1.5rem;
            }

            .title {
                font-size: 1.2rem;
            }

            .app {
                padding: 16px;
            }

            .card {
                padding: 16px;
            }

            .card-title {
                font-size: 1.3rem;
            }

            .proc-list {
                grid-template-columns: 1fr;
            }

            .accessibility-panel {
                width: 100%;
                right: -100%;
            }

            .patient-stats {
                grid-template-columns: 1fr;
            }
        }

        /* Animations */
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(100%);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .result-card, .proc-item, .patient-card, .medication-card {
            animation: fadeIn 0.3s ease forwards;
        }

        .result-card {
            animation-delay: 0.1s;
        }

        .result-card:nth-child(2) {
            animation-delay: 0.2s;
        }

        .result-card:nth-child(3) {
            animation-delay: 0.3s;
        }

        /* Icons */
        .icon-btn i, .cat-btn i, .card-title i {
            transition: var(--transition);
        }

        .icon-btn:hover i {
            transform: scale(1.1);
        }
    </style>
</head>
<body>
    <div class="app">
        <header>
            <div class="header-content">
                <div class="logo">
                    <i class="fas fa-clinic-medical"></i>
                    <span>Clínica Pro</span>
                </div>
                <div class="title">Sistema Avanzado para Profesionales de la Salud</div>
            </div>
            <div class="header-actions">
                <button id="themeBtn" class="icon-btn" aria-label="Tema">
                    <i class="fas fa-moon"></i>
                </button>
                <button id="accessibilityBtn" class="icon-btn" onclick="toggleAccessibilityPanel()" aria-label="Accesibilidad">
                    <i class="fas fa-universal-access"></i>
                </button>
                <button id="menuToggle" class="icon-btn" aria-label="Menú">
                    <i class="fas fa-bars"></i>
                </button>
            </div>
        </header>

        <div class="shell" role="main">
            <!-- Sidebar -->
            <nav class="sidebar" id="sidebar" aria-label="Categorías">
                <div class="nav-title">Procedimientos Clínicos</div>
                <div class="cat-grid" role="navigation">
                    <button class="cat-btn active" data-cat="higiene">
                        <i class="fas fa-hand-sparkles"></i>
                        Higiene
                    </button>
                    <button class="cat-btn" data-cat="curaciones">
                        <i class="fas fa-band-aid"></i>
                        Curaciones
                    </button>
                    <button class="cat-btn" data-cat="farmaco">
                        <i class="fas fa-pills"></i>
                        Farmacología
                    </button>
                    <button class="cat-btn" data-cat="emergencias">
                        <i class="fas fa-ambulance"></i>
                        Emergencias
                    </button>
                    <button class="cat-btn" data-cat="movilizacion">
                        <i class="fas fa-walking"></i>
                        Movilización
                    </button>
                    <button class="cat-btn" data-cat="nutricion">
                        <i class="fas fa-apple-alt"></i>
                        Nutrición
                    </button>
                    <button class="cat-btn" data-cat="infeccion">
                        <i class="fas fa-virus"></i>
                        Control Infección
                    </button>
                </div>

                <div class="nav-title">Recursos Médicos</div>
                <div class="cat-grid">
                    <button class="cat-btn full" data-cat="medicamentos">
                        <i class="fas fa-prescription-bottle-alt"></i>
                        Medicamentos
                    </button>
                    <button class="cat-btn full" data-cat="enfermedades">
                        <i class="fas fa-disease"></i>
                        Enfermedades
                    </button>
                    <button class="cat-btn full" data-cat="guias">
                        <i class="fas fa-book-medical"></i>
                        Guías Clínicas
                    </button>
                </div>

                <div class="nav-title">Gestión de Pacientes</div>
                <div class="cat-grid">
                    <button class="cat-btn full" data-cat="pacientes">
                        <i class="fas fa-users"></i>
                        Lista de Pacientes
                    </button>
                    <button class="cat-btn full" data-cat="pae">
                        <i class="fas fa-clipboard-list"></i>
                        PAE
                    </button>
                </div>

                <div class="nav-title">Favoritos</div>
                <div class="cat-grid">
                    <button class="cat-btn full" data-cat="favoritos">
                        <i class="fas fa-star"></i>
                        Mis Favoritos
                    </button>
                </div>
            </nav>

            <!-- Main Content -->
            <div class="main-content">
                <!-- Search Section -->
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">
                            <i class="fas fa-search"></i>
                            Búsqueda Rápida
                        </h2>
                    </div>
                    <div class="search-container">
                        <div class="search-box">
                            <input type="text" id="globalSearch" class="search-input" placeholder="Buscar procedimientos, enfermedades, medicamentos, guías..." aria-label="Campo de búsqueda">
                            <button id="searchBtn" class="search-btn">
                                <i class="fas fa-search"></i>
                                Buscar
                            </button>
                        </div>
                        <div class="suggestions-container" id="searchSuggestions"></div>
                        <div id="searchResults"></div>
                    </div>
                </div>

                <!-- Tabs for Content -->
                <div class="tabs" id="contentTabs">
                    <div class="tab active" data-tab="procedimientos">Procedimientos</div>
                    <div class="tab" data-tab="interacciones">Interacciones</div>
                    <div class="tab" data-tab="enfermedades">Enfermedades</div>
                    <div class="tab" data-tab="pacientes">Pacientes</div>
                </div>

                <!-- Procedures Section -->
                <div class="tab-content active" id="procedimientosContent">
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">
                                <i class="fas fa-list"></i>
                                Procedimientos Clínicos
                            </h2>
                            <div class="header-actions">
                                <button class="icon-btn" id="filterProcedures" aria-label="Filtrar">
                                    <i class="fas fa-filter"></i>
                                </button>
                                <button class="icon-btn" id="sortProcedures" aria-label="Ordenar">
                                    <i class="fas fa-sort"></i>
                                </button>
                            </div>
                        </div>
                        <div class="proc-list" id="proceduresList"></div>
                    </div>
                </div>

                <!-- Medication Interaction Checker -->
                <div class="tab-content" id="interaccionesContent">
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">
                                <i class="fas fa-prescription-bottle"></i>
                                Combinador de Fármacos
                            </h2>
                        </div>
                        <div class="med-form">
                            <input list="medsList" id="medSelectA" class="search-input" placeholder="Seleccionar medicamento A">
                            <datalist id="medsList">
                                <!-- Options will be populated by JavaScript -->
                            </datalist>
                            <input list="medsList" id="medSelectB" class="search-input" placeholder="Seleccionar medicamento B">
                            <button id="checkInteraction" class="check-btn">Verificar Interacción</button>
                        </div>
                        <div id="interactionResult"></div>

                        <div class="card-header" style="margin-top: 24px;">
                            <h2 class="card-title">
                                <i class="fas fa-calculator"></i>
                                Calculadora de Dosis
                            </h2>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="doseWeight">Peso del paciente (kg)</label>
                                <input type="number" id="doseWeight" placeholder="Ej: 70">
                            </div>
                            <div class="form-group">
                                <label for="doseMedication">Medicamento</label>
                                <input list="medsList" id="doseMedication" class="search-input" placeholder="Seleccionar medicamento">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="doseDose">Dosis (mg/kg)</label>
                                <input type="number" id="doseDose" placeholder="Ej: 5">
                            </div>
                            <div class="form-group">
                                <label for="doseFrequency">Frecuencia</label>
                                <select id="doseFrequency">
                                    <option value="1">Una vez al día</option>
                                    <option value="2">Cada 12 horas</option>
                                    <option value="3">Cada 8 horas</option>
                                    <option value="4">Cada 6 horas</option>
                                </select>
                            </div>
                        </div>
                        <button id="calculateDose" class="check-btn">Calcular Dosis</button>
                        <div id="doseResult" style="margin-top: 16px;"></div>
                    </div>
                </div>

                <!-- Disease Information -->
                <div class="tab-content" id="enfermedadesContent">
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">
                                <i class="fas fa-disease"></i>
                                Información Médica
                            </h2>
                        </div>
                        <div class="search-box">
                            <input type="text" id="diseaseSearch" class="search-input" placeholder="Buscar enfermedad (ej: neumonía)">
                            <button id="wikiFetchBtn" class="search-btn">
                                <i class="fas fa-book-medical"></i>
                                Buscar
                            </button>
                        </div>
                        <div class="wiki-container">
                            <div id="wikiOutput"></div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">
                                <i class="fas fa-book-medical"></i>
                                Guías Clínicas
                            </h2>
                        </div>
                        <div id="guidesList"></div>
                    </div>
                </div>

                <!-- Patient Management -->
                <div class="tab-content" id="pacientesContent">
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">
                                <i class="fas fa-users"></i>
                                Gestión de Pacientes
                            </h2>
                            <button id="addPatient" class="check-btn">
                                <i class="fas fa-plus"></i>
                                Nuevo Paciente
                            </button>
                        </div>
                        <div class="search-box-patient">
                            <input type="text" class="search-input" placeholder="Buscar pacientes...">
                        </div>
                        <div class="patient-selector">
                            <div class="patient-pill active">Todos</div>
                            <div class="patient-pill">Cardiología</div>
                            <div class="patient-pill">Endocrinología</div>
                            <div class="patient-pill">Reumatología</div>
                        </div>
                        <div class="patient-list" id="patientList"></div>
                    </div>

                    <!-- Patient Detail View (initially hidden) -->
                    <div class="patient-detail" id="patientDetail" style="display: none;">
                        <div class="patient-header">
                            <div class="patient-main-info">
                                <h2 class="patient-name-large" id="detailPatientName">Nombre del Paciente</h2>
                                <div class="patient-details">
                                    <span id="detailPatientAge">Edad</span> •
                                    <span id="detailPatientGender">Género</span> •
                                    <span id="detailPatientPhone">Teléfono</span> •
                                    <span id="detailPatientEmail">Email</span>
                                </div>
                                <div class="small" id="detailPatientDiagnosis">Diagnóstico</div>
                            </div>
                            <div class="patient-actions">
                                <button class="btn-action" id="editPatient">
                                    <i class="fas fa-edit"></i> Editar
                                </button>
                                <button class="btn-action" id="closePatientDetail">
                                    <i class="fas fa-times"></i> Cerrar
                                </button>
                            </div>
                        </div>

                        <div class="patient-stats">
                            <div class="stat-card">
                                <div class="stat-value" id="statVisits">0</div>
                                <div class="stat-label">Visitas</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value" id="statMeds">0</div>
                                <div class="stat-label">Medicamentos</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value" id="statLastVisit">-</div>
                                <div class="stat-label">Última visita</div>
                            </div>
                        </div>

                        <div class="tabs">
                            <div class="tab active" data-tab="historial">Historial</div>
                            <div class="tab" data-tab="medicamentos">Medicamentos</div>
                            <div class="tab" data-tab="notas">Notas</div>
                        </div>

                        <div class="tab-content active" id="historialContent">
                            <div class="timeline" id="patientTimeline"></div>
                        </div>

                        <div class="tab-content" id="medicamentosContent">
                            <div id="patientMedsList"></div>
                        </div>

                        <div class="tab-content" id="notasContent">
                            <div class="form-group">
                                <label for="patientNotes">Notas del paciente</label>
                                <textarea id="patientNotes" rows="6" placeholder="Agregar notas sobre el paciente..."></textarea>
                            </div>
                            <button id="savePatientNotes" class="check-btn">Guardar Notas</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Toast Container -->
        <div class="toast-container" id="toastContainer"></div>

        <!-- Accessibility Panel -->
        <div class="accessibility-panel" id="accessibilityPanel">
            <div class="panel-header">
                <h3 class="panel-title">Accesibilidad</h3>
                <button class="close-panel" onclick="toggleAccessibilityPanel()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="option-group">
                <h4>Modo de visualización</h4>
                <label class="toggle-option">
                    <input type="checkbox" class="toggle-input" id="highContrast">
                    <span class="toggle-slider"></span>
                    <span class="option-content">
                        <span class="option-title">Alto contraste</span>
                        <span class="option-description">Mejora la visibilidad del texto</span>
                    </span>
                </label>
                <label class="toggle-option">
                    <input type="checkbox" class="toggle-input" id="dyslexiaFont">
                    <span class="toggle-slider"></span>
                    <span class="option-content">
                        <span class="option-title">Fuente para dislexia</span>
                        <span class="option-description">Usa una fuente especializada</span>
                    </span>
                </label>
            </div>
            <div class="option-group">
                <h4>Navegación</h4>
                <label class="toggle-option">
                    <input type="checkbox" class="toggle-input" id="keyboardNavigation">
                    <span class="toggle-slider"></span>
                    <span class="option-content">
                        <span class="option-title">Navegación por teclado</span>
                        <span class="option-description">Mejora el enfoque de elementos</span>
                    </span>
                </label>
                <label class="toggle-option">
                    <input type="checkbox" class="toggle-input" id="reducedMotion">
                    <span class="toggle-slider"></span>
                    <span class="option-content">
                        <span class="option-title">Movimiento reducido</span>
                        <span class="option-description">Reduce animaciones y transiciones</span>
                    </span>
                </label>
            </div>
            <div class="option-group">
                <h4>Texto</h4>
                <label class="toggle-option">
                    <input type="checkbox" class="toggle-input" id="textToSpeech">
                    <span class="toggle-slider"></span>
                    <span class="option-content">
                        <span class="option-title">Lectura de texto</span>
                        <span class="option-description">Lee el contenido en voz alta</span>
                    </span>
                </label>
            </div>
            <div class="panel-actions">
                <button class="panel-btn secondary" onclick="resetAccessibility()">Restablecer</button>
                <button class="panel-btn primary" onclick="applyAccessibility()">Aplicar</button>
            </div>
        </div>
    </div>

    <script>
        // DOM Helper
        const $ = id => document.getElementById(id);

        // Data
        const PROCEDURES = {
            higiene: [
                {
                    id: 'lavado_manos',
                    title: 'Lavado de manos',
                    summary: 'Procedimiento esencial para prevenir infecciones',
                    steps: [
                        'Mojar las manos con agua',
                        'Aplicar suficiente jabón',
                        'Frotar todas las superficies durante 20 segundos',
                        'Enjuagar completamente',
                        'Secar con toalla de papel desechable'
                    ],
                    category: 'higiene',
                    time: '5 min',
                    difficulty: 'Baja'
                },
                {
                    id: 'baño_cama',
                    title: 'Baño en cama',
                    summary: 'Higiene integral del paciente encamado.',
                    steps: [
                        'Preparar equipo',
                        'Proteger intimidad',
                        'Limpiar de proximal a distal',
                        'Secar y vestir'
                    ],
                    category: 'higiene',
                    time: '20 min',
                    difficulty: 'Media'
                },
                {
                    id: 'higiene_oral',
                    title: 'Higiene oral',
                    summary: 'Prevención de infecciones orales y cuidado de mucosas.',
                    steps: [
                        'Explicar procedimiento',
                        'Posicionar paciente',
                        'Limpiar suavemente',
                        'Enjuagar y documentar'
                    ],
                    category: 'higiene',
                    time: '10 min',
                    difficulty: 'Baja'
                },
                {
                    id: 'cuidado_piel',
                    title: 'Cuidado de piel frágil',
                    summary: 'Higiene y protección de la piel en pacientes de edad avanzada',
                    steps: [
                        'Evaluar piel',
                        'Aplicar emolientes',
                        'Evitar fricciones'
                    ],
                    category: 'higiene',
                    notes: 'Aumentar hidratación cutánea.',
                    time: '15 min',
                    difficulty: 'Media'
                },
                {
                    id: 'cuidado_ongles',
                    title: 'Cuidado de uñas',
                    summary: 'Prevención de colonización bacteriana en uñas largas.',
                    steps: [
                        'Cortar con técnica',
                        'No cortar cutícula si no indicado'
                    ],
                    category: 'higiene',
                    notes: 'Evitar instrumentos compartidos.',
                    time: '10 min',
                    difficulty: 'Baja'
                }
            ],
            curaciones: [
                {
                    id: 'curacion_simple',
                    title: 'Curación de herida simple',
                    summary: 'Cambio de apósito en heridas limpias.',
                    steps: [
                        'Higiene',
                        'Retirar apósito',
                        'Irrigar con solución salina',
                        'Aplicar apósito nuevo'
                    ],
                    category: 'curaciones',
                    notes: 'Registrar aspecto y exudado.',
                    time: '15 min',
                    difficulty: 'Media'
                },
                {
                    id: 'curacion_escaras',
                    title: 'Curación de escaras',
                    summary: 'Manejo y alivio de presión.',
                    steps: [
                        'Evaluar estadío',
                        'Reposicionar cada 2h',
                        'Aplicar apósito especializado'
                    ],
                    category: 'curaciones',
                    time: '20 min',
                    difficulty: 'Alta'
                },
                {
                    id: 'curacion_quirurgica',
                    title: 'Curación postquirúrgica',
                    summary: 'Seguimiento de heridas operatorias.',
                    steps: [
                        'Comprobar sellado',
                        'Limpieza estéril',
                        'Registrar signos infección'
                    ],
                    category: 'curaciones',
                    time: '15 min',
                    difficulty: 'Media'
                },
                {
                    id: 'curacion_absceso',
                    title: 'Drenaje y curación de absceso',
                    summary: 'Drenaje y cuidados post-drenaje',
                    steps: [
                        'Valorar herida',
                        'Drenar por profesional',
                        'Curar y control'
                    ],
                    category: 'curaciones',
                    notes: 'Derivar si sospecha de celulitis.',
                    time: '25 min',
                    difficulty: 'Alta'
                },
                {
                    id: 'curacion_valvula',
                    title: 'Cambio de apósito con drenaje',
                    summary: 'Cuidado en heridas con drenaje activo',
                    steps: [
                        'Evitar contaminación',
                        'Documentar volumen y aspecto'
                    ],
                    category: 'curaciones',
                    notes: 'Usar apósitos adsorbentes.',
                    time: '20 min',
                    difficulty: 'Media'
                }
            ],
            farmaco: [
                {
                    id: 'admin_oral',
                    title: 'Administración oral',
                    summary: 'Verificar 5 correctos antes de administrar',
                    steps: [
                        'Identificar paciente',
                        'Comprobar fármaco/dosis/vía/hora',
                        'Administrar y registrar'
                    ],
                    category: 'farmaco',
                    notes: 'Revisar alergias.',
                    time: '10 min',
                    difficulty: 'Baja'
                },
                {
                    id: 'admin_ev',
                    title: 'Administración EV (bolus)',
                    summary: 'Preparación y administración por vía venosa',
                    steps: [
                        'Verificar prescripción',
                        'Diluir si necesario',
                        'Administrar según velocidad',
                        'Observar reacciones'
                    ],
                    category: 'farmaco',
                    notes: 'Solo personal habilitado.',
                    time: '15 min',
                    difficulty: 'Alta'
                },
                {
                    id: 'oxigenoterapia',
                    title: 'Oxigenoterapia',
                    summary: 'Cánula nasal o mascarilla según indicación',
                    steps: [
                        'Verificar orden',
                        'Colocar dispositivo',
                        'Monitorizar SpO2'
                    ],
                    category: 'farmaco',
                    time: '10 min',
                    difficulty: 'Media'
                },
                {
                    id: 'vacunas',
                    title: 'Administración de vacuna IM',
                    summary: 'Preparación estéril y registro de lote',
                    steps: [
                        'Verificar vacuna y lote',
                        'Administrar en sitio apropiado',
                        'Registrar lote y reacciones'
                    ],
                    category: 'farmaco',
                    time: '15 min',
                    difficulty: 'Media'
                },
                {
                    id: 'dosis_peso',
                    title: 'Dosis según peso',
                    summary: 'Calcular dosis por kg ejemplo',
                    steps: [
                        'Calcular kg',
                        'Aplicar mg/kg'
                    ],
                    category: 'farmaco',
                    notes: 'Ejemplo 10 mg/kg como referencia no universal.',
                    time: '5 min',
                    difficulty: 'Baja'
                }
            ],
            emergencias: [
                {
                    id: 'rcp',
                    title: 'RCP básica (adulto)',
                    summary: 'Comprimir 100-120/min y 5-6 cm de profundidad',
                    steps: [
                        'Seguridad',
                        'Comprobar respuesta',
                        'Llamar ayuda',
                        'Iniciar compresiones 30:2 o continuas según guía',
                        'Usar DEA'
                    ],
                    category: 'emergencias',
                    time: 'Variable',
                    difficulty: 'Alta'
                },
                {
                    id: 'anafilaxia',
                    title: 'Manejo de anafilaxia',
                    summary: 'Reconocer y actuar rápido',
                    steps: [
                        'Evaluar vía aérea',
                        'Administrar adrenalina IM',
                        'Oxigenoterapia',
                        'Monitorizar'
                    ],
                    category: 'emergencias',
                    time: '15 min',
                    difficulty: 'Alta'
                },
                {
                    id: 'sintomaticos',
                    title: 'Manejo inicial del síncope',
                    summary: 'Evaluar causas y medidas iniciales',
                    steps: [
                        'Posición supina',
                        'Abrir vía aérea',
                        'Monitorizar'
                    ],
                    category: 'emergencias',
                    notes: 'Buscar causa subyacente.',
                    time: '10 min',
                    difficulty: 'Media'
                }
            ],
            movilizacion: [
                {
                    id: 'transferencia',
                    title: 'Transferencia de pacientes',
                    summary: 'Movilización segura de pacientes',
                    steps: [
                        'Evaluar riesgo de caídas',
                        'Explicar el procedimiento al paciente',
                        'Usar equipo de ayuda mecánica si necesario',
                        'Mantener espalda recta durante la maniobra',
                        'Verificar posición final del paciente'
                    ],
                    category: 'movilizacion',
                    time: '15 min',
                    difficulty: 'Media'
                },
                {
                    id: 'ayuda_mec',
                    title: 'Uso de ayuda mecánica',
                    summary: 'Uso de grúa y tablas',
                    steps: [
                        'Evaluar necesidad',
                        'Coordinación equipo',
                        'Seguridad paciente'
                    ],
                    category: 'movilizacion',
                    notes: 'Formación previa necesaria.',
                    time: '20 min',
                    difficulty: 'Alta'
                }
            ],
            nutricion: [
                {
                    id: 'nutricion_basica',
                    title: 'Nutrición básica',
                    summary: 'Principios de alimentación equilibrada',
                    steps: [
                        'Evaluar estado nutricional',
                        'Planificar dieta adecuada',
                        'Monitorizar ingesta'
                    ],
                    category: 'nutricion',
                    time: '30 min',
                    difficulty: 'Media'
                }
            ],
            infeccion: [
                {
                    id: 'control_infeccion',
                    title: 'Control de infecciones',
                    summary: 'Protocolos para prevenir infecciones nosocomiales',
                    steps: [
                        'Higiene de manos',
                        'Uso adecuado de EPP',
                        'Aislamientos según protocolo'
                    ],
                    category: 'infeccion',
                    time: 'Variable',
                    difficulty: 'Media'
                },
                {
                    id: 'control_infeccion_cateter',
                    title: 'Cuidados de catéter central',
                    summary: 'Mantener técnica estéril',
                    steps: [
                        'Higiene de manos',
                        'Cambiar apósito según protocolo',
                        'Registrar signos infección'
                    ],
                    category: 'infeccion',
                    time: '20 min',
                    difficulty: 'Alta'
                }
            ]
        };

        const DISEASES = [
            {
                name: 'Neumonía',
                summary: 'Infección inflamatoria aguda del parénquima pulmonar, generalmente causada por bacterias, virus o hongos. Presenta fiebre, tos, disnea y crepitaciones en la auscultación.',
                category: 'Respiratorio'
            },
            {
                name: 'Diabetes Mellitus',
                summary: 'Trastorno metabólico caracterizado por hiperglucemia crónica debido a defectos en la secreción o acción de la insulina. Requiere control estricto de glucemia y manejo de complicaciones.',
                category: 'Endocrino'
            },
            {
                name: 'Insuficiencia Cardíaca',
                summary: 'Síndrome clínico complejo donde el corazón no puede bombear suficiente sangre para satisfacer las necesidades del organismo. Presenta disnea, edema periférico y fatiga.',
                category: 'Cardiovascular'
            },
            {
                name: 'EPOC',
                summary: 'Enfermedad pulmonar obstructiva crónica caracterizada por obstrucción persistente del flujo aéreo. Asociada principalmente al tabaquismo y presenta tos crónica, expectoración y disnea progresiva.',
                category: 'Respiratorio'
            },
            {
                name: 'Hipertensión Arterial',
                summary: 'Elevación sostenida de la presión arterial sistólica ≥140 mmHg y/o diastólica ≥90 mmHg. Factor de riesgo importante para enfermedades cardiovasculares y renales.',
                category: 'Cardiovascular'
            },
            {
                name: 'VIH/SIDA',
                summary: 'Infección por virus de inmunodeficiencia humana que afecta al sistema inmunitario. Requiere tratamiento antirretroviral y seguimiento inmunológico.',
                category: 'Infeccioso'
            }
        ];

        const MEDS = [
            "Warfarina", "Ibuprofeno", "Paracetamol", "Ciprofloxacina", "Metformina", "Sertralina", "Omeprazol", "Sildenafil", "Nitroglicerina", "Clopidogrel",
            "Digoxina", "Verapamilo", "Fenelzina (MAOI)", "Sertralina (SSRI)", "Contraste iodado", "Simvastatina", "Eritromicina", "Gemfibrozil", "Metotrexato", "Linezolid",
            "Acetaminofén", "Amitriptilina", "Amoxicilina", "Atenolol", "Azitromicina", "Carbamazepina", "Cetirizina", "Ciprofloxacina", "Clonazepam", "Codeína",
            "Dexametasona", "Diazepam", "Diclofenaco", "Digoxina", "Dipirona", "Enalapril", "Eritromicina", "Escitalopram", "Fentanilo", "Furosemida",
            "Gabapentina", "Haloperidol", "Hidralazina", "Hidroclorotiazida", "Hidroxicina", "Ibuprofeno", "Insulina", "Ketoconazol", "Lansoprazol", "Levotiroxina",
            "Lidocaína", "Lisinopril", "Lorazepam", "Metformina", "Metoclopramida", "Metoprolol", "Morfina", "Nistatina", "Omeprazol", "Oxazepam",
            "Paracetamol", "Prednisona", "Propranolol", "Quetiapina", "Ranitidina", "Sertralina", "Simvastatina", "Tamsulosina", "Tiopental", "Tolbutamida",
            "Tramadol", "Valproato", "Zidovudina"
        ];

        const NEVER_COMBINE = [
            { a: "warfarina", b: "aspirina", reason: "Riesgo extremo de hemorragia", severity: "Alta", ref: "https://www.drugs.com" },
            { a: "digoxina", b: "verapamilo", reason: "Riesgo de bradicardia severa", severity: "Alta", ref: "https://www.drugs.com" },
            { a: "simvastatina", b: "itraconazol", reason: "Riesgo de rabdomiólisis", severity: "Alta", ref: "https://www.drugs.com" },
            { a: "metformina", b: "contraste iodado", reason: "Riesgo de acidosis láctica", severity: "Alta", ref: "https://www.drugs.com" },
            { a: "sildenafil", b: "nitroglicerina", reason: "Hipotensión grave", severity: "Alta", ref: "https://www.drugs.com" },
            { a: "sildenafil", b: "ibuprofen", reason: "Interacción moderada", severity: "Moderada", ref: "https://www.drugs.com" },
            { a: "warfarina", b: "ibuprofen", reason: "AINEs aumentan riesgo de sangrado", severity: "Alta", ref: "https://www.ema.europa.eu" },
            { a: "erythromycin", b: "simvastatin", reason: "Aumento riesgo miopatía/rabdomiólisis", severity: "Alta", ref: "https://www.fda.gov" },
            { a: "macrolide", b: "warfarin", reason: "Potenciación anticoagulante", severity: "Alta", ref: "https://www.ema.europa.eu" },
            { a: "tetracycline", b: "isotretinoin", reason: "Fotosensibilidad y efectos adversos sinérgicos", severity: "Moderada", ref: "https://www.ncbi.nlm.nih.gov" },
            { a: "theophylline", b: "ciprofloxacin", reason: "Aumento niveles teofilina", severity: "Moderada", ref: "https://www.fda.gov" },
            { a: "methotrexate", b: "trimethoprim", reason: "Aumento toxicidad hematológica", severity: "Alta", ref: "https://www.ema.europa.eu" },
            { a: "statin", b: "gemfibrozil", reason: "Aumento riesgo de rabdomiólisis", severity: "Alta", ref: "https://www.fda.gov" },
            { a: "warfarin", b: "amiodarone", reason: "Alteración metabolismo de warfarina", severity: "Alta", ref: "https://www.ncbi.nlm.nih.gov" },
            { a: "ssri", b: "triptan", reason: "Riesgo serotoninérgico", severity: "Alta", ref: "https://www.fda.gov" },
            { a: "linezolid", b: "ssri", reason: "Riesgo serotoninérgico", severity: "Alta", ref: "https://www.fda.gov" },
            { a: "fluoroquinolone", b: "theophylline", reason: "Aumenta niveles theophylline", severity: "Moderada", ref: "https://www.ema.europa.eu" },
            { a: "warfarin", b: "broad_spectrum_antibiotic", reason: "Alteraciones en flora y aumento efecto anticoagulante", severity: "Moderada", ref: "https://www.fda.gov" },
            { a: "oral_anticoagulant", b: "heparin", reason: "Duplicación efecto anticoagulante", severity: "Alta", ref: "https://www.ncbi.nlm.nih.gov" },
            { a: "st_johns_wort", b: "oral_contraceptive", reason: "Reducción eficacia anticonceptiva", severity: "Moderada", ref: "https://www.ema.europa.eu" },
            { a: "carbamazepine", b: "oral_contraceptive", reason: "Reducción eficacia anticonceptiva", severity: "Moderada", ref: "https://www.fda.gov" },
            { a: "warfarin", b: "ginkgo", reason: "Aumenta riesgo sangrado", severity: "Moderada", ref: "https://www.ncbi.nlm.nih.gov" },
            { a: "sulfonylurea", b: "fluoroquinolone", reason: "Aumento riesgo hipoglucemia", severity: "Moderada", ref: "https://www.fda.gov" },
            { a: "clopidogrel", b: "omeprazole", reason: "Posible interacción", severity: "Baja", ref: "https://www.ema.europa.eu" },
            { a: "monoamine_inhibitor", b: "tyramine_rich_foods", reason: "Crisis hipertensiva", severity: "Alta", ref: "https://www.ncbi.nlm.nih.gov" },
            { a: "chlorpromazine", b: "ciprofloxacin", reason: "Prolongación QT", severity: "Moderada", ref: "https://www.fda.gov" },
            { a: "sotalol", b: "macrolide", reason: "Prolongación QT", severity: "Moderada", ref: "https://www.fda.gov" },
            { a: "dofetilide", b: "verapamil", reason: "Interacciones cardiacas graves", severity: "Alta", ref: "https://www.fda.gov" },
            { a: "linezolid", b: "tyramine", reason: "Riesgo hipertensivo", severity: "Moderada", ref: "https://www.ncbi.nlm.nih.gov" },
            { a: "warfarin", b: "amoxicillin_clavulanate", reason: "Variabilidad de INR", severity: "Moderada", ref: "https://www.fda.gov" },
            { a: "valproate", b: "lamotrigine", reason: "Aumento riesgo de efectos adversos neurológicos", severity: "Moderada", ref: "https://www.ncbi.nlm.nih.gov" },
            { a: "azathioprine", b: "allopurinol", reason: "Riesgo mielosupresión", severity: "Alta", ref: "https://www.ncbi.nlm.nih.gov" },
            { a: "propranolol", b: "albuterol", reason: "Broncoespasmo riesgo", severity: "Moderada", ref: "https://www.fda.gov" }
        ];

        const GUIDES = [
            {
                title: "Guía de Práctica Clínica para el Manejo de la Diabetes Tipo 2",
                summary: "Actualización 2023. Incluye algoritmos de tratamiento, metas glucémicas y manejo de complicaciones.",
                tags: ["ADA", "Diabetes", "56 páginas", "PDF"],
                category: "Endocrino"
            },
            {
                title: "Guías ESC 2023 para el Manejo de la Cardiopatía Coronaria",
                summary: "Nuevas recomendaciones sobre estrategias de revascularización y tratamiento médico óptimo.",
                tags: ["Cardiología", "ESC", "48 páginas", "PDF"],
                category: "Cardiovascular"
            },
            {
                title: "Guía de Alimentación Saludable",
                summary: "Recomendaciones nutricionales, plan de alimentación y recetas saludables para pacientes.",
                tags: ["Nutrición", "20 páginas", "PDF"],
                category: "Nutrición"
            },
            {
                title: "Guía de Actividad Física",
                summary: "Recomendaciones de ejercicio según condición clínica y nivel de capacidad física.",
                tags: ["Ejercicio", "14 páginas", "PDF"],
                category: "Rehabilitación"
            },
            {
                title: "Manual de Farmacología Clínica",
                summary: "Guía rápida de dosificación, interacciones y efectos adversos de medicamentos de uso común.",
                tags: ["Farmacología", "68 páginas", "PDF"],
                category: "Farmacología"
            },
            {
                title: "Guía de Antibióticos",
                summary: "Spectro de actividad, dosificación en insuficiencia renal y consideraciones especiales.",
                tags: ["Antibióticos", "32 páginas", "PDF"],
                category: "Infeccioso"
            },
            {
                title: "Interacciones Medicamentosas Comunes",
                summary: "Guía de las interacciones más relevantes en la práctica clínica diaria.",
                tags: ["Interacciones", "26 páginas", "PDF"],
                category: "Farmacología"
            }
        ];

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            // Initialize local storage
            initLocalStorage();
            
            // Populate medication selects
            populateMeds();
            
            // Set up event listeners
            setupEventListeners();
            
            // Show default procedures
            showProcedures('higiene');
            
            // Check theme preference
            checkTheme();
            
            // Load favorites
            loadFavorites();
            
            // Load patients
            loadPatients();
        });

        function initLocalStorage() {
            // Initialize favorites if not exists
            if (!localStorage.getItem('favorites')) {
                localStorage.setItem('favorites', JSON.stringify([]));
            }
            
            // Initialize patients if not exists
            if (!localStorage.getItem('patients')) {
                localStorage.setItem('patients', JSON.stringify([
                    {
                        id: 1,
                        nombre: "María López Fernández",
                        edad: 68,
                        genero: "femenino",
                        telefono: "+34 612 345 678",
                        email: "maria.lopez@email.com",
                        diagnostico: "Diabetes tipo 2, Hipertensión",
                        visitas: 5,
                        medicamentos: ["Metformina", "Losartán"],
                        ultimaVisita: "2023-10-15",
                        notas: "Paciente estable, controlar glucemia semanalmente.",
                        historial: [
                            {
                                fecha: "2023-10-15",
                                tipo: "Consulta",
                                descripcion: "Control rutinario, ajuste de medicación"
                            },
                            {
                                fecha: "2023-09-20",
                                tipo: "Análisis",
                                descripcion: "Hemograma completo y perfil lipídico"
                            }
                        ]
                    },
                    {
                        id: 2,
                        nombre: "Carlos Ruiz Martínez",
                        edad: 72,
                        genero: "masculino",
                        telefono: "+34 623 456 789",
                        email: "carlos.ruiz@email.com",
                        diagnostico: "Insuficiencia cardíaca, FA",
                        visitas: 3,
                        medicamentos: ["Digoxina", "Furosemida"],
                        ultimaVisita: "2023-10-10",
                        notas: "Mantener dieta baja en sal, control de peso diario.",
                        historial: [
                            {
                                fecha: "2023-10-10",
                                tipo: "Consulta",
                                descripcion: "Evaluación de síntomas, estable"
                            },
                            {
                                fecha: "2023-09-05",
                                tipo: "Ecocardiograma",
                                descripcion: "Función ventricular estable"
                            }
                        ]
                    },
                    {
                        id: 3,
                        nombre: "Ana Sánchez Gómez",
                        edad: 55,
                        genero: "femenino",
                        telefono: "+34 634 567 890",
                        email: "ana.sanchez@email.com",
                        diagnostico: "Artritis reumatoide",
                        visitas: 4,
                        medicamentos: ["Metotrexato", "Ibuprofeno"],
                        ultimaVisita: "2023-10-05",
                        notas: "Mejoría de síntomas con tratamiento, controlar función hepática.",
                        historial: [
                            {
                                fecha: "2023-10-05",
                                tipo: "Consulta",
                                descripcion: "Revisión tratamiento, buena evolución"
                            },
                            {
                                fecha: "2023-09-12",
                                tipo: "Análisis",
                                descripcion: "Control enzimas hepáticas"
                            }
                        ]
                    }
                ]));
            }
        }

        function populateMeds() {
            const medsList = $('medsList');
            
            // Clear existing options first
            medsList.innerHTML = '';
            
            MEDS.forEach(med => {
                const option = document.createElement('option');
                option.value = med;
                medsList.appendChild(option);
            });
        }

        function setupEventListeners() {
            // Category buttons
            document.querySelectorAll('.cat-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.cat-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    showCategory(btn.dataset.cat);
                });
            });

            // Tab buttons
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', () => {
                    const tabName = tab.dataset.tab;
                    
                    // Handle content tabs
                    if (tabName === 'procedimientos' || tabName === 'interacciones' || 
                        tabName === 'enfermedades' || tabName === 'pacientes') {
                        document.querySelectorAll('.tab-content').forEach(content => {
                            content.classList.remove('active');
                        });
                        $(tabName + 'Content').classList.add('active');
                        
                        document.querySelectorAll('.tab').forEach(t => {
                            t.classList.remove('active');
                        });
                        tab.classList.add('active');
                    }
                    
                    // Handle patient detail tabs
                    if (tabName === 'historial' || tabName === 'medicamentos' || tabName === 'notas') {
                        document.querySelectorAll('#patientDetail .tab-content').forEach(content => {
                            content.classList.remove('active');
                        });
                        $(tabName + 'Content').classList.add('active');
                        
                        document.querySelectorAll('#patientDetail .tab').forEach(t => {
                            t.classList.remove('active');
                        });
                        tab.classList.add('active');
                    }
                });
            });

            // Search
            $('searchBtn').addEventListener('click', performSearch);
            $('globalSearch').addEventListener('input', handleSearchInput);
            $('globalSearch').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') performSearch();
            });

            // Medication interaction
            $('checkInteraction').addEventListener('click', checkMedicationInteraction);

            // Disease search
            $('wikiFetchBtn').addEventListener('click', fetchDiseaseInfo);
            $('diseaseSearch').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') fetchDiseaseInfo();
            });

            // Dose calculation
            $('calculateDose').addEventListener('click', calculateDose);

            // Theme toggle
            $('themeBtn').addEventListener('click', toggleTheme);

            // Menu toggle (for mobile)
            $('menuToggle').addEventListener('click', () => {
                document.getElementById('sidebar').classList.toggle('show');
            });

            // Patient actions
            $('addPatient').addEventListener('click', addNewPatient);
            $('closePatientDetail').addEventListener('click', closePatientDetail);
            $('savePatientNotes').addEventListener('click', savePatientNotes);
        }

        function handleSearchInput() {
            const query = $('globalSearch').value.trim().toLowerCase();
            const suggestionsContainer = $('searchSuggestions');
            
            if (query.length < 2) {
                suggestionsContainer.style.display = 'none';
                return;
            }
            
            // Get suggestions from all data sources
            const suggestions = [];
            
            // Procedures
            Object.keys(PROCEDURES).forEach(cat => {
                PROCEDURES[cat].forEach(p => {
                    if (p.title.toLowerCase().includes(query) || p.summary.toLowerCase().includes(query)) {
                        suggestions.push({
                            type: 'Procedimiento',
                            title: p.title,
                            category: p.category,
                            data: p
                        });
                    }
                });
            });
            
            // Diseases
            DISEASES.forEach(d => {
                if (d.name.toLowerCase().includes(query) || d.summary.toLowerCase().includes(query)) {
                    suggestions.push({
                        type: 'Enfermedad',
                        title: d.name,
                        category: d.category,
                        data: d
                    });
                }
            });
            
            // Medications
            MEDS.forEach(m => {
                if (m.toLowerCase().includes(query)) {
                    suggestions.push({
                        type: 'Medicamento',
                        title: m,
                        category: 'Farmacología',
                        data: m
                    });
                }
            });
            
            // Guides
            GUIDES.forEach(g => {
                if (g.title.toLowerCase().includes(query) || g.summary.toLowerCase().includes(query)) {
                    suggestions.push({
                        type: 'Guía',
                        title: g.title,
                        category: g.category,
                        data: g
                    });
                }
            });
            
            // Display suggestions
            if (suggestions.length > 0) {
                suggestionsContainer.innerHTML = suggestions.slice(0, 5).map(s => `
                    <div class="suggestion-item" data-type="${s.type}" data-title="${s.title}">
                        <div class="result-title">${s.title}</div>
                        <div class="result-meta">
                            <span class="pill">${s.type}</span>
                            <span class="pill">${s.category}</span>
                        </div>
                    </div>
                `).join('');
                
                suggestionsContainer.style.display = 'block';
                
                // Add click event to suggestions
                document.querySelectorAll('.suggestion-item').forEach(item => {
                    item.addEventListener('click', () => {
                        $('globalSearch').value = item.dataset.title;
                        suggestionsContainer.style.display = 'none';
                        performSearch();
                    });
                });
            } else {
                suggestionsContainer.style.display = 'none';
            }
        }

        function showCategory(category) {
            // Hide all tab contents first
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // Show appropriate content based on category
            switch(category) {
                case 'higiene':
                case 'curaciones':
                case 'farmaco':
                case 'emergencias':
                case 'movilizacion':
                case 'nutricion':
                case 'infeccion':
                    showProcedures(category);
                    $('#procedimientosContent').classList.add('active');
                    document.querySelector('[data-tab="procedimientos"]').classList.add('active');
                    break;
                    
                case 'medicamentos':
                    showMedicationResources();
                    $('#interaccionesContent').classList.add('active');
                    document.querySelector('[data-tab="interacciones"]').classList.add('active');
                    break;
                    
                case 'enfermedades':
                    showDiseaseResources();
                    $('#enfermedadesContent').classList.add('active');
                    document.querySelector('[data-tab="enfermedades"]').classList.add('active');
                    break;
                    
                case 'guias':
                    showGuides();
                    $('#enfermedadesContent').classList.add('active');
                    document.querySelector('[data-tab="enfermedades"]').classList.add('active');
                    break;
                    
                case 'pacientes':
                    showPatients();
                    $('#pacientesContent').classList.add('active');
                    document.querySelector('[data-tab="pacientes"]').classList.add('active');
                    break;
                    
                case 'pae':
                    showPAE();
                    $('#pacientesContent').classList.add('active');
                    document.querySelector('[data-tab="pacientes"]').classList.add('active');
                    break;
                    
                case 'favoritos':
                    showFavorites();
                    break;
                    
                default:
                    showProcedures('higiene');
                    $('#procedimientosContent').classList.add('active');
                    document.querySelector('[data-tab="procedimientos"]').classList.add('active');
            }
        }

        function showProcedures(category) {
            const proceduresList = $('proceduresList');
            proceduresList.innerHTML = '';
            
            const procedures = PROCEDURES[category] || [];
            
            procedures.forEach(p => {
                const isFavorite = checkIfFavorite(p.id, 'procedure');
                
                const item = document.createElement('div');
                item.className = 'proc-item';
                
                // SVG icons mapping
                const svgMap = {
                    'lavado_manos': '<i class="fas fa-hand-sparkles" style="color: #10b981;"></i>',
                    'baño_cama': '<i class="fas fa-bed" style="color: #3b82f6;"></i>',
                    'higiene_oral': '<i class="fas fa-tooth" style="color: #ef4444;"></i>',
                    'cuidado_piel': '<i class="fas fa-hand-holding-medical" style="color: #8b5cf6;"></i>',
                    'cuidado_ongles': '<i class="fas fa-cut" style="color: #f59e0b;"></i>',
                    'curacion_simple': '<i class="fas fa-band-aid" style="color: #10b981;"></i>',
                    'curacion_escaras': '<i class="fas fa-wound" style="color: #ef4444;"></i>',
                    'curacion_quirurgica': '<i class="fas fa-syringe" style="color: #3b82f6;"></i>',
                    'curacion_absceso': '<i class="fas fa-vial" style="color: #f59e0b;"></i>',
                    'curacion_valvula': '<i class="fas fa-drum" style="color: #8b5cf6;"></i>',
                    'admin_oral': '<i class="fas fa-pills" style="color: #10b981;"></i>',
                    'admin_ev': '<i class="fas fa-inject" style="color: #ef4444;"></i>',
                    'oxigenoterapia': '<i class="fas fa-oxygen" style="color: #3b82f6;"></i>',
                    'vacunas': '<i class="fas fa-syringe" style="color: #f59e0b;"></i>',
                    'dosis_peso': '<i class="fas fa-weight" style="color: #8b5cf6;"></i>',
                    'rcp': '<i class="fas fa-heartbeat" style="color: #ef4444;"></i>',
                    'anafilaxia': '<i class="fas fa-allergies" style="color: #f59e0b;"></i>',
                    'sintomaticos': '<i class="fas fa-user-injured" style="color: #dc2626;"></i>',
                    'transferencia': '<i class="fas fa-walking" style="color: #06b6d4;"></i>',
                    'ayuda_mec': '<i class="fas fa-truck-moving" style="color: #8b5cf6;"></i>',
                    'nutricion_basica': '<i class="fas fa-apple-alt" style="color: #10b981;"></i>',
                    'control_infeccion': '<i class="fas fa-virus" style="color: #ef4444;"></i>',
                    'control_infeccion_cateter': '<i class="fas fa-syringe" style="color: #3b82f6;"></i>'
                };
                
                const icon = svgMap[p.id] || '<i class="fas fa-notes-medical" style="color: #6b7280;"></i>';
                
                item.innerHTML = `
                    <div class="proc-head">
                        <div>
                            <div class="proc-title">${p.title}</div>
                            <div class="small">${p.summary}</div>
                            <div class="result-meta">
                                <span class="pill">${p.time}</span>
                                <span class="pill">Dificultad: ${p.difficulty}</span>
                            </div>
                        </div>
                        <div>${icon}</div>
                    </div>
                    <div class="proc-expand">
                        <strong>Pasos:</strong>
                        <ol>${p.steps.map(s => `<li>${s}</li>`).join('')}</ol>
                        ${p.notes ? `<div class="small" style="margin-top: 8px; color: #6b7280;"><strong>Notas:</strong> ${p.notes}</div>` : ''}
                    </div>
                    <button class="favorite-btn ${isFavorite ? 'active' : ''}" data-id="${p.id}" data-type="procedure">
                        <i class="fas fa-star"></i>
                    </button>
                `;
                
                item.querySelector('.proc-head').addEventListener('click', () => {
                    item.classList.toggle('proc-open');
                    const expand = item.querySelector('.proc-expand');
                    expand.classList.toggle('active');
                });
                
                // Add favorite functionality
                const favoriteBtn = item.querySelector('.favorite-btn');
                favoriteBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    toggleFavorite(p.id, 'procedure', p.title, favoriteBtn);
                });
                
                proceduresList.appendChild(item);
            });
        }

        function showMedicationResources() {
            // This is already handled by the tab system
        }

        function showDiseaseResources() {
            // This is already handled by the tab system
        }

        function showGuides() {
            const guidesList = $('guidesList');
            guidesList.innerHTML = '';
            
            GUIDES.forEach(guide => {
                const isFavorite = checkIfFavorite(guide.title, 'guide');
                
                const guideCard = document.createElement('div');
                guideCard.className = 'medication-card';
                guideCard.innerHTML = `
                    <h4>${guide.title}</h4>
                    <p>${guide.summary}</p>
                    <div class="medication-meta">
                        ${guide.tags.map(tag => `<span>${tag}</span>`).join('')}
                        <span>${guide.category}</span>
                    </div>
                    <div style="display: flex; gap: 8px; margin-top: 12px;">
                        <button class="check-btn">Descargar guía</button>
                        <button class="favorite-btn ${isFavorite ? 'active' : ''}" data-id="${guide.title}" data-type="guide" style="position: static;">
                            <i class="fas fa-star"></i>
                        </button>
                    </div>
                `;
                
                // Add favorite functionality
                const favoriteBtn = guideCard.querySelector('.favorite-btn');
                favoriteBtn.addEventListener('click', () => {
                    toggleFavorite(guide.title, 'guide', guide.title, favoriteBtn);
                });
                
                guidesList.appendChild(guideCard);
            });
        }

        function loadPatients() {
            const patients = JSON.parse(localStorage.getItem('patients') || '[]');
            const patientList = $('patientList');
            patientList.innerHTML = '';
            
            patients.forEach(patient => {
                const patientCard = document.createElement('div');
                patientCard.className = 'patient-card';
                patientCard.innerHTML = `
                    <div class="patient-info">
                        <div class="patient-name">${patient.nombre}</div>
                        <div class="patient-details">
                            <span>${patient.edad} años</span>
                            <span>${patient.diagnostico}</span>
                        </div>
                    </div>
                    <div class="patient-actions">
                        <button class="btn-action view-patient" data-id="${patient.id}">Ver</button>
                        <button class="btn-action">Editar</button>
                    </div>
                `;
                
                // Add view patient functionality
                const viewBtn = patientCard.querySelector('.view-patient');
                viewBtn.addEventListener('click', () => {
                    showPatientDetail(patient.id);
                });
                
                patientList.appendChild(patientCard);
            });
        }

        function showPatientDetail(patientId) {
            const patients = JSON.parse(localStorage.getItem('patients') || '[]');
            const patient = patients.find(p => p.id == patientId);
            
            if (!patient) return;
            
            // Hide patient list and show detail
            $('patientList').style.display = 'none';
            $('patientDetail').style.display = 'block';
            
            // Populate patient data
            $('detailPatientName').textContent = patient.nombre;
            $('detailPatientAge').textContent = `${patient.edad} años`;
            $('detailPatientGender').textContent = patient.genero;
            $('detailPatientPhone').textContent = patient.telefono;
            $('detailPatientEmail').textContent = patient.email;
            $('detailPatientDiagnosis').textContent = patient.diagnostico;
            
            // Populate stats
            $('statVisits').textContent = patient.visitas || 0;
            $('statMeds').textContent = patient.medicamentos ? patient.medicamentos.length : 0;
            $('statLastVisit').textContent = patient.ultimaVisita || '-';
            
            // Populate timeline
            const timeline = $('patientTimeline');
            timeline.innerHTML = '';
            
            if (patient.historial && patient.historial.length > 0) {
                patient.historial.forEach(event => {
                    const timelineItem = document.createElement('div');
                    timelineItem.className = 'timeline-item';
                    timelineItem.innerHTML = `
                        <div class="timeline-date">${event.fecha}</div>
                        <div class="timeline-content">
                            <strong>${event.tipo}</strong>: ${event.descripcion}
                        </div>
                    `;
                    timeline.appendChild(timelineItem);
                });
            } else {
                timeline.innerHTML = '<div class="small">No hay historial registrado</div>';
            }
            
            // Populate medications
            const medsList = $('patientMedsList');
            medsList.innerHTML = '';
            
            if (patient.medicamentos && patient.medicamentos.length > 0) {
                patient.medicamentos.forEach(med => {
                    const medCard = document.createElement('div');
                    medCard.className = 'medication-card';
                    medCard.innerHTML = `
                        <h4>${med}</h4>
                        <div class="medication-meta">
                            <span>Medicamento</span>
                            <span>Activo</span>
                        </div>
                    `;
                    medsList.appendChild(medCard);
                });
            } else {
                medsList.innerHTML = '<div class="small">No hay medicamentos registrados</div>';
            }
            
            // Populate notes
            $('patientNotes').value = patient.notas || '';
        }

        function closePatientDetail() {
            $('patientDetail').style.display = 'none';
            $('patientList').style.display = 'grid';
        }

        function savePatientNotes() {
            // This would save notes to the patient in a real application
            showToast('Notas guardadas', 'success');
        }

        function addNewPatient() {
            // This would open a form to add a new patient in a real application
            showToast('Funcionalidad de añadir paciente en desarrollo', 'info');
        }

        function calculateDose() {
            const weight = parseFloat($('doseWeight').value);
            const medication = $('doseMedication').value;
            const dosePerKg = parseFloat($('doseDose').value);
            const frequency = parseInt($('doseFrequency').value);
            
            if (!weight || !medication || !dosePerKg) {
                showToast('Complete todos los campos', 'error');
                return;
            }
            
            const totalDose = weight * dosePerKg;
            const doseResult = $('doseResult');
            
            let frequencyText = '';
            switch(frequency) {
                case 1: frequencyText = 'una vez al día'; break;
                case 2: frequencyText = 'cada 12 horas'; break;
                case 3: frequencyText = 'cada 8 horas'; break;
                case 4: frequencyText = 'cada 6 horas'; break;
            }
            
            doseResult.innerHTML = `
                <div class="success">
                    <i class="fas fa-calculator"></i>
                    <strong>Dosis calculada:</strong><br>
                    ${totalDose.toFixed(2)} mg de ${medication} ${frequencyText}<br>
                    <small>Basado en ${weight} kg × ${dosePerKg} mg/kg</small>
                </div>
            `;
        }

        function performSearch() {
            const query = $('globalSearch').value.trim().toLowerCase();
            if (!query) {
                $('searchResults').innerHTML = '';
                return;
            }
            
            const resultsContainer = $('searchResults');
            resultsContainer.innerHTML = '';
            
            // Create result card
            const card = document.createElement('div');
            card.className = 'result-card';
            
            let hasResults = false;
            
            // Procedures search
            let pHits = [];
            Object.keys(PROCEDURES).forEach(cat => {
                pHits = pHits.concat(PROCEDURES[cat].filter(p => 
                    p.title.toLowerCase().includes(query) || 
                    p.summary.toLowerCase().includes(query)
                ));
            });
            
            if (pHits.length) {
                hasResults = true;
                card.innerHTML += `<h4 style="margin-bottom: 8px">Procedimientos Clínicos</h4>` + 
                    pHits.map(p => `
                        <div class="result-item">
                            <div class="result-title">${p.title}</div>
                            <div class="result-summary">${p.summary}</div>
                            <div class="result-meta">
                                <span class="pill">${p.category}</span>
                                <span>${p.steps.length} pasos</span>
                                <span class="pill">${p.time}</span>
                            </div>
                        </div>
                    `).join('');
            }
            
            // Diseases search
            const dHits = DISEASES.filter(d => 
                d.name.toLowerCase().includes(query) || 
                d.summary.toLowerCase().includes(query)
            );
            
            if (dHits.length) {
                hasResults = true;
                card.innerHTML += `<h4 style="margin: 12px 0 8px 0">Enfermedades</h4>` + 
                    dHits.map(d => `
                        <div class="result-item">
                            <div class="result-title">${d.name}</div>
                            <div class="result-summary">${d.summary}</div>
                            <div class="result-meta">
                                <span class="pill">${d.category}</span>
                            </div>
                        </div>
                    `).join('');
            }
            
            // Medications search
            const mHits = MEDS.filter(m => m.toLowerCase().includes(query));
            
            if (mHits.length) {
                hasResults = true;
                card.innerHTML += `<h4 style="margin: 12px 0 8px 0">Medicamentos</h4>
                    <div class="result-summary">${mHits.join(', ')}</div>`;
            }
            
            // Guides search
            const gHits = GUIDES.filter(g => 
                g.title.toLowerCase().includes(query) || 
                g.summary.toLowerCase().includes(query)
            );
            
            if (gHits.length) {
                hasResults = true;
                card.innerHTML += `<h4 style="margin: 12px 0 8px 0">Guías Clínicas</h4>` + 
                    gHits.map(g => `
                        <div class="result-item">
                            <div class="result-title">${g.title}</div>
                            <div class="result-summary">${g.summary}</div>
                            <div class="result-meta">
                                ${g.tags.map(tag => `<span class="pill">${tag}</span>`).join('')}
                                <span class="pill">${g.category}</span>
                            </div>
                        </div>
                    `).join('');
            }
            
            // Patients search
            const patients = JSON.parse(localStorage.getItem('patients') || '[]');
            const pHitsPatients = patients.filter(p => 
                p.nombre.toLowerCase().includes(query) || 
                p.diagnostico.toLowerCase().includes(query)
            );
            
            if (pHitsPatients.length) {
                hasResults = true;
                card.innerHTML += `<h4 style="margin: 12px 0 8px 0">Pacientes</h4>` + 
                    pHitsPatients.map(p => `
                        <div class="result-item">
                            <div class="result-title">${p.nombre}</div>
                            <div class="result-summary">${p.edad} años, ${p.diagnostico}</div>
                            <div class="result-meta">
                                <span class="pill">${p.genero}</span>
                                <span>${p.telefono}</span>
                            </div>
                        </div>
                    `).join('');
            }
            
            if (hasResults) {
                resultsContainer.appendChild(card);
            } else {
                resultsContainer.innerHTML = '<div class="result-card"><div class="result-summary">No se encontraron resultados para "' + query + '"</div></div>';
            }
            
            // Hide suggestions
            $('searchSuggestions').style.display = 'none';
        }

        function checkMedicationInteraction() {
            const a = $('medSelectA').value;
            const b = $('medSelectB').value;
            const out = $('interactionResult');
            
            out.innerHTML = '';
            
            if (!a || !b) {
                showToast('Seleccione dos fármacos', 'error');
                return;
            }
            
            if (a === b) {
                out.innerHTML = '<div class="success"><i class="fas fa-info-circle"></i> Mismo medicamento seleccionado — cuidado con duplicidad terapéutica.</div>';
                return;
            }
            
            const hits = NEVER_COMBINE.filter(n => 
                (a.toLowerCase().includes(n.a) && b.toLowerCase().includes(n.b)) || 
                (a.toLowerCase().includes(n.b) && b.toLowerCase().includes(n.a))
            );
            
            if (hits.length) {
                out.innerHTML = hits.map(h => `
                    <div class="warning">
                        <i class="fas fa-exclamation-triangle"></i>
                        <strong>Alerta ${h.severity}:</strong> ${h.reason} 
                        <a href="${h.ref}" target="_blank" class="wiki-link">[ref]</a>
                    </div>
                `).join('');
                return;
            }
            
            // Heuristics for potential warnings
            const warnings = [];
            
            if ((a.toLowerCase().includes('warfarina') || b.toLowerCase().includes('warfarina')) && 
                (a.toLowerCase().includes('aspirina') || b.toLowerCase().includes('aspirina'))) {
                warnings.push('Interacción potencial: riesgo aumentado de sangrado');
            }
            
            if (warnings.length) {
                out.innerHTML = warnings.map(w => `
                    <div class="warning">
                        <i class="fas fa-exclamation-triangle"></i>
                        ${w}
                    </div>
                `).join('');
            } else {
                out.innerHTML = '<div class="success"><i class="fas fa-check-circle"></i> No se encontraron interacciones críticas conocidas</div>';
            }
        }

        async function fetchDiseaseInfo() {
            const query = $('diseaseSearch').value.trim();
            if (!query) {
                showToast('Escriba un término de búsqueda', 'error');
                return;
            }
            
            $('wikiOutput').textContent = 'Buscando en Wikipedia...';
            
            try {
                const url = `https://es.wikipedia.org/api/rest_v1/page/summary/${encodeURIComponent(query)}`;
                const response = await fetch(url);
                
                if (!response.ok) {
                    $('wikiOutput').innerHTML = '<div class="warning"><i class="fas fa-exclamation-triangle"></i> No encontrado en Wikipedia</div>';
                    return;
                }
                
                const data = await response.json();
                $('wikiOutput').innerHTML = `
                    <strong>${data.title}</strong>
                    <div class="small">${data.extract}</div>
                    <div style="margin-top:8px">
                        <a href="${data.content_urls?.desktop?.page || '#'}" target="_blank" class="wiki-link">
                            <i class="fas fa-external-link-alt"></i>
                            Leer en Wikipedia
                        </a>
                    </div>
                `;
            } catch (error) {
                $('wikiOutput').innerHTML = '<div class="warning"><i class="fas fa-exclamation-triangle"></i> Error al buscar en Wikipedia</div>';
            }
        }

        function toggleTheme() {
            const body = document.body;
            const themeBtn = $('themeBtn');
            const icon = themeBtn.querySelector('i');
            
            if (body.hasAttribute('data-theme') && body.getAttribute('data-theme') === 'dark') {
                body.removeAttribute('data-theme');
                localStorage.setItem('theme', 'light');
                icon.className = 'fas fa-moon';
            } else {
                body.setAttribute('data-theme', 'dark');
                localStorage.setItem('theme', 'dark');
                icon.className = 'fas fa-sun';
            }
        }

        function checkTheme() {
            const savedTheme = localStorage.getItem('theme');
            const body = document.body;
            const themeBtn = $('themeBtn');
            const icon = themeBtn.querySelector('i');
            
            if (savedTheme === 'dark' || 
                (!savedTheme && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
                body.setAttribute('data-theme', 'dark');
                icon.className = 'fas fa-sun';
            } else {
                body.removeAttribute('data-theme');
                icon.className = 'fas fa-moon';
            }
        }

        function toggleAccessibilityPanel() {
            const panel = $('accessibilityPanel');
            panel.classList.toggle('open');
        }

        function applyAccessibility() {
            const highContrast = $('highContrast').checked;
            const dyslexiaFont = $('dyslexiaFont').checked;
            const reducedMotion = $('reducedMotion').checked;
            const keyboardNav = $('keyboardNavigation').checked;
            const textToSpeech = $('textToSpeech').checked;
            
            // Save settings
            localStorage.setItem('accessibility', JSON.stringify({
                highContrast,
                dyslexiaFont,
                reducedMotion,
                keyboardNav,
                textToSpeech
            }));
            
            showToast('Configuración de accesibilidad aplicada', 'success');
            toggleAccessibilityPanel();
        }

        function resetAccessibility() {
            $('highContrast').checked = false;
            $('dyslexiaFont').checked = false;
            $('reducedMotion').checked = false;
            $('keyboardNavigation').checked = false;
            $('textToSpeech').checked = false;
            
            localStorage.removeItem('accessibility');
            showToast('Configuración de accesibilidad restablecida', 'success');
        }

        function checkIfFavorite(id, type) {
            const favorites = JSON.parse(localStorage.getItem('favorites') || '[]');
            return favorites.some(f => f.id === id && f.type === type);
        }

        function toggleFavorite(id, type, title, button) {
            const favorites = JSON.parse(localStorage.getItem('favorites') || '[]');
            const index = favorites.findIndex(f => f.id === id && f.type === type);
            
            if (index === -1) {
                // Add to favorites
                favorites.push({ id, type, title });
                button.classList.add('active');
                showToast('Añadido a favoritos', 'success');
            } else {
                // Remove from favorites
                favorites.splice(index, 1);
                button.classList.remove('active');
                showToast('Eliminado de favoritos', 'success');
            }
            
            localStorage.setItem('favorites', JSON.stringify(favorites));
        }

        function loadFavorites() {
            // This would load and display favorites
        }

        function showFavorites() {
            const favorites = JSON.parse(localStorage.getItem('favorites') || '[]');
            
            // Hide all tab contents first
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // Show procedures tab as default for favorites
            $('#procedimientosContent').classList.add('active');
            document.querySelector('[data-tab="procedimientos"]').classList.add('active');
            
            // Clear procedures list
            const proceduresList = $('proceduresList');
            proceduresList.innerHTML = '';
            
            if (favorites.length === 0) {
                proceduresList.innerHTML = '<div class="result-card"><div class="result-summary">No tiene favoritos guardados</div></div>';
                return;
            }
            
            // Show favorite procedures
            favorites.forEach(fav => {
                if (fav.type === 'procedure') {
                    // Find the procedure in our data
                    let procedure = null;
                    Object.keys(PROCEDURES).forEach(cat => {
                        const found = PROCEDURES[cat].find(p => p.id === fav.id);
                        if (found) procedure = found;
                    });
                    
                    if (procedure) {
                        const item = document.createElement('div');
                        item.className = 'proc-item';
                        
                        // SVG icons mapping (same as in showProcedures)
                        const svgMap = {
                            'lavado_manos': '<i class="fas fa-hand-sparkles" style="color: #10b981;"></i>',
                            'baño_cama': '<i class="fas fa-bed" style="color: #3b82f6;"></i>',
                            'higiene_oral': '<i class="fas fa-tooth" style="color: #ef4444;"></i>',
                            'cuidado_piel': '<i class="fas fa-hand-holding-medical" style="color: #8b5cf6;"></i>',
                            'cuidado_ongles': '<i class="fas fa-cut" style="color: #f59e0b;"></i>',
                            'curacion_simple': '<i class="fas fa-band-aid" style="color: #10b981;"></i>',
                            'curacion_escaras': '<i class="fas fa-wound" style="color: #ef4444;"></i>',
                            'curacion_quirurgica': '<i class="fas fa-syringe" style="color: #3b82f6;"></i>',
                            'curacion_absceso': '<i class="fas fa-vial" style="color: #f59e0b;"></i>',
                            'curacion_valvula': '<i class="fas fa-drum" style="color: #8b5cf6;"></i>',
                            'admin_oral': '<i class="fas fa-pills" style="color: #10b981;"></i>',
                            'admin_ev': '<i class="fas fa-inject" style="color: #ef4444;"></i>',
                            'oxigenoterapia': '<i class="fas fa-oxygen" style="color: #3b82f6;"></i>',
                            'vacunas': '<i class="fas fa-syringe" style="color: #f59e0b;"></i>',
                            'dosis_peso': '<i class="fas fa-weight" style="color: #8b5cf6;"></i>',
                            'rcp': '<i class="fas fa-heartbeat" style="color: #ef4444;"></i>',
                            'anafilaxia': '<i class="fas fa-allergies" style="color: #f59e0b;"></i>',
                            'sintomaticos': '<i class="fas fa-user-injured" style="color: #dc2626;"></i>',
                            'transferencia': '<i class="fas fa-walking" style="color: #06b6d4;"></i>',
                            'ayuda_mec': '<i class="fas fa-truck-moving" style="color: #8b5cf6;"></i>',
                            'nutricion_basica': '<i class="fas fa-apple-alt" style="color: #10b981;"></i>',
                            'control_infeccion': '<i class="fas fa-virus" style="color: #ef4444;"></i>',
                            'control_infeccion_cateter': '<i class="fas fa-syringe" style="color: #3b82f6;"></i>'
                        };
                        
                        const icon = svgMap[procedure.id] || '<i class="fas fa-notes-medical" style="color: #6b7280;"></i>';
                        
                        item.innerHTML = `
                            <div class="proc-head">
                                <div>
                                    <div class="proc-title">${procedure.title}</div>
                                    <div class="small">${procedure.summary}</div>
                                    <div class="result-meta">
                                        <span class="pill">${procedure.time}</span>
                                        <span class="pill">Dificultad: ${procedure.difficulty}</span>
                                    </div>
                                </div>
                                <div>${icon}</div>
                            </div>
                            <div class="proc-expand">
                                <strong>Pasos:</strong>
                                <ol>${procedure.steps.map(s => `<li>${s}</li>`).join('')}</ol>
                                ${procedure.notes ? `<div class="small" style="margin-top: 8px; color: #6b7280;"><strong>Notas:</strong> ${procedure.notes}</div>` : ''}
                            </div>
                            <button class="favorite-btn active" data-id="${procedure.id}" data-type="procedure">
                                <i class="fas fa-star"></i>
                            </button>
                        `;
                        
                        item.querySelector('.proc-head').addEventListener('click', () => {
                            item.classList.toggle('proc-open');
                            const expand = item.querySelector('.proc-expand');
                            expand.classList.toggle('active');
                        });
                        
                        // Add favorite functionality
                        const favoriteBtn = item.querySelector('.favorite-btn');
                        favoriteBtn.addEventListener('click', (e) => {
                            e.stopPropagation();
                            toggleFavorite(procedure.id, 'procedure', procedure.title, favoriteBtn);
                            // Remove the item from the list after unfavoriting
                            item.remove();
                            // If no favorites left, show message
                            if ($('proceduresList').children.length === 0) {
                                $('proceduresList').innerHTML = '<div class="result-card"><div class="result-summary">No tiene favoritos guardados</div></div>';
                            }
                        });
                        
                        proceduresList.appendChild(item);
                    }
                }
            });
        }

        function showToast(message, type = 'info') {
            const toastContainer = $('toastContainer');
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            
            let icon = 'info-circle';
            if (type === 'success') icon = 'check-circle';
            if (type === 'error') icon = 'exclamation-circle';
            if (type === 'warning') icon = 'exclamation-triangle';
            
            toast.innerHTML = `
                <div class="toast-icon">
                    <i class="fas fa-${icon}"></i>
                </div>
                <div class="toast-content">
                    <div class="toast-message">${message}</div>
                </div>
                <button class="toast-close">
                    <i class="fas fa-times"></i>
                </button>
            `;
            
            toastContainer.appendChild(toast);
            
            // Add close functionality
            const closeBtn = toast.querySelector('.toast-close');
            closeBtn.addEventListener('click', () => {
                toast.remove();
            });
            
            // Auto remove after 5 seconds
            setTimeout(() => {
                if (toast.parentNode) {
                    toast.remove();
                }
            }, 5000);
        }

        // Service Worker Registration for PWA
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then((registration) => {
                        console.log('SW registered: ', registration);
                    })
                    .catch((registrationError) => {
                        console.log('SW registration failed: ', registrationError);
                    });
            });
        }
    </script>
</body>
</html>
