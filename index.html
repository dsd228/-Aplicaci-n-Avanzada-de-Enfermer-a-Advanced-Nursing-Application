<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>SaludPro · Sistema Integral de Gestión Clínica</title>
  <link href="https://fonts.googleapis.com/css2?family=Google+Sans:wght@400;500;700&family=Google+Sans+Text:wght@400;500&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" rel="stylesheet"/>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    :root {
      /* Google Design System Colors */
      --grey-0: #fff;
      --grey-50: #f8f9fa;
      --grey-100: #f1f3f4;
      --grey-200: #e8eaed;
      --grey-300: #dadce0;
      --grey-400: #bdc1c6;
      --grey-500: #9aa0a6;
      --grey-600: #80868b;
      --grey-700: #5f6368;
      --grey-800: #3c4043;
      --grey-900: #202124;
      --grey-1000: #060606;
      
      --blue-50: #e8f0fe;
      --blue-100: #d2e3fc;
      --blue-200: #aecbfa;
      --blue-300: #8ab4f8;
      --blue-400: #669df6;
      --blue-500: #4285f4;
      --blue-600: #1a73e8;
      --blue-700: #1967d2;
      --blue-800: #185abc;
      --blue-900: #174ea6;
      
      --red-50: #fce8e6;
      --red-100: #fad2cf;
      --red-200: #f6aea9;
      --red-300: #f28b82;
      --red-400: #ee675c;
      --red-500: #ea4335;
      --red-600: #d93025;
      --red-700: #c5221f;
      --red-800: #b31412;
      --red-900: #a50e0e;
      
      --yellow-50: #fef7e0;
      --yellow-100: #feefc3;
      --yellow-200: #fde293;
      --yellow-300: #fdd663;
      --yellow-400: #fcc934;
      --yellow-500: #fbbc04;
      --yellow-600: #f9ab00;
      --yellow-700: #f29900;
      --yellow-800: #ea8600;
      --yellow-900: #e37400;
      
      --green-50: #e6f4ea;
      --green-100: #ceead6;
      --green-200: #a8dab5;
      --green-300: #81c995;
      --green-400: #58b776;
      --green-500: #34a853;
      --green-600: #2d8943;
      --green-700: #266d35;
      --green-800: #1f5128;
      --green-900: #18351b;
      
      /* Tema clínico profesional */
      --clinico-primary: #1a73e8;
      --clinico-primary-light: #e8f0fe;
      --clinico-secondary: #34a853;
      --clinico-warning: #f9ab00;
      --clinico-danger: #ea4335;
      --clinico-info: #4285f4;
      --clinico-bg: #f8f9fa;
      --clinico-surface: #ffffff;
      --clinico-text: #202124;
      --clinico-text-secondary: #5f6368;
      --clinico-border: #dadce0;
      
      /* Theme-specific variables */
      --background: var(--clinico-bg);
      --surface: var(--clinico-surface);
      --surface-container: var(--grey-50);
      --surface-container-bright: var(--grey-50);
      --surface-media: var(--grey-100);
      --on-surface: var(--clinico-text);
      --on-surface-variant: var(--clinico-text-secondary);
      --outline: var(--clinico-border);
      --outline-variant: var(--grey-400);
      
      /* Roles */
      --roles-primary-primary: var(--clinico-primary);
      --roles-primary-container: var(--blue-50);
      --roles-primary-container-gradient: linear-gradient(90deg, #d7e6ff 6.02%, #c7e4ff 51.92%, #dce2ff 96.44%);
      --roles-primary-gradient: linear-gradient(90deg, #3b6bff, #2e96ff 65%, #acb7ff);
      --roles-primary-on-primary: #fff;
      --roles-primary-on-primary-container: var(--blue-900);
      
      /* States */
      --states-links-hovered: rgba(26, 115, 232, 0.04);
      --states-links-focused: rgba(26, 115, 232, 0.06);
      --states-outline-hovered: var(--clinico-primary);
      --states-outline-hovered-overlay: rgba(23, 78, 166, 0.04);
      --states-outline-focused: var(--clinico-primary);
      --states-outline-focused-overlay: rgba(23, 78, 166, 0.12);
      --states-primary-hovered: #185abc;
      --states-tonal-hovered: rgba(26, 115, 232, 0.04);
      --states-tonal-focussed: rgba(26, 115, 232, 0.12);
      
      /* Typography */
      --font: 'Google Sans', Arial, Helvetica, sans-serif;
      --font-text: 'Google Sans Text', Arial, Helvetica, sans-serif;
      
      /* Spacing */
      --spacer-xs: 4px;
      --spacer-sm: 8px;
      --spacer-md: 16px;
      --spacer-lg: 24px;
      --spacer-xl: 36px;
      --spacer-2xl: 48px;
      --spacer-3xl: 60px;
      --spacer-4xl: 80px;
      
      /* Shapes */
      --shapes-corner-sm: 8px;
      --shapes-corner-md: 12px;
      --shapes-corner-lg: 16px;
      --shapes-corner-xl: 24px;
      --shapes-corner-xxl: 32px;
      --shapes-corner-xxxl: 84px;
      
      /* Elevation */
      --elevation-1: 0 1px 2px 0 rgba(60, 64, 67, 0.3), 0 1px 3px 1px rgba(60, 64, 67, 0.15);
      --elevation-2: 0 1px 5px 0 rgba(60, 64, 67, 0.2), 0 2px 2px 0 rgba(60, 64, 67, 0.12), 0 1px 3px 0 rgba(60, 64, 67, 0.14);
      --elevation-3: 0 1px 8px 0 rgba(60, 64, 67, 0.2), 0 3px 4px 0 rgba(60, 64, 67, 0.12), 0 2px 4px 0 rgba(60, 64, 67, 0.14);
      --elevation-4: 0 2px 12px 0 rgba(60, 64, 67, 0.2), 0 3px 8px 0 rgba(60, 64, 67, 0.12), 0 5px 6px 0 rgba(60, 64, 67, 0.14);
      --elevation-6: 0 3px 14px 0 rgba(60, 64, 67, 0.2), 0 8px 10px 1px rgba(60, 64, 67, 0.12), 0 5px 6px 0 rgba(60, 64, 67, 0.14);
      
      /* Transitions */
      --transition: 0.2s cubic-bezier(0.4, 0, 0.2, 1);
      --hover-scale: 1.02;
    }
    
    body {
      background: var(--background);
      color: var(--on-surface);
      font-family: var(--font-text);
      font-size: 1rem;
      font-weight: 400;
      line-height: 1.5;
      margin: 0;
      min-height: 100vh;
      letter-spacing: 0.1px;
    }
    
    .app {
      max-width: 1440px;
      margin: 0 auto;
      padding: var(--spacer-md);
    }
    
    header {
      background: var(--surface);
      box-shadow: var(--elevation-2);
      border-radius: var(--shapes-corner-xxl);
      margin: var(--spacer-2xl) 0 var(--spacer-xl) 0;
      padding: var(--spacer-xl) var(--spacer-2xl);
      display: flex;
      align-items: center;
      justify-content: space-between;
      position: relative;
      overflow: hidden;
      transition: var(--transition);
    }
    
    header::before {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: radial-gradient(circle, rgba(26, 115, 232, 0.05) 0%, transparent 70%);
      transform: rotate(30deg);
      pointer-events: none;
    }
    
    header:hover {
      box-shadow: var(--elevation-3);
      transform: translateY(-1px);
    }
    
    .logo {
      font-family: var(--font);
      font-weight: 700;
      font-size: 2.6rem;
      color: var(--roles-primary-on-primary);
      background: var(--roles-primary-primary);
      border-radius: var(--shapes-corner-xl);
      padding: var(--spacer-lg) var(--spacer-2xl);
      box-shadow: var(--elevation-2);
      display: flex;
      align-items: center;
      gap: var(--spacer-md);
      position: relative;
      z-index: 2;
      transition: var(--transition);
    }
    
    .logo:hover {
      transform: scale(var(--hover-scale));
      box-shadow: 0 4px 16px rgba(26, 115, 232, 0.3);
    }
    
    .subtitle {
      color: var(--on-surface-variant);
      font-weight: 400;
      font-size: 1.2rem;
      text-align: right;
      font-family: var(--font-text);
    }
    
    .user-profile {
      display: flex;
      align-items: center;
      gap: var(--spacer-sm);
      background: var(--surface-container);
      padding: var(--spacer-sm) var(--spacer-md);
      border-radius: var(--shapes-corner-lg);
      border: 1px solid var(--outline);
      cursor: pointer;
      transition: var(--transition);
    }
    
    .user-profile:hover {
      background: var(--blue-50);
      transform: translateY(-1px);
    }
    
    .avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: var(--clinico-primary);
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      font-size: 1.1rem;
    }
    
    nav {
      display: flex;
      gap: var(--spacer-md);
      margin: 0 0 var(--spacer-xl) 0;
      align-items: center;
      justify-content: center;
      flex-wrap: wrap;
      background: var(--surface);
      padding: var(--spacer-lg);
      border-radius: var(--shapes-corner-xl);
      box-shadow: var(--elevation-1);
    }
    
    nav button {
      font-family: var(--font);
      font-weight: 500;
      padding: var(--spacer-md) var(--spacer-lg);
      border-radius: var(--shapes-corner-lg);
      border: none;
      background: var(--surface-container);
      color: var(--roles-primary-primary);
      cursor: pointer;
      box-shadow: none;
      display: flex;
      align-items: center;
      gap: var(--spacer-xs);
      font-size: 1.05rem;
      transition: var(--transition);
      border: 1px solid var(--outline);
      min-width: 140px;
      justify-content: center;
    }
    
    nav button:hover {
      background: var(--blue-50);
      color: var(--blue-800);
      transform: scale(var(--hover-scale));
      box-shadow: 0 2px 8px rgba(26, 115, 232, 0.15);
      border-color: var(--blue-300);
    }
    
    nav button:active {
      transform: scale(0.98);
    }
    
    .material-symbols-outlined {
      font-size: 1.4rem;
      vertical-align: middle;
    }
    
    .glass-home {
      background: var(--surface);
      box-shadow: var(--elevation-2);
      border-radius: var(--shapes-corner-xl);
      padding: var(--spacer-2xl);
      margin-bottom: var(--spacer-2xl);
      transition: var(--transition);
    }
    
    .glass-home:hover {
      box-shadow: var(--elevation-3);
      transform: translateY(-2px);
    }
    
    .home-gallery {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: var(--spacer-lg);
      margin-top: var(--spacer-xl);
    }
    
    .img-block {
      background: var(--surface-container);
      border-radius: var(--shapes-corner-lg);
      box-shadow: var(--elevation-1);
      padding: var(--spacer-lg);
      display: flex;
      flex-direction: column;
      align-items: center;
      transition: var(--transition);
      border: 1px solid var(--outline);
      position: relative;
      overflow: hidden;
      cursor: pointer;
    }
    
    .img-block:hover {
      transform: translateY(-4px);
      box-shadow: var(--elevation-2);
      border-color: var(--blue-300);
    }
    
    .img-block::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: var(--roles-primary-primary);
      opacity: 0;
      transition: var(--transition);
    }
    
    .img-block:hover::before {
      opacity: 1;
    }
    
    .img-block img {
      max-width: 100%;
      border-radius: var(--shapes-corner-md);
      box-shadow: 0 1px 6px rgba(0,0,0,0.1);
      transition: var(--transition);
      border: 1px solid var(--outline);
    }
    
    .img-block:hover img {
      transform: scale(1.05);
      box-shadow: 0 4px 16px rgba(0,0,0,0.15);
    }
    
    .img-caption {
      margin-top: var(--spacer-md);
      font-size: 1.05rem;
      color: var(--on-surface-variant);
      text-align: center;
      font-weight: 500;
    }
    
    .level-badge {
      position: absolute;
      top: var(--spacer-md);
      right: var(--spacer-md);
      width: 26px;
      height: 26px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.75rem;
      font-weight: bold;
      color: white;
    }
    
    .fatal .level-badge { background: var(--red-600); }
    .moderate .level-badge { background: var(--yellow-700); }
    .leve .level-badge { background: var(--green-600); }
    
    .modal-backdrop {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: rgba(0, 0, 0, 0.3);
      z-index: 100;
      backdrop-filter: blur(4px);
      transition: opacity 0.3s;
    }
    
    .modal-backdrop.active {
      display: block;
      opacity: 1;
    }
    
    .panel {
      display: none;
      flex-direction: column;
      background: var(--surface);
      box-shadow: var(--elevation-4);
      border-radius: var(--shapes-corner-xl);
      padding: var(--spacer-2xl);
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%) scale(0.95);
      z-index: 101;
      min-width: 420px;
      max-width: 95vw;
      max-height: 90vh;
      overflow-y: auto;
      border: 1px solid var(--outline);
      transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
    }
    
    .panel.active {
      display: flex;
      transform: translate(-50%, -50%) scale(1);
    }
    
    .panel h2 {
      display: flex;
      align-items: center;
      gap: var(--spacer-md);
      margin: 0 0 var(--spacer-xl) 0;
      color: var(--roles-primary-primary);
      font-family: var(--font);
      font-weight: 700;
      font-size: 1.8rem;
    }
    
    .panel h3 {
      margin: var(--spacer-xl) 0 var(--spacer-lg) 0;
      color: var(--roles-primary-primary);
      font-family: var(--font);
      font-weight: 600;
      font-size: 1.4rem;
    }
    
    .panel h4 {
      margin: var(--spacer-lg) 0 var(--spacer-md) 0;
      color: var(--roles-primary-primary);
      font-family: var(--font);
      font-weight: 500;
      font-size: 1.2rem;
    }
    
    .panel-nav {
      display: flex;
      gap: var(--spacer-sm);
      margin-bottom: var(--spacer-xl);
      flex-wrap: wrap;
      border-bottom: 1px solid var(--outline);
      padding-bottom: var(--spacer-md);
    }
    
    .panel-nav button {
      padding: var(--spacer-sm) var(--spacer-md);
      background: var(--surface-container);
      color: var(--on-surface-variant);
      border: 1px solid var(--outline);
      font-size: 0.95rem;
      border-radius: var(--shapes-corner-md);
      font-weight: 500;
      transition: var(--transition);
      min-width: 100px;
    }
    
    .panel-nav button:hover {
      background: var(--blue-50);
      border-color: var(--blue-300);
    }
    
    .panel-nav button.active {
      background: var(--roles-primary-primary);
      color: var(--roles-primary-on-primary);
      border-color: var(--roles-primary-primary);
      font-weight: 600;
    }
    
    .close-btn {
      position: absolute;
      top: var(--spacer-lg);
      right: var(--spacer-lg);
      background: var(--surface-container);
      border: 1px solid var(--outline);
      width: 40px;
      height: 40px;
      border-radius: 50%;
      cursor: pointer;
      font-size: 1.6rem;
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--on-surface);
      transition: var(--transition);
      box-shadow: var(--elevation-1);
    }
    
    .close-btn:hover {
      background: var(--red-50);
      color: var(--red-600);
      border-color: var(--red-300);
      transform: rotate(90deg);
      box-shadow: 0 2px 8px rgba(234, 67, 53, 0.2);
    }
    
    .panel-gallery {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: var(--spacer-md);
      margin-top: var(--spacer-lg);
    }
    
    .panel-img-block {
      background: var(--surface-container);
      border-radius: var(--shapes-corner-md);
      padding: var(--spacer-md);
      box-shadow: var(--elevation-1);
      text-align: center;
      transition: var(--transition);
      border: 1px solid var(--outline);
    }
    
    .panel-img-block:hover {
      transform: translateY(-2px);
      box-shadow: var(--elevation-2);
      border-color: var(--blue-300);
    }
    
    .panel-img-block img {
      max-width: 100%;
      border-radius: var(--shapes-corner-sm);
      box-shadow: 0 1px 4px rgba(0,0,0,0.1);
      transition: var(--transition);
    }
    
    .panel-img-block:hover img {
      transform: scale(1.04);
      box-shadow: 0 2px 8px rgba(0,0,0,0.15);
    }
    
    .panel-img-caption {
      margin-top: var(--spacer-xs);
      font-size: 0.95rem;
      color: var(--on-surface-variant);
    }
    
    .panel-warn {
      margin: var(--spacer-lg) 0;
      font-weight: 500;
      padding: var(--spacer-md) var(--spacer-lg);
      border-radius: var(--shapes-corner-md);
      display: flex;
      align-items: center;
      gap: var(--spacer-sm);
      background: var(--yellow-50);
      border-left: 4px solid var(--yellow-600);
      border: 1px solid var(--yellow-300);
    }
    
    .panel-warn.fatal {
      background: var(--red-50);
      border-left-color: var(--red-600);
      border-color: var(--red-300);
    }
    
    .panel-warn.leve {
      background: var(--green-50);
      border-left-color: var(--green-600);
      border-color: var(--green-300);
    }
    
    .comb-result .fatal {
      background: var(--red-50);
      border-left: 4px solid var(--red-600);
      border: 1px solid var(--red-300);
    }
    
    .comb-result .moderate {
      background: var(--yellow-50);
      border-left: 4px solid var(--yellow-600);
      border: 1px solid var(--yellow-300);
    }
    
    .comb-result .leve {
      background: var(--green-50);
      border-left: 4px solid var(--green-600);
      border: 1px solid var(--green-300);
    }
    
    .comb-result div {
      margin-bottom: var(--spacer-sm);
      padding: var(--spacer-sm) var(--spacer-md);
      border-radius: var(--shapes-corner-sm);
    }
    
    .notif-area {
      margin: var(--spacer-lg) 0 0 0;
      display: flex;
      gap: var(--spacer-md);
      flex-wrap: wrap;
    }
    
    .notif {
      border-radius: var(--shapes-corner-lg);
      background: var(--surface);
      box-shadow: var(--elevation-1);
      padding: var(--spacer-md) var(--spacer-lg);
      display: flex;
      align-items: center;
      gap: var(--spacer-sm);
      font-size: 1.05rem;
      flex: 1;
      min-width: 300px;
      border: 1px solid var(--outline);
      transition: var(--transition);
    }
    
    .notif:hover {
      transform: translateY(-2px);
      box-shadow: var(--elevation-2);
      border-color: var(--blue-300);
    }
    
    .notif.fatal {
      border-color: var(--red-300);
      background: var(--red-50);
    }
    
    .notif.moderate {
      border-color: var(--yellow-300);
      background: var(--yellow-50);
    }
    
    .notif.leve {
      border-color: var(--green-300);
      background: var(--green-50);
    }
    
    .youtube-thumb {
      border-radius: var(--shapes-corner-md);
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      width: 100%;
      height: auto;
      transition: var(--transition);
    }
    
    .youtube-thumb:hover {
      transform: scale(1.02);
      box-shadow: 0 4px 16px rgba(0,0,0,0.15);
    }
    
    .edu-link-card {
      background: var(--surface-container);
      border-radius: var(--shapes-corner-md);
      padding: var(--spacer-md);
      margin-bottom: var(--spacer-sm);
      box-shadow: var(--elevation-1);
      transition: var(--transition);
      border: 1px solid var(--outline);
    }
    
    .edu-link-card:hover {
      transform: translateY(-1px);
      box-shadow: var(--elevation-2);
      border-color: var(--blue-300);
    }
    
    details {
      margin-top: var(--spacer-xl);
      border: 1px solid var(--outline);
      border-radius: var(--shapes-corner-lg);
      overflow: hidden;
    }
    
    details[open] {
      box-shadow: var(--elevation-1);
    }
    
    summary {
      padding: var(--spacer-md) var(--spacer-lg);
      font-family: var(--font);
      font-weight: 500;
      background: var(--surface-container);
      cursor: pointer;
      user-select: none;
      transition: var(--transition);
      display: flex;
      align-items: center;
      gap: var(--spacer-sm);
    }
    
    summary:hover {
      background: var(--blue-50);
    }
    
    summary::marker {
      color: var(--roles-primary-primary);
      font-size: 1.2em;
    }
    
    summary .material-symbols-outlined {
      font-variation-settings: 'FILL' 1, 'wght' 600;
      transition: transform 0.3s;
    }
    
    details[open] summary .material-symbols-outlined {
      transform: rotate(90deg);
    }
    
    input, select, textarea {
      padding: var(--spacer-md);
      border-radius: var(--shapes-corner-lg);
      border: 1px solid var(--outline);
      background: var(--surface);
      font-family: var(--font-text);
      font-size: 1rem;
      margin-bottom: var(--spacer-md);
      width: 100%;
      transition: var(--transition);
      box-shadow: none;
    }
    
    input:focus, select:focus, textarea:focus {
      outline: none;
      border-color: var(--roles-primary-primary);
      box-shadow: 0 0 0 2px rgba(26, 115, 232, 0.2);
    }
    
    button#checkComb {
      background: var(--roles-primary-primary);
      color: var(--roles-primary-on-primary);
      border: none;
      padding: var(--spacer-md) var(--spacer-xl);
      border-radius: var(--shapes-corner-lg);
      font-family: var(--font);
      font-weight: 500;
      font-size: 1.05rem;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: var(--spacer-sm);
      transition: var(--transition);
      box-shadow: var(--elevation-1);
      width: fit-content;
    }
    
    button#checkComb:hover {
      background: var(--blue-700);
      transform: translateY(-1px);
      box-shadow: var(--elevation-2);
    }
    
    button#checkComb:active {
      transform: translateY(0);
    }
    
    .search-box {
      margin-bottom: var(--spacer-xl);
    }
    
    .search-box input {
      padding-left: 48px;
      background-position: 16px center;
      background-repeat: no-repeat;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='20' height='20' viewBox='0 0 24 24' fill='none' stroke='%235f6368' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Ccircle cx='11' cy='11' r='8'/%3E%3Cline x1='21' y1='21' x2='16.65' y2='16.65'/%3E%3C/svg%3E");
    }
    
    .wiki-summary {
      background: var(--surface-container);
      padding: var(--spacer-lg);
      border-radius: var(--shapes-corner-lg);
      margin-top: var(--spacer-xl);
      border: 1px solid var(--outline);
      line-height: 1.6;
      font-size: 1.05rem;
    }
    
    .wiki-summary a {
      color: var(--roles-primary-primary);
      font-weight: 500;
      text-decoration: none;
      transition: var(--transition);
    }
    
    .wiki-summary a:hover {
      color: var(--blue-800);
      text-decoration: underline;
    }
    
    .vih-info {
      background: var(--blue-50);
      border-left: 4px solid var(--blue-600);
      border: 1px solid var(--blue-300);
      padding: var(--spacer-md) var(--spacer-lg);
      border-radius: var(--shapes-corner-md);
      margin: var(--spacer-lg) 0;
    }
    
    .vih-interactions {
      margin-top: var(--spacer-lg);
    }
    
    .vih-interactions h4 {
      color: var(--roles-primary-primary);
      font-family: var(--font);
      font-weight: 600;
      margin: var(--spacer-md) 0 var(--spacer-sm) 0;
    }
    
    .vih-interactions ul {
      margin: 0;
      padding-left: 20px;
    }
    
    .vih-interactions li {
      margin: 8px 0;
      padding-left: 6px;
    }
    
    .form-section {
      margin-bottom: var(--spacer-xl);
      padding-bottom: var(--spacer-xl);
      border-bottom: 1px solid var(--outline-variant);
    }
    
    .form-section:last-child {
      border-bottom: none;
      margin-bottom: 0;
      padding-bottom: 0;
    }
    
    .form-row {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: var(--spacer-md);
      margin-bottom: var(--spacer-md);
    }
    
    .form-group {
      margin-bottom: var(--spacer-md);
    }
    
    .form-group label {
      display: block;
      margin-bottom: var(--spacer-xs);
      font-weight: 500;
      color: var(--on-surface-variant);
    }
    
    .btn-primary {
      background: var(--clinico-primary);
      color: white;
      border: none;
      padding: var(--spacer-md) var(--spacer-xl);
      border-radius: var(--shapes-corner-lg);
      font-family: var(--font);
      font-weight: 500;
      font-size: 1.05rem;
      cursor: pointer;
      transition: var(--transition);
      box-shadow: var(--elevation-1);
    }
    
    .btn-primary:hover {
      background: var(--blue-700);
      transform: translateY(-1px);
      box-shadow: var(--elevation-2);
    }
    
    .btn-secondary {
      background: var(--surface-container);
      color: var(--on-surface-variant);
      border: 1px solid var(--outline);
      padding: var(--spacer-md) var(--spacer-xl);
      border-radius: var(--shapes-corner-lg);
      font-family: var(--font);
      font-weight: 500;
      font-size: 1.05rem;
      cursor: pointer;
      transition: var(--transition);
    }
    
    .btn-secondary:hover {
      background: var(--blue-50);
      border-color: var(--blue-300);
    }
    
    .btn-danger {
      background: var(--clinico-danger);
      color: white;
      border: none;
      padding: var(--spacer-md) var(--spacer-xl);
      border-radius: var(--shapes-corner-lg);
      font-family: var(--font);
      font-weight: 500;
      font-size: 1.05rem;
      cursor: pointer;
      transition: var(--transition);
    }
    
    .btn-danger:hover {
      background: var(--red-600);
      transform: translateY(-1px);
    }
    
    .btn-group {
      display: flex;
      gap: var(--spacer-md);
      margin-top: var(--spacer-xl);
    }
    
    .tabs {
      display: flex;
      gap: var(--spacer-xs);
      margin-bottom: var(--spacer-xl);
      border-bottom: 1px solid var(--outline);
    }
    
    .tab {
      padding: var(--spacer-md) var(--spacer-lg);
      background: var(--surface-container);
      border: 1px solid var(--outline);
      border-bottom: none;
      border-radius: var(--shapes-corner-md) var(--shapes-corner-md) 0 0;
      cursor: pointer;
      font-family: var(--font);
      font-weight: 500;
      transition: var(--transition);
    }
    
    .tab.active {
      background: var(--clinico-primary);
      color: white;
      border-color: var(--clinico-primary);
    }
    
    .tab:hover:not(.active) {
      background: var(--blue-50);
    }
    
    .patient-info {
      background: var(--surface-container);
      padding: var(--spacer-lg);
      border-radius: var(--shapes-corner-lg);
      margin-bottom: var(--spacer-xl);
      border: 1px solid var(--outline);
    }
    
    .patient-info h3 {
      margin: 0 0 var(--spacer-md) 0;
      color: var(--clinico-primary);
      font-family: var(--font);
    }
    
    .patient-info-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: var(--spacer-md);
    }
    
    .patient-info-item {
      padding: var(--spacer-sm) 0;
      border-bottom: 1px dashed var(--outline-variant);
    }
    
    .patient-info-label {
      font-weight: 500;
      color: var(--on-surface-variant);
    }
    
    .patient-info-value {
      font-weight: 500;
      color: var(--on-surface);
    }
    
    .resource-card {
      background: var(--surface-container);
      border-radius: var(--shapes-corner-lg);
      padding: var(--spacer-lg);
      margin-bottom: var(--spacer-md);
      border: 1px solid var(--outline);
      box-shadow: var(--elevation-1);
      transition: var(--transition);
    }
    
    .resource-card:hover {
      transform: translateY(-2px);
      box-shadow: var(--elevation-2);
      border-color: var(--blue-300);
    }
    
    .resource-card h4 {
      margin: 0 0 var(--spacer-sm) 0;
      color: var(--roles-primary-primary);
      font-family: var(--font);
    }
    
    .resource-card p {
      margin: 0 0 var(--spacer-sm) 0;
      color: var(--on-surface-variant);
    }
    
    .resource-links {
      display: flex;
      gap: var(--spacer-sm);
      flex-wrap: wrap;
    }
    
    .resource-link {
      background: var(--surface);
      color: var(--roles-primary-primary);
      padding: var(--spacer-sm) var(--spacer-md);
      border-radius: var(--shapes-corner-md);
      text-decoration: none;
      font-size: 0.95rem;
      border: 1px solid var(--outline);
      transition: var(--transition);
    }
    
    .resource-link:hover {
      background: var(--blue-50);
      border-color: var(--blue-300);
      transform: translateY(-1px);
    }
    
    .resource-icon {
      margin-right: var(--spacer-xs);
      font-size: 1.1rem;
      vertical-align: middle;
    }
    
    .external-links {
      margin-top: var(--spacer-xl);
      padding: var(--spacer-lg);
      background: var(--blue-50);
      border-radius: var(--shapes-corner-lg);
      border: 1px solid var(--blue-300);
    }
    
    .external-links h3 {
      margin: 0 0 var(--spacer-md) 0;
      color: var(--roles-primary-primary);
      font-family: var(--font);
    }
    
    .external-links-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: var(--spacer-md);
    }
    
    .external-link {
      background: var(--surface);
      padding: var(--spacer-md);
      border-radius: var(--shapes-corner-md);
      text-align: center;
      text-decoration: none;
      color: var(--on-surface);
      border: 1px solid var(--outline);
      transition: var(--transition);
    }
    
    .external-link:hover {
      background: var(--blue-50);
      border-color: var(--blue-300);
      transform: translateY(-2px);
    }
    
    .external-link-icon {
      font-size: 2rem;
      margin-bottom: var(--spacer-sm);
      color: var(--clinico-primary);
    }
    
    .chat-container {
      margin-top: var(--spacer-xl);
      border: 1px solid var(--outline);
      border-radius: var(--shapes-corner-lg);
      overflow: hidden;
    }
    
    .chat-header {
      background: var(--clinico-primary);
      color: white;
      padding: var(--spacer-md);
      font-weight: 500;
    }
    
    .chat-messages {
      height: 300px;
      overflow-y: auto;
      padding: var(--spacer-md);
      background: var(--surface-container);
    }
    
    .chat-message {
      margin-bottom: var(--spacer-md);
      padding: var(--spacer-sm) var(--spacer-md);
      border-radius: var(--shapes-corner-md);
      max-width: 80%;
    }
    
    .chat-message.user {
      background: var(--clinico-primary);
      color: white;
      align-self: flex-end;
      margin-left: auto;
    }
    
    .chat-message.system {
      background: var(--green-50);
      color: var(--green-800);
      border-left: 4px solid var(--green-600);
    }
    
    .chat-message.warning {
      background: var(--yellow-50);
      color: var(--yellow-800);
      border-left: 4px solid var(--yellow-600);
    }
    
    .chat-message.error {
      background: var(--red-50);
      color: var(--red-800);
      border-left: 4px solid var(--red-600);
    }
    
    .chat-input {
      display: flex;
      padding: var(--spacer-md);
      background: var(--surface-container);
      border-top: 1px solid var(--outline);
    }
    
    .chat-input input {
      flex: 1;
      margin-right: var(--spacer-sm);
      margin-bottom: 0;
    }
    
    .chat-input button {
      margin-bottom: 0;
      padding: var(--spacer-sm) var(--spacer-md);
    }
    
    .info-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: var(--spacer-md);
    }
    
    .info-table th, .info-table td {
      padding: var(--spacer-md);
      border: 1px solid var(--outline);
      text-align: left;
    }
    
    .info-table th {
      background: var(--surface-container);
      font-weight: 500;
    }
    
    .info-table tr:nth-child(even) {
      background: var(--surface-container);
    }
    
    /* Nuevos estilos para las mejoras */
    .dashboard-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: var(--spacer-lg);
      margin-top: var(--spacer-xl);
    }
    
    .dashboard-card {
      background: var(--surface);
      border-radius: var(--shapes-corner-lg);
      padding: var(--spacer-lg);
      box-shadow: var(--elevation-1);
      border: 1px solid var(--outline);
      transition: var(--transition);
    }
    
    .dashboard-card:hover {
      transform: translateY(-2px);
      box-shadow: var(--elevation-2);
    }
    
    .dashboard-card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: var(--spacer-md);
    }
    
    .dashboard-card-title {
      font-family: var(--font);
      font-weight: 500;
      color: var(--clinico-primary);
      margin: 0;
    }
    
    .dashboard-card-icon {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: var(--blue-50);
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--clinico-primary);
    }
    
    .metric-value {
      font-size: 2rem;
      font-weight: 700;
      color: var(--clinico-text);
      margin: var(--spacer-sm) 0;
    }
    
    .metric-change {
      display: flex;
      align-items: center;
      font-size: 0.9rem;
      font-weight: 500;
    }
    
    .metric-change.positive {
      color: var(--green-600);
    }
    
    .metric-change.negative {
      color: var(--red-600);
    }
    
    .chart-container {
      position: relative;
      height: 250px;
      margin-top: var(--spacer-md);
    }
    
    .reminder-list {
      list-style: none;
      padding: 0;
      margin: 0;
    }
    
    .reminder-item {
      display: flex;
      align-items: center;
      padding: var(--spacer-sm) 0;
      border-bottom: 1px solid var(--outline);
    }
    
    .reminder-item:last-child {
      border-bottom: none;
    }
    
    .reminder-icon {
      margin-right: var(--spacer-sm);
      color: var(--clinico-primary);
    }
    
    .reminder-content {
      flex: 1;
    }
    
    .reminder-title {
      font-weight: 500;
      margin: 0 0 var(--spacer-xs) 0;
    }
    
    .reminder-time {
      font-size: 0.9rem;
      color: var(--clinico-text-secondary);
    }
    
    .badge {
      display: inline-block;
      padding: 4px 8px;
      border-radius: 12px;
      font-size: 0.75rem;
      font-weight: 500;
    }
    
    .badge-success {
      background: var(--green-50);
      color: var(--green-700);
    }
    
    .badge-warning {
      background: var(--yellow-50);
      color: var(--yellow-700);
    }
    
    .badge-danger {
      background: var(--red-50);
      color: var(--red-700);
    }
    
    .badge-info {
      background: var(--blue-50);
      color: var(--blue-700);
    }
    
    .timeline {
      position: relative;
      margin: var(--spacer-xl) 0;
      padding-left: var(--spacer-lg);
    }
    
    .timeline::before {
      content: '';
      position: absolute;
      left: 0;
      top: 0;
      height: 100%;
      width: 2px;
      background: var(--outline);
    }
    
    .timeline-item {
      position: relative;
      margin-bottom: var(--spacer-lg);
    }
    
    .timeline-item::before {
      content: '';
      position: absolute;
      left: -25px;
      top: 0;
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background: var(--clinico-primary);
    }
    
    .timeline-date {
      font-size: 0.9rem;
      color: var(--clinico-text-secondary);
      margin-bottom: var(--spacer-xs);
    }
    
    .timeline-content {
      background: var(--surface-container);
      padding: var(--spacer-md);
      border-radius: var(--shapes-corner-md);
      border: 1px solid var(--outline);
    }
    
    .dosage-calculator {
      background: var(--surface-container);
      padding: var(--spacer-lg);
      border-radius: var(--shapes-corner-lg);
      margin-top: var(--spacer-xl);
      border: 1px solid var(--outline);
    }
    
    .calculator-result {
      margin-top: var(--spacer-lg);
      padding: var(--spacer-md);
      background: var(--blue-50);
      border-radius: var(--shapes-corner-md);
      border-left: 4px solid var(--blue-600);
    }
    
    .adherence-meter {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-top: var(--spacer-md);
    }
    
    .adherence-progress {
      flex: 1;
      height: 8px;
      background: var(--outline);
      border-radius: 4px;
      overflow: hidden;
    }
    
    .adherence-progress-bar {
      height: 100%;
      background: var(--clinico-primary);
      border-radius: 4px;
    }
    
    .adherence-value {
      margin-left: var(--spacer-md);
      font-weight: 500;
    }
    
    .patient-selector {
      display: flex;
      gap: var(--spacer-sm);
      margin-bottom: var(--spacer-xl);
      flex-wrap: wrap;
    }
    
    .patient-pill {
      padding: var(--spacer-sm) var(--spacer-md);
      background: var(--surface-container);
      border: 1px solid var(--outline);
      border-radius: var(--shapes-corner-lg);
      cursor: pointer;
      transition: var(--transition);
      font-weight: 500;
    }
    
    .patient-pill.active {
      background: var(--clinico-primary);
      color: white;
      border-color: var(--clinico-primary);
    }
    
    .patient-pill:hover:not(.active) {
      background: var(--blue-50);
      border-color: var(--blue-300);
    }
    
    .alert-banner {
      padding: var(--spacer-md);
      border-radius: var(--shapes-corner-md);
      margin-bottom: var(--spacer-lg);
      display: flex;
      align-items: center;
      gap: var(--spacer-sm);
    }
    
    .alert-banner.critical {
      background: var(--red-50);
      border: 1px solid var(--red-300);
      color: var(--red-700);
    }
    
    .alert-banner.warning {
      background: var(--yellow-50);
      border: 1px solid var(--yellow-300);
      color: var(--yellow-700);
    }
    
    .alert-banner.info {
      background: var(--blue-50);
      border: 1px solid var(--blue-300);
      color: var(--blue-700);
    }
    
    /* Mejoras UX/UI adicionales */
    .quick-actions {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: var(--spacer-md);
      margin-bottom: var(--spacer-xl);
    }
    
    .quick-action-btn {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: var(--spacer-lg);
      background: var(--surface);
      border-radius: var(--shapes-corner-lg);
      box-shadow: var(--elevation-1);
      border: 1px solid var(--outline);
      transition: var(--transition);
      cursor: pointer;
      text-align: center;
    }
    
    .quick-action-btn:hover {
      transform: translateY(-4px);
      box-shadow: var(--elevation-3);
      border-color: var(--blue-300);
    }
    
    .quick-action-icon {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      background: var(--blue-50);
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: var(--spacer-md);
      color: var(--clinico-primary);
    }
    
    .quick-action-title {
      font-family: var(--font);
      font-weight: 500;
      color: var(--clinico-text);
      margin-bottom: var(--spacer-xs);
    }
    
    .quick-action-desc {
      font-size: 0.9rem;
      color: var(--clinico-text-secondary);
    }
    
    .search-global {
      position: relative;
      margin-bottom: var(--spacer-xl);
      width: 400px;
    }
    
    .search-global input {
      padding-left: 48px;
      border-radius: var(--shapes-corner-xl);
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='20' height='20' viewBox='0 0 24 24' fill='none' stroke='%235f6368' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Ccircle cx='11' cy='11' r='8'/%3E%3Cline x1='21' y1='21' x2='16.65' y2='16.65'/%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: 16px center;
    }
    
    .search-results {
      position: absolute;
      top: 100%;
      left: 0;
      right: 0;
      background: var(--surface);
      border-radius: var(--shapes-corner-md);
      box-shadow: var(--elevation-3);
      z-index: 10;
      margin-top: var(--spacer-xs);
      max-height: 300px;
      overflow-y: auto;
      display: none;
    }
    
    .search-result-item {
      padding: var(--spacer-md);
      border-bottom: 1px solid var(--outline);
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: var(--spacer-sm);
    }
    
    .search-result-item:hover {
      background: var(--blue-50);
    }
    
    .search-result-item:last-child {
      border-bottom: none;
    }
    
    .empty-state {
      text-align: center;
      padding: var(--spacer-2xl);
      color: var(--clinico-text-secondary);
    }
    
    .empty-state-icon {
      font-size: 3rem;
      margin-bottom: var(--spacer-md);
      color: var(--grey-400);
    }
    
    .empty-state-title {
      font-family: var(--font);
      font-weight: 500;
      margin-bottom: var(--spacer-sm);
    }
    
    .empty-state-desc {
      margin-bottom: var(--spacer-lg);
    }
    
    .keyboard-shortcuts {
      margin-top: var(--spacer-xl);
    }
    
    .shortcut-item {
      display: flex;
      justify-content: space-between;
      padding: var(--spacer-sm) 0;
      border-bottom: 1px solid var(--outline);
    }
    
    .shortcut-item:last-child {
      border-bottom: none;
    }
    
    .shortcut-keys {
      display: flex;
      gap: var(--spacer-xs);
    }
    
    .shortcut-key {
      padding: 2px 6px;
      background: var(--surface-container);
      border: 1px solid var(--outline);
      border-radius: var(--shapes-corner-sm);
      font-size: 0.8rem;
      font-family: monospace;
    }
    
    .theme-toggle {
      position: fixed;
      bottom: var(--spacer-lg);
      right: var(--spacer-lg);
      width: 50px;
      height: 50px;
      border-radius: 50%;
      background: var(--clinico-primary);
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: var(--elevation-3);
      cursor: pointer;
      z-index: 99;
      transition: var(--transition);
    }
    
    .theme-toggle:hover {
      transform: scale(1.1);
    }
    
    .loading-indicator {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 3px;
      background: transparent;
      z-index: 9999;
    }
    
    .loading-indicator::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      height: 100%;
      width: 50%;
      background: var(--clinico-primary);
      animation: loading 1.5s infinite;
    }
    
    @keyframes loading {
      0% { left: -50%; }
      100% { left: 150%; }
    }
    
    .toast {
      position: fixed;
      bottom: var(--spacer-xl);
      left: 50%;
      transform: translateX(-50%);
      padding: var(--spacer-md) var(--spacer-lg);
      background: var(--grey-800);
      color: white;
      border-radius: var(--shapes-corner-lg);
      box-shadow: var(--elevation-3);
      z-index: 1000;
      display: flex;
      align-items: center;
      gap: var(--spacer-sm);
      opacity: 0;
      transition: opacity 0.3s;
    }
    
    .toast.visible {
      opacity: 1;
    }
    
    .toast.success {
      background: var(--green-600);
    }
    
    .toast.error {
      background: var(--red-600);
    }
    
    .toast.warning {
      background: var(--yellow-600);
    }
    
    .context-menu {
      position: fixed;
      background: var(--surface);
      border-radius: var(--shapes-corner-md);
      box-shadow: var(--elevation-3);
      z-index: 1000;
      display: none;
    }
    
    .context-menu-item {
      padding: var(--spacer-md);
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: var(--spacer-sm);
    }
    
    .context-menu-item:hover {
      background: var(--blue-50);
    }
    
    .context-menu-divider {
      height: 1px;
      background: var(--outline);
      margin: var(--spacer-xs) 0;
    }
    
    /* Estilos para modo oscuro */
    body.dark-mode {
      --background: #121212;
      --surface: #1e1e1e;
      --surface-container: #2d2d2d;
      --surface-container-bright: #363636;
      --on-surface: #ffffff;
      --on-surface-variant: #e0e0e0;
      --outline: #404040;
      --outline-variant: #606060;
    }
    
    /* Mejoras de accesibilidad */
    @media (prefers-reduced-motion: reduce) {
      * {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
      }
    }
    
    .focus-visible:focus {
      outline: 2px solid var(--clinico-primary);
      outline-offset: 2px;
    }
    
    .high-contrast {
      --clinico-primary: #0057b8;
      --clinico-text: #000000;
      --on-surface: #000000;
      --outline: #000000;
    }
    
    /* Mejoras de impresión */
    @media print {
      nav, .theme-toggle, .user-profile {
        display: none !important;
      }
      
      .glass-home {
        box-shadow: none !important;
        border: 1px solid #ccc !important;
        page-break-inside: avoid;
      }
      
      .dashboard-card {
        page-break-inside: avoid;
      }
      
      body {
        background: white !important;
        color: black !important;
      }
    }
    
    @media (max-width: 768px) {
      .app {
        padding: var(--spacer-sm);
      }
      
      header {
        flex-direction: column;
        padding: var(--spacer-lg) var(--spacer-md);
        gap: var(--spacer-md);
      }
      
      .logo {
        font-size: 2.2rem;
        padding: var(--spacer-md) var(--spacer-lg);
        justify-content: center;
      }
      
      .subtitle {
        text-align: center;
        font-size: 1.1rem;
      }
      
      nav {
        padding: var(--spacer-md);
        gap: var(--spacer-sm);
      }
      
      nav button {
        padding: var(--spacer-sm) var(--spacer-md);
        font-size: 0.95rem;
        min-width: auto;
      }
      
      .glass-home {
        padding: var(--spacer-xl) var(--spacer-lg);
      }
      
      .panel {
        min-width: 95vw;
        padding: var(--spacer-xl) var(--spacer-lg) var(--spacer-lg) var(--spacer-lg);
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%) scale(0.95);
      }
      
      .close-btn {
        top: var(--spacer-md);
        right: var(--spacer-md);
        width: 36px;
        height: 36px;
        font-size: 1.4rem;
      }
      
      .form-row {
        grid-template-columns: 1fr;
      }
      
      .info-table {
        display: block;
        overflow-x: auto;
      }
      
      .dashboard-grid {
        grid-template-columns: 1fr;
      }
      
      .search-global {
        width: 100%;
      }
    }
    
    @media (max-width: 480px) {
      nav {
        flex-direction: column;
      }
      
      nav button {
        width: 100%;
        justify-content: center;
      }
      
      .home-gallery, .panel-gallery {
        grid-template-columns: 1fr;
      }
      
      .notif-area {
        flex-direction: column;
      }
      
      .notif {
        min-width: auto;
      }
      
      .btn-group {
        flex-direction: column;
      }
      
      .btn-group button {
        width: 100%;
      }
      
      .external-links-grid {
        grid-template-columns: 1fr;
      }
      
      .patient-selector {
        flex-direction: column;
      }
      
      .quick-actions {
        grid-template-columns: 1fr;
      }
    }
    
    /* Animation for panel entrance */
    @keyframes fadeIn {
      from { opacity: 0; transform: translate(-50%, -50%) scale(0.95); }
      to { opacity: 1; transform: translate(-50%, -50%) scale(1); }
    }
    
    .panel.active {
      animation: fadeIn 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
    }
  </style>
</head>
<body>
<div class="app">
  <!-- Loading indicator -->
  <div class="loading-indicator" id="loadingIndicator"></div>
  
  <!-- Toast notifications -->
  <div class="toast" id="globalToast"></div>
  
  <!-- Context menu -->
  <div class="context-menu" id="contextMenu">
    <div class="context-menu-item" data-action="edit">
      <span class="material-symbols-outlined">edit</span>
      Editar
    </div>
    <div class="context-menu-item" data-action="view">
      <span class="material-symbols-outlined">visibility</span>
      Ver detalles
    </div>
    <div class="context-menu-divider"></div>
    <div class="context-menu-item" data-action="delete">
      <span class="material-symbols-outlined">delete</span>
      Eliminar
    </div>
  </div>
  
  <header>
    <span class="logo">
      <span class="material-symbols-outlined">health_and_safety</span>
      SaludPro
    </span>
    
    <!-- Búsqueda global -->
    <div class="search-global">
      <input type="text" placeholder="Buscar pacientes, medicamentos, interacciones..." id="globalSearch">
      <div class="search-results" id="searchResults"></div>
    </div>
    
    <div class="user-profile" id="userProfile">
      <div class="avatar">DR</div>
      <div>
        <div style="font-weight: 500; color: var(--clinico-text);">Dr. Juan Pérez</div>
        <div style="font-size: 0.9rem; color: var(--clinico-text-secondary);">Cardiólogo</div>
      </div>
    </div>
  </header>
  
  <!-- Selector de pacientes -->
  <div class="patient-selector">
    <div class="patient-pill active" data-patient-id="1">María López</div>
    <div class="patient-pill" data-patient-id="2">Carlos Ruiz</div>
    <div class="patient-pill" data-patient-id="3">Ana Sánchez</div>
    <div class="patient-pill" data-patient-id="4">Nuevo Paciente</div>
  </div>
  
  <nav>
    <button id="btn-perfil">
      <span class="material-symbols-outlined">person</span>
      Mi Perfil
    </button>
    <button id="btn-pacientes">
      <span class="material-symbols-outlined">group</span>
      Pacientes
    </button>
    <button id="btn-signos">
      <span class="material-symbols-outlined">monitoring</span>
      Signos Vitales
    </button>
    <button id="btn-historia">
      <span class="material-symbols-outlined">description</span>
      Historia Clínica
    </button>
    <button id="btn-interacciones">
      <span class="material-symbols-outlined">warning</span>
      Interacciones
    </button>
    <button id="btn-combinador">
      <span class="material-symbols-outlined">science</span>
      Combinador
    </button>
    <button id="btn-educacion">
      <span class="material-symbols-outlined">menu_book</span>
      Educación
    </button>
    <button id="btn-ayuda">
      <span class="material-symbols-outlined">help</span>
      Ayuda
    </button>
  </nav>
  
  <!-- Acciones rápidas -->
  <div class="quick-actions">
    <div class="quick-action-btn" id="quickNewPatient">
      <div class="quick-action-icon">
        <span class="material-symbols-outlined">person_add</span>
      </div>
      <div class="quick-action-title">Nuevo Paciente</div>
      <div class="quick-action-desc">Agregar nuevo paciente al sistema</div>
    </div>
    
    <div class="quick-action-btn" id="quickNewAppointment">
      <div class="quick-action-icon">
        <span class="material-symbols-outlined">event_available</span>
      </div>
      <div class="quick-action-title">Nueva Cita</div>
      <div class="quick-action-desc">Programar una nueva cita médica</div>
    </div>
    
    <div class="quick-action-btn" id="quickPrescription">
      <div class="quick-action-icon">
        <span class="material-symbols-outlined">receipt_long</span>
      </div>
      <div class="quick-action-title">Receta Médica</div>
      <div class="quick-action-desc">Crear una nueva receta médica</div>
    </div>
    
    <div class="quick-action-btn" id="quickLabResults">
      <div class="quick-action-icon">
        <span class="material-symbols-outlined">biotech</span>
      </div>
      <div class="quick-action-title">Resultados Lab</div>
      <div class="quick-action-desc">Ver resultados de laboratorio</div>
    </div>
  </div>
  
  <!-- Panel de dashboard/resumen -->
  <div class="glass-home">
    <div style="display: flex; justify-content: space-between; align-items: center;">
      <h2 style="margin-top:0; color: var(--roles-primary-primary); font-family: var(--font); font-weight: 700;">Resumen del Paciente: María López</h2>
      <span class="badge badge-success">Tratamiento activo</span>
    </div>
    
    <!-- Alertas importantes -->
    <div class="alert-banner warning">
      <span class="material-symbols-outlined">warning</span>
      <div>Próxima cita de control: 15 de Abril, 2024 - Recordar evaluar función renal</div>
    </div>
    
    <div class="dashboard-grid">
      <!-- Tarjeta 1: Resumen de tratamiento -->
      <div class="dashboard-card">
        <div class="dashboard-card-header">
          <h3 class="dashboard-card-title">Tratamiento Actual</h3>
          <div class="dashboard-card-icon">
            <span class="material-symbols-outlined">medication</span>
          </div>
        </div>
        <div class="metric-value">Tri-zevuvir</div>
        <div class="metric-change positive">
          <span class="material-symbols-outlined">arrow_upward</span>
          Adherencia 92% (14/15 días)
        </div>
        <div class="adherence-meter">
          <div class="adherence-progress">
            <div class="adherence-progress-bar" style="width: 92%"></div>
          </div>
          <div class="adherence-value">92%</div>
        </div>
      </div>
      
      <!-- Tarjeta 2: Signos vitales -->
      <div class="dashboard-card">
        <div class="dashboard-card-header">
          <h3 class="dashboard-card-title">Signos Vitales</h3>
          <div class="dashboard-card-icon">
            <span class="material-symbols-outlined">monitoring</span>
          </div>
        </div>
        <div class="metric-value">126/82 mmHg</div>
        <div class="metric-change positive">
          <span class="material-symbols-outlined">arrow_downward</span>
          Mejoría vs última visita (138/88 mmHg)
        </div>
        <div style="margin-top: var(--spacer-md);">
          <div style="display: flex; justify-content: space-between;">
            <span>FC: 78 lpm</span>
            <span>Temp: 36.8°C</span>
            <span>SatO2: 98%</span>
          </div>
        </div>
      </div>
      
      <!-- Tarjeta 3: Próximos recordatorios -->
      <div class="dashboard-card">
        <div class="dashboard-card-header">
          <h3 class="dashboard-card-title">Próximos Recordatorios</h3>
          <div class="dashboard-card-icon">
            <span class="material-symbols-outlined">notifications</span>
          </div>
        </div>
        <ul class="reminder-list">
          <li class="reminder-item">
            <span class="material-symbols-outlined reminder-icon">event</span>
            <div class="reminder-content">
              <div class="reminder-title">Control de función renal</div>
              <div class="reminder-time">Hoy, 10:30 AM</div>
            </div>
          </li>
          <li class="reminder-item">
            <span class="material-symbols-outlined reminder-icon">medication</span>
            <div class="reminder-content">
              <div class="reminder-title">Renovación de receta</div>
              <div class="reminder-time">En 5 días</div>
            </div>
          </li>
          <li class="reminder-item">
            <span class="material-symbols-outlined reminder-icon">bloodtype</span>
            <div class="reminder-content">
              <div class="reminder-title">Análisis de carga viral</div>
              <div class="reminder-time">En 2 semanas</div>
            </div>
          </li>
        </ul>
      </div>
    </div>
    
    <!-- Gráfico de evolución -->
    <div class="dashboard-card" style="grid-column: 1 / -1; margin-top: var(--spacer-lg);">
      <div class="dashboard-card-header">
        <h3 class="dashboard-card-title">Evolución de CD4 y Carga Viral</h3>
        <div class="dashboard-card-icon">
          <span class="material-symbols-outlined">show_chart</span>
        </div>
      </div>
      <div class="chart-container">
        <canvas id="healthChart"></canvas>
      </div>
    </div>
  </div>
  
  <!-- Información específica sobre Tri-zevuvir -->
  <div class="glass-home">
    <h2 style="margin-top:0; color: var(--roles-primary-primary); font-family: var(--font); font-weight: 700;">Información Detallada sobre Tri-zevuvir</h2>
    
    <div class="vih-info">
      <h3 style="margin: 0 0 var(--spacer-sm) 0; color: var(--roles-primary-primary); font-family: var(--font);">Tri-zevuvir: Tratamiento Antirretroviral Combinado</h3>
      <p><b>Composición:</b> Emtricitabina 200mg, Tenofovir alafenamida 25mg, Dolutegravir 50mg</p>
      <p><b>Indicación:</b> Tratamiento de mantenimiento en adultos y adolescentes (≥12 años, peso ≥40 kg) con infección por VIH-1 que no tienen evidencia de resistencia a los antirretrovirales que contiene.</p>
      <p><b>Mecanismo de acción:</b> Combinación de tres fármacos con mecanismos de acción complementarios que inhiben diferentes etapas del ciclo de replicación del VIH.</p>
    </div>
    
    <!-- Calculadora de dosificación -->
    <div class="dosage-calculator">
      <h3 style="margin: 0 0 var(--spacer-md) 0; color: var(--roles-primary-primary); font-family: var(--font);">Calculadora de Dosificación</h3>
      <div class="form-row">
        <div class="form-group">
          <label for="patient-weight">Peso del paciente (kg)</label>
          <input type="number" id="patient-weight" value="68" min="40">
        </div>
        <div class="form-group">
          <label for="renal-function">Función renal (TFG)</label>
          <input type="number" id="renal-function" value="85" min="30">
        </div>
        <div class="form-group">
          <label for="hepatic-function">Función hepática</label>
          <select id="hepatic-function">
            <option value="normal" selected>Normal</option>
            <option value="mild">Leve</option>
            <option value="moderate">Moderada</option>
            <option value="severe">Severa</option>
          </select>
        </div>
      </div>
      <button class="btn-primary" id="calculateDosage">
        <span class="material-symbols-outlined">calculate</span>
        Calcular Dosificación
      </button>
      
      <div class="calculator-result" id="dosageResult" style="display: none;">
        <h4 style="margin: 0 0 var(--spacer-sm) 0;">Recomendación de Dosificación</h4>
        <p style="margin: 0;">Dosis estándar: <b>1 comprimido una vez al día</b></p>
        <p style="margin: var(--spacer-xs) 0 0 0;">Consideraciones: Administrar con o sin alimentos. Monitorear función renal cada 3 meses.</p>
      </div>
    </div>
    
    <div class="vih-interactions" style="margin-top: var(--spacer-xl);">
      <h3>Interacciones Medicamentosas Críticas</h3>
      <ul>
        <li><b class="fatal">⛔ Dofetilida, Flecainida, Propafenona:</b> Aumento del riesgo de arritmias graves y muerte súbita debido a la prolongación del intervalo QT.</li>
        <li><b class="fatal">⛔ Rifampicina, Rifabutina:</b> Disminuye significativamente los niveles de dolutegravir, comprometiendo la eficacia antirretroviral y promoviendo resistencia viral.</li>
        <li><b class="moderate">⚠️ Metformina:</b> Aumento del riesgo de acidosis láctica, especialmente en pacientes con disfunción renal. El tenofovir alafenamida puede afectar la función renal.</li>
        <li><b class="moderate">⚠️ Antiácidos (Aluminio, Magnesio):</b> Reducen la absorción de dolutegravir. Deben administrarse con al menos 2-4 horas de separación del Tri-zevuvir.</li>
        <li><b class="moderate">⚠️ Estatinas (Simvastatina, Lovastatina):</b> Aumento del riesgo de miopatía y rabdomiólisis. El dolutegravir puede aumentar los niveles séricos de ciertas estatinas.</li>
        <li><b class="leve">✅ Paracetamol, Ibuprofeno:</b> Generalmente seguros con monitoreo adecuado.</li>
      </ul>
    </div>
  </div>
  
  <!-- Timeline de historial médico -->
  <div class="glass-home">
    <h2 style="margin-top:0; color: var(--roles-primary-primary); font-family: var(--font); font-weight: 700;">Historial de Consultas</h2>
    
    <div class="timeline">
      <div class="timeline-item">
        <div class="timeline-date">15 Marzo, 2024</div>
        <div class="timeline-content">
          <h4 style="margin: 0 0 var(--spacer-xs) 0;">Control de rutina</h4>
          <p style="margin: 0;">Paciente estable, sin quejas. Análisis dentro de rangos normales. Se mantiene tratamiento actual.</p>
        </div>
      </div>
      
      <div class="timeline-item">
        <div class="timeline-date">28 Febrero, 2024</div>
        <div class="timeline-content">
          <h4 style="margin: 0 0 var(--spacer-xs) 0;">Ajuste de medicación</h4>
          <p style="margin: 0;">Se reportaron mareos leves. Ajustada dosis de antihipertensivo. Programar seguimiento en 2 semanas.</p>
        </div>
      </div>
      
      <div class="timeline-item">
        <div class="timeline-date">15 Enero, 2024</div>
        <div class="timeline-content">
          <h4 style="margin: 0 0 var(--spacer-xs) 0;">Inicio de tratamiento con Tri-zevuvir</h4>
          <p style="margin: 0;">Se inició tratamiento antirretroviral. Educado sobre adherencia y efectos secundarios potenciales.</p>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Galería de imágenes médicas -->
  <div class="glass-home">
    <h2 style="margin-top:0; color: var(--roles-primary-primary); font-family: var(--font); font-weight: 700;">Galería de Imágenes Médicas</h2>
    
    <div class="home-gallery">
      <div class="img-block">
        <img src="https://images.unsplash.com/photo-1559757148-5c350d0d3c56?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=500&q=80" alt="Estructura molecular Tri-zevuvir">
        <div class="img-caption">Estructura molecular Tri-zevuvir</div>
      </div>
      
      <div class="img-block">
        <img src="https://images.unsplash.com/photo-1551601651-2a8555f1a136?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=500&q=80" alt="Mecanismo de acción">
        <div class="img-caption">Mecanismo de acción antiviral</div>
      </div>
      
      <div class="img-block">
        <img src="https://images.unsplash.com/photo-1582719471384-8946bb3009b0?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=500&q=80" alt="Monitorización tratamiento">
        <div class="img-caption">Monitorización del tratamiento</div>
      </div>
    </div>
  </div>
  
  <div class="modal-backdrop" id="modalBackdrop"></div>
  
  <!-- Secciones de panel existentes (se mantienen igual) -->
  <!-- ... resto del código de paneles ... -->
  
  <!-- Botón de toggle de tema -->
  <div class="theme-toggle" id="themeToggle">
    <span class="material-symbols-outlined">dark_mode</span>
  </div>
</div>

<script>
// Datos de ejemplo para pacientes
const pacientes = [
  {
    id: 1,
    nombre: "María López Fernández",
    dni: "98765432B",
    edad: 68,
    genero: "femenino",
    telefono: "+34 612 345 678",
    email: "maria.lopez@email.com",
    direccion: "Calle Sol, 45",
    ciudad: "Barcelona",
    provincia: "Barcelona",
    cp: "08001",
    grupoSanguineo: "A+",
    alergias: "Penicilina",
    enfermedades: "Diabetes tipo 2, Hipertensión arterial",
    fechaUltimaVisita: "2024-03-15",
    tratamiento: "Tri-zevuvir",
    adherencia: 92,
    ultimaCargaViral: 50,
    ultimoRecuentoCD4: 450
  },
  {
    id: 2,
    nombre: "Carlos Ruiz Martínez",
    dni: "87654321C",
    edad: 72,
    genero: "masculino",
    telefono: "+34 623 456 789",
    email: "carlos.ruiz@email.com",
    direccion: "Avenida del Mar, 23",
    ciudad: "Valencia",
    provincia: "Valencia",
    cp: "46001",
    grupoSanguineo: "O+",
    alergias: "Contraste yodado",
    enfermedades: "Insuficiencia cardíaca, Fibrilación auricular",
    fechaUltimaVisita: "2024-03-14",
    tratamiento: "Otro tratamiento",
    adherencia: 85,
    ultimaCargaViral: 200,
    ultimoRecuentoCD4: 380
  },
  {
    id: 3,
    nombre: "Ana Sánchez Gómez",
    dni: "76543210D",
    edad: 55,
    genero: "femenino",
    telefono: "+34 634 567 890",
    email: "ana.sanchez@email.com",
    direccion: "Plaza Mayor, 8",
    ciudad: "Sevilla",
    provincia: "Sevilla",
    cp: "41001",
    grupoSanguineo: "B-",
    alergias: "NSAIDs",
    enfermedades: "Artritis reumatoide, Osteoporosis",
    fechaUltimaVisita: "2024-03-13",
    tratamiento: "Tri-zevuvir",
    adherencia: 78,
    ultimaCargaViral: 1200,
    ultimoRecuentoCD4: 250
  }
];

// Datos de evolución para gráficos
const evolucionPaciente = {
  1: {
    fechas: ['Ene', 'Feb', 'Mar'],
    cd4: [320, 390, 450],
    cargaViral: [12500, 1200, 50],
    peso: [67, 67.5, 68],
    tensionSistolica: [140, 135, 126],
    tensionDiastolica: [90, 85, 82]
  },
  2: {
    fechas: ['Ene', 'Feb', 'Mar'],
    cd4: [300, 340, 380],
    cargaViral: [9800, 1500, 200],
    peso: [72, 71.5, 71],
    tensionSistolica: [150, 145, 140],
    tensionDiastolica: [95, 90, 88]
  },
  3: {
    fechas: ['Ene', 'Feb', 'Mar'],
    cd4: [180, 210, 250],
    cargaViral: [28500, 8500, 1200],
    peso: [62, 62.5, 63],
    tensionSistolica: [138, 132, 130],
    tensionDiastolica: [88, 85, 84]
  }
};

// Datos de ejemplo para interacciones
const interaccionesCat = {
  cardio: [
    {
      comb: 'Warfarina + AINEs (Ibuprofeno, Naproxeno)',
      nivel: 'fatal',
      desc: 'Aumento significativo del riesgo de hemorragia gastrointestinal y hemorragia intracraneal. Los AINEs desplazan la warfarina de las proteínas plasmáticas y afectan la función plaquetaria.',
      img: 'https://images.unsplash.com/photo-1559757148-5c350d0d3c56?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=500&q=80'
    },
    {
      comb: 'IECA (Enalapril) + Espironolactona',
      nivel: 'moderate',
      desc: 'Riesgo de hiperkalemia, especialmente en pacientes con disfunción renal. Requiere monitoreo frecuente de electrolitos séricos.',
      img: 'https://images.unsplash.com/photo-1551601651-2a8555f1a136?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=500&q=80'
    }
  ],
  vih: [
    {
      comb: 'Tri-zevuvir + Rifampicina',
      nivel: 'fatal',
      desc: 'La rifampicina reduce drásticamente los niveles de dolutegravir, comprometiendo la eficacia del tratamiento antirretroviral y promoviendo resistencia viral.',
      img: 'https://images.unsplash.com/photo-1582719471384-8946bb3009b0?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=500&q=80'
    },
    {
      comb: 'Tri-zevuvir + Metformina',
      nivel: 'moderate',
      desc: 'Aumento del riesgo de acidosis láctica, especialmente en pacientes con disfunción renal. El tenofovir puede afectar la función renal.',
      img: 'https://images.unsplash.com/photo-1559757148-5c350d0d3c56?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=500&q=80'
    }
  ]
};

// Inicializar gráfico de evolución
function initHealthChart(pacienteId) {
  const data = evolucionPaciente[pacienteId];
  const ctx = document.getElementById('healthChart').getContext('2d');
  
  if (window.healthChartInstance) {
    window.healthChartInstance.destroy();
  }
  
  window.healthChartInstance = new Chart(ctx, {
    type: 'line',
    data: {
      labels: data.fechas,
      datasets: [
        {
          label: 'Células CD4',
          data: data.cd4,
          borderColor: '#1a73e8',
          backgroundColor: 'rgba(26, 115, 232, 0.1)',
          yAxisID: 'y',
          tension: 0.3,
          fill: true
        },
        {
          label: 'Carga Viral',
          data: data.cargaViral,
          borderColor: '#ea4335',
          backgroundColor: 'rgba(234, 67, 53, 0.1)',
          yAxisID: 'y1',
          tension: 0.3,
          fill: true
        }
      ]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      interaction: {
        mode: 'index',
        intersect: false,
      },
      scales: {
        y: {
          type: 'linear',
          display: true,
          position: 'left',
          title: {
            display: true,
            text: 'CD4 (células/μL)'
          }
        },
        y1: {
          type: 'logarithmic',
          display: true,
          position: 'right',
          title: {
            display: true,
            text: 'Carga Viral (copias/mL)'
          },
          grid: {
            drawOnChartArea: false,
          },
        }
      }
    }
  });
}

// Funcionalidades de mejora UX/UI

// 1. Búsqueda global
document.getElementById('globalSearch').addEventListener('input', function(e) {
  const query = e.target.value.toLowerCase().trim();
  const resultsContainer = document.getElementById('searchResults');
  
  if (query.length < 2) {
    resultsContainer.style.display = 'none';
    return;
  }
  
  // Simular resultados de búsqueda
  const results = [
    { type: 'Paciente', name: 'María López Fernández', description: 'ID: 12345 - Última visita: 15/03/2024' },
    { type: 'Medicamento', name: 'Tri-zevuvir', description: 'Antirretroviral - Interacciones: 12' },
    { type: 'Interacción', name: 'Tri-zevuvir + Metformina', description: 'Nivel de riesgo: Moderado' },
    { type: 'Cita', name: 'Control mensual - María López', description: '20/04/2024 - 10:30 AM' }
  ].filter(item => 
    item.name.toLowerCase().includes(query) || 
    item.description.toLowerCase().includes(query)
  );
  
  // Mostrar resultados
  if (results.length > 0) {
    resultsContainer.innerHTML = results.map(result => `
      <div class="search-result-item" data-type="${result.type}">
        <span class="material-symbols-outlined">${getIconForType(result.type)}</span>
        <div>
          <div style="font-weight: 500;">${result.name}</div>
          <div style="font-size: 0.9rem; color: var(--clinico-text-secondary);">${result.description}</div>
        </div>
      </div>
    `).join('');
    
    resultsContainer.style.display = 'block';
    
    // Añadir event listeners a los resultados
    document.querySelectorAll('.search-result-item').forEach(item => {
      item.addEventListener('click', function() {
        document.getElementById('globalSearch').value = '';
        resultsContainer.style.display = 'none';
        showToast(`Redirigiendo a ${this.querySelector('div > div:first-child').textContent}`, 'success');
      });
    });
  } else {
    resultsContainer.innerHTML = '<div class="empty-state" style="padding: var(--spacer-md);">No se encontraron resultados</div>';
    resultsContainer.style.display = 'block';
  }
});

// Cerrar resultados al hacer clic fuera
document.addEventListener('click', function(e) {
  if (!e.target.closest('.search-global')) {
    document.getElementById('searchResults').style.display = 'none';
  }
});

function getIconForType(type) {
  const icons = {
    'Paciente': 'person',
    'Medicamento': 'medication',
    'Interacción': 'warning',
    'Cita': 'event'
  };
  return icons[type] || 'search';
}

// 2. Toggle de tema claro/oscuro
document.getElementById('themeToggle').addEventListener('click', function() {
  document.body.classList.toggle('dark-mode');
  this.querySelector('span').textContent = document.body.classList.contains('dark-mode') ? 
    'light_mode' : 'dark_mode';
  
  // Guardar preferencia
  localStorage.setItem('theme', document.body.classList.contains('dark-mode') ? 'dark' : 'light');
  showToast(`Modo ${document.body.classList.contains('dark-mode') ? 'oscuro' : 'claro'} activado`);
});

// Cargar tema guardado
if (localStorage.getItem('theme') === 'dark') {
  document.body.classList.add('dark-mode');
  document.getElementById('themeToggle').querySelector('span').textContent = 'light_mode';
}

// 3. Mostrar toast notifications
function showToast(message, type = 'default') {
  const toast = document.getElementById('globalToast');
  toast.textContent = message;
  toast.className = 'toast';
  toast.classList.add(type, 'visible');
  
  setTimeout(() => {
    toast.classList.remove('visible');
  }, 3000);
}

// 4. Acciones rápidas
document.getElementById('quickNewPatient').addEventListener('click', function() {
  showLoading();
  setTimeout(() => {
    hideLoading();
    showToast('Nuevo paciente creado con éxito', 'success');
  }, 1000);
});

document.getElementById('quickNewAppointment').addEventListener('click', function() {
  showPanel('pacientes');
  showToast('Redirigiendo a programación de citas');
});

document.getElementById('quickPrescription').addEventListener('click', function() {
  showLoading();
  setTimeout(() => {
    hideLoading();
    showToast('Plantilla de receta médica abierta', 'success');
  }, 800);
});

document.getElementById('quickLabResults').addEventListener('click', function() {
  showPanel('historia');
  showToast('Mostrando resultados de laboratorio');
});

// 5. Menú contextual
document.addEventListener('contextmenu', function(e) {
  e.preventDefault();
  const contextMenu = document.getElementById('contextMenu');
  contextMenu.style.display = 'block';
  contextMenu.style.left = `${e.pageX}px`;
  contextMenu.style.top = `${e.pageY}px`;
});

document.addEventListener('click', function() {
  document.getElementById('contextMenu').style.display = 'none';
});

// 6. Indicador de carga
function showLoading() {
  document.getElementById('loadingIndicator').style.display = 'block';
}

function hideLoading() {
  document.getElementById('loadingIndicator').style.display = 'none';
}

// 7. Atajos de teclado
document.addEventListener('keydown', function(e) {
  // Ctrl+K para buscar
  if (e.ctrlKey && e.key === 'k') {
    e.preventDefault();
    document.getElementById('globalSearch').focus();
  }
  
  // Ctrl+P para imprimir
  if (e.ctrlKey && e.key === 'p') {
    e.preventDefault();
    window.print();
  }
  
  // Ctrl+? para mostrar atajos
  if (e.ctrlKey && e.key === '?') {
    e.preventDefault();
    document.getElementById('keyboardShortcuts').style.display = 'block';
    document.getElementById('emptyStateExample').style.display = 'none';
  }
});

// 8. Mejoras de accesibilidad
// Asegurar que todos los elementos interactivos sean focusables
document.querySelectorAll('button, [tabindex="0"]').forEach(el => {
  el.classList.add('focus-visible');
});

// 9. Calculadora de dosificación
document.getElementById('calculateDosage').addEventListener('click', function() {
  const weight = document.getElementById('patient-weight').value;
  const renalFunction = document.getElementById('renal-function').value;
  const hepaticFunction = document.getElementById('hepatic-function').value;
  
  let message = '';
  
  if (renalFunction < 30) {
    message = 'Ajustar dosis: Contraindicado en insuficiencia renal grave (TFG <30 mL/min). Considerar alternativa terapéutica.';
  } else if (renalFunction >= 30 && renalFunction < 50) {
    message = 'Dosis estándar: 1 comprimido una vez al día. Monitorear función renal cada mes.';
  } else {
    message = 'Dosis estándar: 1 comprimido una vez al día. Monitorear función renal cada 3 meses.';
  }
  
  if (hepaticFunction === 'severe') {
    message += ' Precaución: Insuficiencia hepática severa. Monitorizar estrechamente función hepática.';
  }
  
  const resultElement = document.getElementById('dosageResult');
  resultElement.querySelector('p:first-child').innerHTML = `Recomendación de Dosificación: <b>${message.split(':')[1]?.split('.')[0] || message}</b>`;
  resultElement.querySelector('p:last-child').textContent = message.includes('Contraindicado') ? 
    'Considerar alternativa terapéutica y consultar con nefrología.' : 
    'Administrar con o sin alimentos. Monitorear función renal regularmente.';
  
  resultElement.style.display = 'block';
});

// 10. Selector de pacientes
document.querySelectorAll('.patient-pill').forEach(pill => {
  pill.addEventListener('click', function() {
    // Remover clase active de todos
    document.querySelectorAll('.patient-pill').forEach(p => p.classList.remove('active'));
    // Agregar clase active al seleccionado
    this.classList.add('active');
    
    const patientId = this.dataset.patientId;
    const paciente = pacientes.find(p => p.id == patientId);
    
    // Actualizar dashboard con datos del paciente
    document.querySelector('.glass-home h2').textContent = `Resumen del Paciente: ${paciente.nombre.split(' ')[0]} ${paciente.nombre.split(' ')[1]}`;
    document.querySelector('.metric-value').textContent = paciente.tratamiento;
    document.querySelector('.adherence-value').textContent = `${paciente.adherencia}%`;
    document.querySelector('.adherence-progress-bar').style.width = `${paciente.adherencia}%`;
    
    // Inicializar gráfico con datos del paciente
    initHealthChart(patientId);
  });
});

// 11. Tour guiado para nuevos usuarios
function startWalkthrough() {
  if (!localStorage.getItem('walkthroughCompleted')) {
    setTimeout(() => {
      showToast('¡Bienvenido a SaludPro! Use Ctrl+? para ver atajos de teclado', 'success');
      localStorage.setItem('walkthroughCompleted', 'true');
    }, 2000);
  }
}

// Iniciar el tour al cargar la página
startWalkthrough();

// Inicializar gráfico al cargar la página
document.addEventListener('DOMContentLoaded', function() {
  initHealthChart(1); // Inicializar con el primer paciente
});

// Funciones para paneles (se mantienen del código original)
function showPanel(name) {
  document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
  document.getElementById('modalBackdrop').classList.add('active');
  document.getElementById('panel-' + name).classList.add('active');
}

function closePanel() {
  document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
  document.getElementById('modalBackdrop').classList.remove('active');
}

// Event listeners para botones de navegación
document.getElementById('btn-perfil').onclick = () => showPanel('perfil');
document.getElementById('btn-pacientes').onclick = () => showPanel('pacientes');
document.getElementById('btn-signos').onclick = () => showPanel('signos');
document.getElementById('btn-historia').onclick = () => showPanel('historia');
document.getElementById('btn-interacciones').onclick = () => showPanel('interacciones');
document.getElementById('btn-combinador').onclick = () => showPanel('combinador');
document.getElementById('btn-educacion').onclick = () => showPanel('educacion');
document.getElementById('btn-ayuda').onclick = () => showPanel('ayuda');

// Cerrar con backdrop
document.getElementById('modalBackdrop').onclick = closePanel;

// Cerrar con botón X
document.querySelectorAll('.close-btn').forEach(btn => {
  btn.onclick = closePanel;
});
</script>
</body>
</html>
